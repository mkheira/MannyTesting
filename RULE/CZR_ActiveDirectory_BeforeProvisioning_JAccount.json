{
  "description": "",
  "type": "BeforeProvisioning",
  "signature": {
    "input": [],
    "output": null
  },
  "sourceCode": {
    "version": "2025-12-26 23:01:05",
    "script": "\n  \nimport java.util.ArrayList;\nimport java.util.List;\nimport java.util.Arrays;\nimport sailpoint.object.Identity;\nimport sailpoint.object.ProvisioningPlan;\nimport sailpoint.object.ProvisioningPlan.Operation;\nimport sailpoint.object.ProvisioningPlan.AccountRequest;\nimport sailpoint.object.ProvisioningPlan.AttributeRequest;\nimport sailpoint.object.ProvisioningPlan.AccountRequest.Operation;\nimport java.text.SimpleDateFormat;\nimport java.util.Date;\nimport java.util.Calendar;\nimport sailpoint.rule.Account;\n\nString applicationName = application.getName();\nString nativeIdentity = null;\nIdentity identity = null;\nString lifeCycleState = null;\nString workerType = null;\nString employeeType = null;\nString personNumber = null;\nString displayName = null;\nString managerDisplayName = null;\nString managerEmail = null;\nString jobTitle = null;\nString locationDescription = null;\nString assignmentStartDateStr = null;\nDate terminationDate = null;\nString sAMAccountName = null;\nString upn = null;\nString strSOCRequestLog = \"\";\n\npublic ArrayList getADAccountRequests(ProvisioningPlan plan) {\n    ArrayList adAcctRequests = new ArrayList();\n    if (plan != null && !plan.isEmpty()) {\n        List accRequests = plan.getAccountRequests();\n        if (accRequests != null && !accRequests.isEmpty()) {\n            for (AccountRequest acctRequest : accRequests) {\n                String appName = acctRequest.getApplication();\n                if (appName != null && appName.startsWith(applicationName)) {\n                    adAcctRequests.add(acctRequest);\n                }\n            }\n        }\n    }\n    return adAcctRequests;\n}\n\npublic List removeDomainUsersGroup(List groups) {\n    List returnList = new ArrayList();\n    String domainUsersGroup = \"CN=Domain Users,OU\";\n    if (groups != null && groups.size() != 0) {\n        for (String group : groups) {\n            if (group == null) continue;\n            if (group.startsWith(domainUsersGroup))\n                continue;\n            returnList.add(group);\n        }\n    }\n    return returnList;\n}\n\npublic Date getTerminationDate(Object termDateObj) {\n    Date result = null;\n    if (termDateObj instanceof String && !((String) termDateObj).equals(\"\")) {\n        SimpleDateFormat myFormat = new SimpleDateFormat(\"yyyy-MM-dd\");\n        result = myFormat.parse((String) termDateObj);\n    } else if (termDateObj instanceof Date) {\n        SimpleDateFormat myFormat = new SimpleDateFormat(\"yyyy-MM-dd\");\n        result = myFormat.parse(myFormat.format((Date) termDateObj));\n    }\n    return result;\n}\n\npublic String adFileTimePlusOneDay(Date base) {\n    Calendar cal = Calendar.getInstance();\n    cal.setTime(base);\n    cal.add(Calendar.DATE, 1);\n    long millis = cal.getTimeInMillis();\n    long fileTime = (millis * 10000L)\n                    + 116444736000000000L        \n                    + 216000000000L;       \n    return String.valueOf(fileTime);\n}\n\npublic AccountRequest leaverPlan(AccountRequest acctReq, String personNumber, String nativeIdentity, String action) {\n\tif(null != identity && null != personNumber && null != nativeIdentity && null != action && null != acctReq) {\n\t\tboolean terminationFlag = false;\n\t\tboolean legalHold = false;\n\t\tString harrahsLegalHoldGroup = (String) idn.getSourceAttributeBySourceName(applicationName, \"harrahsLegalHoldGroup\");\n\t\tString harrahsLegalHoldOU = (String) idn.getSourceAttributeBySourceName(applicationName, \"harrahsLegalHoldOU\");\n\t\tString jaccountDisabledOU = (String) idn.getSourceAttributeBySourceName(applicationName, \"jaccountDisabledOU\");\n\t\tString oldOUHarrahs = nativeIdentity.toUpperCase();\n\t\tString description = (String) idn.getRawAccountAttribute(applicationName, nativeIdentity, \"description\");\n\t\tif(null != description)\n\t\t\tdescription = description.toUpperCase();\n\t\telse\n\t\t\tdescription = \"\";\n\t\tString newHarrahsOU = null;\t\t\t\t\t\t\n\t\tif(null != oldOUHarrahs && null != description &&\n\t\t\tdescription.indexOf(\"TERM(\" ) == -1 &&\n\t\t\tdescription.indexOf(\"TERM (\" ) == -1\n\t\t) {\n\t\t\tterminationFlag = true;\n\t\t}\n\t\tif(terminationFlag) {\n\t\t\tif(null != jaccountDisabledOU){\n\t\t\t\tnewHarrahsOU = jaccountDisabledOU;\n\t\t\t}\t\t\t\t\t\t\t\n\t\t\tint intIndex =0;\n\t\t\tif(null != description) {\n\t\t\t\tintIndex= description.toUpperCase().indexOf(\"LEGAL HOLD\");\n\t\t\t\tif(intIndex != - 1) {\n\t\t\t\t\tlegalHold = true;\n\t\t\t\t\tif(null != harrahsLegalHoldGroup) {\n\t\t\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"memberOf\",ProvisioningPlan.Operation.Add, harrahsLegalHoldGroup));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tObject oldMemberOfValue = idn.getRawAccountAttribute(applicationName, nativeIdentity, \"memberOf\");\n\t\t\tif(null != oldMemberOfValue) {\n\t\t\t\tif(oldMemberOfValue instanceof String) {\n\t\t\t\t\tString group = (String) oldMemberOfValue;\n\t\t\t\t\tif(null != group && !group.startsWith(\"CN=Domain Users,OU\")) {\n\t\t\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"memberOf\",ProvisioningPlan.Operation.Remove,group));\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tList groups = (List) oldMemberOfValue;\n\t\t\t\t\tList exceptDomainUsersGrp = removeDomainUsersGroup(groups);\n\t\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"memberOf\", ProvisioningPlan.Operation.Remove, exceptDomainUsersGrp));\n\t\t\t\t}\n\t\t\t}\t\t\t\t\t\t\t\t\n\t\t\tif(legalHold && null != harrahsLegalHoldOU) {\n\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"AC_NewParent\", ProvisioningPlan.Operation.Set, harrahsLegalHoldOU));\n\t\t\t} else {\n\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"AC_NewParent\", ProvisioningPlan.Operation.Set, newHarrahsOU));\n\t\t\t}\n\t\t\tString oldDesc = (String) idn.getRawAccountAttribute(applicationName, nativeIdentity, \"description\");\n\t\t\tif(oldDesc == null)\n\t\t\t\toldDesc = \"\";\n\t\t\toldDesc = oldDesc.replaceAll(\"(?i)LOA\\\\([^)]*\\\\)\", \"\").replaceAll(\"  +\", \" \").trim();\n\t\t\tDate date = new Date();\n\t\t\tSimpleDateFormat formatter = new SimpleDateFormat(\"MM/dd/yyyy\");\n\t\t\tString todayDate = formatter.format(date);\n\t\t\tString termDescription = \"TERM(\" + todayDate + \") \" + oldDesc;\n\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"description\", ProvisioningPlan.Operation.Set, termDescription.trim()));\n\t\t\tDate baseDate = (terminationDate != null) ? terminationDate : new Date();\n\t\t\tString adTimeStamp = adFileTimePlusOneDay(baseDate);\t\t\t\n\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"accountExpires\", ProvisioningPlan.Operation.Set, adTimeStamp));\n\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"manager\", ProvisioningPlan.Operation.Set, \"\"));\n\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"userAccountControl\", ProvisioningPlan.Operation.Set, 262658));\n\t\t}\t\n\t}\n\treturn acctReq;\t\n}\n\npublic boolean isSetupLike(List attReqs, String sourceAttrName) {\n\tboolean result = false;\n\tif(null != attReqs && !attReqs.isEmpty()) {\n\t\tfor(ProvisioningPlan.AttributeRequest attReq : attReqs) {\n\t\t\tif(attReq.getOperation() == ProvisioningPlan.Operation.Add) {\n\t\t\t\tObject memberOf = attReq.getValue();\n\t\t\t\tif(null != memberOf) {\n\t\t\t\t\tString targetEnt = idn.getSourceAttributeBySourceName(application.getName(), sourceAttrName);\n\t\t\t\t\tif(null != targetEnt) {\n\t\t\t\t\t\tif(memberOf instanceof String && String.valueOf(memberOf).equalsIgnoreCase(targetEnt)) {\n\t\t\t\t\t\t\tresult = true;\n\t\t\t\t\t\t} else if(memberOf instanceof List) {\n\t\t\t\t\t\t\tList groups = (List) memberOf;\n\t\t\t\t\t\t\tif(groups.contains(targetEnt)) {\n\t\t\t\t\t\t\t\tresult = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\t\n\treturn result;\n}\n\npublic String generatePassword() {\n\tString capitalCaseLetters = \"ABCDEFGHIJKLMNOPQRSTUVWXYZ\";\n\tString lowerCaseLetters = \"abcdefghijklmnopqrstuvwxyz\";\n    String numbers = \"1234567890\";\n    String specialCharacters = \"$#@*!^_-\";\n    int passwordLength = 14;\n    char[] password = new char[passwordLength];\n    String combinedChars = capitalCaseLetters + lowerCaseLetters + specialCharacters + numbers;\n    Random random = new Random();\n        \n    password[0] = lowerCaseLetters.charAt(random.nextInt(lowerCaseLetters.length()));\n    password[1] = capitalCaseLetters.charAt(random.nextInt(capitalCaseLetters.length()));\n    password[2] = specialCharacters.charAt(random.nextInt(specialCharacters.length()));\n    password[3] = numbers.charAt(random.nextInt(numbers.length()));\n\n    for (int i = 4; i < passwordLength; i++) {\n\t\tpassword[i] = combinedChars.charAt(random.nextInt(combinedChars.length()));\n\t}\n\treturn String.valueOf(password);\n}\n\npublic String getAssignmentStartDateString(Object assignmentStartDateObj) {\n\tString result = \"\";\n\tif(null != assignmentStartDateObj) {\n\t\tif(assignmentStartDateObj instanceof String && assignmentStartDateObj != \"\") {\n\t\t\tresult = (String) assignmentStartDateObj;\n\t\t} else if(assignmentStartDateObj instanceof Date) {\n\t\t\tDate tmpDate = (Date) assignmentStartDateObj;\n\t\t\tresult = new SimpleDateFormat(\"yyyy-MM-dd\").format(tmpDate);\n\t\t}\n\t}\n\treturn result;\n}\n\npublic String getAccountAttributeValue(String applicationName, String attributeName, String nativeIdentity) {\n\tString attrValue = \"\";\n\tAccount account = idn.getAccountByNativeIdentity(applicationName, nativeIdentity);\n\tstrSOCRequestLog = strSOCRequestLog+ \"In getAccountAttributeValue account:\"+account;\n\tif(account != null) {\n\t\tMap accountAttrMap = account.getAttributes();\n\t\tObject object = idn.getRawAccountAttribute(account, attributeName);\n\t\tstrSOCRequestLog = strSOCRequestLog+\" getRawAccountAttribute:\"+object+\" accountAttrMap:\"+accountAttrMap;\n\t\tif(accountAttrMap != null && accountAttrMap.size() > 0) {\n\t\t\tattrValue = accountAttrMap.get(attributeName);\n\t\t}if(object != null && (attrValue == null || (attrValue != null && attrValue.isEmpty()))) {\n\t\t\tif(object instanceof String) {\n\t\t\t\tattrValue = (String)object;\n\t\t\t}\n\t\t}\n\t}\n\tstrSOCRequestLog = strSOCRequestLog+ \" attributeName:\"+attributeName+ \" StringattributeValue:\"+attrValue;\n\treturn attrValue;\n}\n\npublic boolean isValidSOCSupendRequest(String applicationName, String personNumber, String suspended, boolean isSuspendedReq) {\n\tboolean retValue = false;\n\tObject dateObject = isSuspendedReq ? getAccountAttributeValue(applicationName, \"SuspendedDate\", personNumber) : getAccountAttributeValue(applicationName, \"EnabledDate\", personNumber);\n\tString status = getAccountAttributeValue(applicationName, \"Status\", personNumber);\t\n\tif((isSuspendedReq && \"Y\".equalsIgnoreCase(suspended) && \"inactive\".equalsIgnoreCase(status)) || (!isSuspendedReq && \"N\".equalsIgnoreCase(suspended) && \"active\".equalsIgnoreCase(status))) {\n\t\tretValue = true;\n\t}\n\tstrSOCRequestLog = strSOCRequestLog+ \"In isValidSOCSupendRequest applicationName:\"+applicationName+\" personNumber:\"+personNumber+\" suspended:\"+suspended+\":\"+suspended+\" dateObject:\"+dateObject+\" status:\"+status+\" retValue:\"+retValue;\n\tlog.debug(\"In AD_BeforeProvisioning_JAccount Rule method isValidSOCSupendRequest identity: \"+personNumber+\" isSuspendedReq: \"+isSuspendedReq+\" applicationName: \"+applicationName+\" suspended: \"+suspended+\" dateObject: \"+dateObject+\" retValue: \"+retValue);\n\treturn retValue;\n}\n\nif (plan != null) {\n    ArrayList acctReqs = getADAccountRequests(plan);\n    if (acctReqs != null && !acctReqs.isEmpty()) {\n        for (AccountRequest acctReq : acctReqs) {\n            ProvisioningPlan.AccountRequest.Operation operation = acctReq.getOperation();\n            nativeIdentity = acctReq.getNativeIdentity();\n            if (operation != null) {\n                identity = plan.getIdentity();\n                if (identity != null) {\n                    workerType = (String) identity.getAttribute(\"workerType\");\n                    lifeCycleState = (String) identity.getAttribute(\"cloudLifecycleState\");\n                    employeeType = (String) identity.getAttribute(\"employeeType\");\n                    personNumber = (String) identity.getAttribute(\"identificationNumber\");\n                    displayName = (String) identity.getAttribute(\"displayName\");\n                    managerDisplayName = (String) identity.getAttribute(\"managerDisplayName\");\n                    managerEmail = (String) identity.getAttribute(\"managerEmail\");\n                    terminationDate = getTerminationDate(identity.getAttribute(\"terminationDate\"));\n\t\t\t\t\tjobTitle = (String) identity.getAttribute(\"jobTitle\");\n\t\t\t\t\tlocationDescription = (String) identity.getAttribute(\"locationDescription\");\n\t\t\t\t\tassignmentStartDateStr = getAssignmentStartDateString(identity.getAttribute(\"assignmentStartDate\"));\n\t\t\t\t\tsAMAccountName = (String) idn.getRawAccountAttribute(applicationName, nativeIdentity, \"sAMAccountName\");\n\t\t\t\t\tupn = (String) idn.getRawAccountAttribute(applicationName, nativeIdentity, \"userPrincipalName\");\n\t\t\t\t\t\n                    acctReq.addArgument(\"excScriptIdentityDisplayName\", displayName);\n                    acctReq.addArgument(\"excScriptPersonNumber\", personNumber);\t\n\t\t\t\t\tacctReq.addArgument(\"excScriptSAMAccName\", sAMAccountName);\t\t\t\t\t\t\n\t\t\t\t\tacctReq.addArgument(\"excScriptUPN\", upn);\t\t\t\t\t\n\t\t\t\t\tacctReq.addArgument(\"excScriptManagerDisplayName\", managerDisplayName);\n\t\t\t\t\tacctReq.addArgument(\"excScriptManagerEmail\", managerEmail);\n\t\t\t\t\tif (operation.equals(ProvisioningPlan.AccountRequest.Operation.Modify)) {\n\t\t\t\t\t\tif (isSetupLike(acctReq.getAttributeRequests(\"memberOf\"), \"SOCPasswordReset\")) {\n\t\t\t\t\t\t\tlog.debug(\"SOCPasswordReset found\");\n\t\t\t\t\t\t\tList groupReqs = acctReq.getAttributeRequests(\"memberOf\");\n\t\t\t\t\t\t\tif (groupReqs != null) {\n\t\t\t\t\t\t\t\tfor (ProvisioningPlan.AttributeRequest r : new ArrayList(groupReqs)) {\n\t\t\t\t\t\t\t\t\tacctReq.remove(r); // safe removal\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tString newPassword = generatePassword();\n\t\t\t\t\t\t\tif (newPassword != null) {\n\t\t\t\t\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"password\", ProvisioningPlan.Operation.Set, newPassword));\n\t\t\t\t\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"pwdLastSet\", ProvisioningPlan.Operation.Set, true));\n\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptSOCSendPwdEmail\", \"true\");\n\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptJobTitle\",jobTitle);\n\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptLocationDesc\",locationDescription);\n\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptAssignmentStartDate\",assignmentStartDateStr);\n\t\t\t\t\t\t\t\tacctReq.addArgument(\"pwd\",newPassword);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(\"Employee\".equalsIgnoreCase(workerType) && \"E\".equalsIgnoreCase(employeeType) && null != lifeCycleState && ( \"inactive\".equalsIgnoreCase(lifeCycleState) || \"lsalclbbdc\".equalsIgnoreCase(lifeCycleState) || \"inactiveImmediateTerm\".equalsIgnoreCase(lifeCycleState))) {\n\t\t\t\t\t\t\tif(null != acctReq.getAttributeRequests(\"memberOf\")) {\n\t\t\t\t\t\t\t\tString termWorkerTypeLOAEnt = idn.getSourceAttributeBySourceName(application.getName(), \"terminateEmployeeLOA\");\n\t\t\t\t\t\t\t\tboolean flag = false;\n\t\t\t\t\t\t\t\tAttributeRequest termEmployeeLOAEntAttrRequest = null;\n\t\t\t\t\t\t\t\t\tfor(AttributeRequest attributeRequest : acctReq.getAttributeRequests(\"memberOf\")){\n\t\t\t\t\t\t\t\t\t\tObject memberOfValueObj = attributeRequest.getValue();\n\t\t\t\t\t\t\t\t\t\tif(memberOfValueObj != null && memberOfValueObj instanceof String && String.valueOf(memberOfValueObj).equalsIgnoreCase(termWorkerTypeLOAEnt)){\n\t\t\t\t\t\t\t\t\t\ttermEmployeeLOAEntAttrRequest = attributeRequest;\n\t\t\t\t\t\t\t\t\t\tflag = true;\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t   } else if(memberOfValueObj != null && memberOfValueObj instanceof List && ((List)memberOfValueObj).contains(termWorkerTypeLOAEnt)){\n\t\t\t\t\t\t\t\t\t\t\ttermEmployeeLOAEntAttrRequest = attributeRequest;\n\t\t\t\t\t\t\t\t\t\t\tflag = true;\n\t\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t  }\n\t\t\t\t\t\t\t\t\t\tif(flag){\n\t\t\t\t\t\t\t\t\t\t   acctReq.remove(termEmployeeLOAEntAttrRequest);\n\t\t\t\t\t\t\t\t\t\t   acctReq = leaverPlan(acctReq, personNumber, nativeIdentity, \"leaverWorkerTypeLOA\");\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (acctReq.getOperation() == ProvisioningPlan.AccountRequest.Operation.Modify && acctReq.getAttributeRequests(\"memberOf\") != null) {\n\t\t\t\t\t\t\tString LHEntGroup = (String) idn.getSourceAttributeBySourceName(application.getName(), \"LHEnt\");\n\t\t\t\t\t\t\tString harrahsLegalHoldGroup = (String) idn.getSourceAttributeBySourceName(application.getName(), \"harrahsLegalHoldGroup\");\n\t\t\t\t\t\t\tboolean lhAdd = false;\n\t\t\t\t\t\t\tboolean lhRemove = false;\n\t\t\t\t\t\t\tfor (AttributeRequest attReq : acctReq.getAttributeRequests(\"memberOf\")) {\n\t\t\t\t\t\t\t\tif (attReq == null) continue;\n\t\t\t\t\t\t\t\tObject val = attReq.getValue();\n\t\t\t\t\t\t\t\tList groups = new ArrayList();\n\t\t\t\t\t\t\t\tif (val instanceof String) {\n\t\t\t\t\t\t\t\t\tgroups.add((String) val);\n\t\t\t\t\t\t\t\t} else if (val instanceof List) {\n\t\t\t\t\t\t\t\t\tgroups.addAll((List) val);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tfor (String g : groups) {\n\t\t\t\t\t\t\t\t\tif (g != null && g.equalsIgnoreCase(LHEntGroup)) {\n\t\t\t\t\t\t\t\t\t\tif (attReq.getOperation() == ProvisioningPlan.Operation.Add) {\n\t\t\t\t\t\t\t\t\t\t\tlhAdd = true;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tif (attReq.getOperation() == ProvisioningPlan.Operation.Remove) {\n\t\t\t\t\t\t\t\t\t\t\tlhRemove = true;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t// If ADD and REMOVE in same plan\n\t\t\t\t\t\t\tif (lhAdd && lhRemove) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tString oldDesc = (String) idn.getRawAccountAttribute(applicationName, nativeIdentity, \"description\");\n\t\t\t\t\t\t\tif (oldDesc == null) oldDesc = \"\";\n\t\t\t\t\t\t\tString ext41 = (String) idn.getRawAccountAttribute(applicationName, nativeIdentity, \"msExchExtensionAttribute41\");\n\t\t\t\t\t\t\tObject memberOfObj = idn.getRawAccountAttribute(applicationName, nativeIdentity, \"memberOf\");\n\t\t\t\t\t\t\t// -------- ADD Logic --------\n\t\t\t\t\t\t\tif (lhAdd) {\n\t\t\t\t\t\t\t\t// Description\n\t\t\t\t\t\t\t\tif (!oldDesc.toUpperCase().contains(\"LEGAL HOLD\")) {\n\t\t\t\t\t\t\t\t\tString newDesc = oldDesc.trim().isEmpty() ? \"LEGAL HOLD\" : (oldDesc + \" LEGAL HOLD\");\n\t\t\t\t\t\t\t\t\tnewDesc = newDesc.trim().replaceAll(\"  \", \" \");\n\t\t\t\t\t\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"description\", ProvisioningPlan.Operation.Set, newDesc));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t// msExchExtensionAttribute41\n\t\t\t\t\t\t\t\tif (ext41 == null || !ext41.startsWith(\"L\")) {\n\t\t\t\t\t\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"msExchExtensionAttribute41\", ProvisioningPlan.Operation.Set, \"L\"));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t// Legal Hold Group\n\t\t\t\t\t\t\t\tboolean hasGroup = false;\n\t\t\t\t\t\t\t\tif (memberOfObj instanceof List) {\n\t\t\t\t\t\t\t\t\thasGroup = ((List) memberOfObj).contains(harrahsLegalHoldGroup);\n\t\t\t\t\t\t\t\t} else if (memberOfObj instanceof String) {\n\t\t\t\t\t\t\t\t\thasGroup = harrahsLegalHoldGroup.equalsIgnoreCase((String) memberOfObj);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (!hasGroup && harrahsLegalHoldGroup != null) {\n\t\t\t\t\t\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"memberOf\", ProvisioningPlan.Operation.Add, harrahsLegalHoldGroup));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t// -------- REMOVE Logic --------\n\t\t\t\t\t\t\tif (lhRemove) {\n\t\t\t\t\t\t\t\t// Description\n\t\t\t\t\t\t\t\tif (oldDesc.toUpperCase().contains(\"LEGAL HOLD\")) {\n\t\t\t\t\t\t\t\t\tString newDesc = oldDesc.replaceAll(\"(?i)\\\\bLEGAL HOLD\\\\b\", \"\").replaceAll(\"\\\\s{2,}\", \" \").trim();\n\t\t\t\t\t\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"description\", ProvisioningPlan.Operation.Set, newDesc));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t// msExchExtensionAttribute41\n\t\t\t\t\t\t\t\tif (ext41 != null && ext41.startsWith(\"L\")) {\n\t\t\t\t\t\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"msExchExtensionAttribute41\", ProvisioningPlan.Operation.Set, \"\"));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t// Legal Hold Group\n\t\t\t\t\t\t\t\tboolean hasGroup = false;\n\t\t\t\t\t\t\t\tif (memberOfObj instanceof List) {\n\t\t\t\t\t\t\t\t\thasGroup = ((List) memberOfObj).contains(harrahsLegalHoldGroup);\n\t\t\t\t\t\t\t\t} else if (memberOfObj instanceof String) {\n\t\t\t\t\t\t\t\t\thasGroup = harrahsLegalHoldGroup.equalsIgnoreCase((String) memberOfObj);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (harrahsLegalHoldGroup != null && hasGroup) {\n\t\t\t\t\t\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"memberOf\", ProvisioningPlan.Operation.Remove, harrahsLegalHoldGroup));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\t\t\t\t\t\t\n\t\t\t\t\t}                   \n                    else if (operation.equals(ProvisioningPlan.AccountRequest.Operation.Disable)) {\n\t\t\t\t\t\tString suspended = getAccountAttributeValue(\"CZR-Application-Suspend\", \"Suspended\", personNumber);\n\t\t\t\t\t\tboolean isValidSOCSupendRequest = isValidSOCSupendRequest(\"CZR-Application-Suspend\", personNumber, suspended, true);\n\t\t\t\t\t\tlog.debug(\"In AD_BeforeProvisioning_JAccount Rule identity: \"+personNumber+\" Operation: \"+operation+\" Suspended: \"+suspended);\n\t\t\t\t\t\tacctReq.addArgument(\"excScriptSuspenedReqLog\", \"JAccount Disable Operation suspended: \"+suspended+\" Status:\"+getAccountAttributeValue(\"CZR-Application-Suspend\", \"Status\", personNumber)+\" EnabledDate:\"+getAccountAttributeValue(\"CZR-Application-Suspend\", \"EnabledDate\", personNumber)+\" SuspendedDate:\"+getAccountAttributeValue(\"CZR-Application-Suspend\", \"SuspendedDate\", personNumber)+\" isValidSOCSupendRequest:\"+isValidSOCSupendRequest+\" strSOCRequestLog:\"+strSOCRequestLog);\n\t\t\t\t\t\tif(\"Y\".equalsIgnoreCase(suspended) && isValidSOCSupendRequest) {\n\t\t\t\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"description\", ProvisioningPlan.Operation.Set, \"DO NOT ENABLE PER IAM\"));\n\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptSuspendedState\", \"suspend\");\n\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptSuspendedReason\", getAccountAttributeValue(\"CZR-Application-Suspend\", \"ReasonForSuspension\", personNumber));\n\t\t\t\t\t\t}\n                        if (\"Employee\".equalsIgnoreCase(workerType)) {\n                            if (lifeCycleState != null && \"leaveOfAbsence\".equalsIgnoreCase(lifeCycleState) && nativeIdentity != null) {\n                                if (nativeIdentity.toUpperCase().indexOf(\"OU=DISABLED\") == -1 && nativeIdentity.toUpperCase().indexOf(\"OU=LEGAL HOLD\") == -1) {\n                                    String oldDesc = (String) idn.getRawAccountAttribute(applicationName, nativeIdentity, \"description\");\n                                    if (oldDesc == null) oldDesc = \"\";\n                                    Date date = new Date();\n                                    SimpleDateFormat formatter = new SimpleDateFormat(\"MM/dd/yyyy\");\n                                    String todayDate = formatter.format(date);\n                                    String loaDescription = \"LOA(\" + todayDate + \") \" + oldDesc;\n                                    acctReq.add(new ProvisioningPlan.AttributeRequest(\"description\", ProvisioningPlan.Operation.Set, loaDescription.trim()));\n                                    acctReq.add(new ProvisioningPlan.AttributeRequest(\"userAccountControl\", ProvisioningPlan.Operation.Set, 514));\n                                }\n                            }\n                        }\n\n                        if (lifeCycleState != null && nativeIdentity != null &&\n                            (\"inactive\".equalsIgnoreCase(lifeCycleState) || \"inactiveImmediateTerm\".equalsIgnoreCase(lifeCycleState) || \"lsalclbbdc\".equalsIgnoreCase(lifeCycleState))) {\n                            acctReq = leaverPlan(acctReq, personNumber, nativeIdentity, \"leaver\");\n                        }\n                    }\n                    else if (operation.equals(ProvisioningPlan.AccountRequest.Operation.Enable)) {\n\t\t\t\t\t\tString oldDesc = idn.getRawAccountAttribute(applicationName, nativeIdentity, \"description\") != null ? (String) idn.getRawAccountAttribute(applicationName, nativeIdentity, \"description\") : \"\";\n\t\t\t\t\t\tString strOldDesc = oldDesc;\n                        if (\"Employee\".equalsIgnoreCase(workerType)) {\n                            if (lifeCycleState != null &&\n                                \"active\".equalsIgnoreCase(lifeCycleState) &&\n                                nativeIdentity != null &&\n                                nativeIdentity.toUpperCase().indexOf(\"OU=LEGAL HOLD\") == -1 &&\n                                nativeIdentity.toUpperCase().indexOf(\"OU=DISABLED\") == -1) {\n\n                                int loaIndex = oldDesc.toUpperCase().indexOf(\"LOA(\");\n                                if (loaIndex != -1) {\n                                    String modifiedDesp = oldDesc.replace(\")\", \"]\");\n                                    String[] substring = modifiedDesp.substring(modifiedDesp.lastIndexOf(\"LOA\") + 3).split(\"\\\\]\");\n                                    String date = substring[0];\n                                    String value = oldDesc.replace(date, \"\");\n                                    String newDescription = value.replace(\"LOA)\", \"\").trim();\n                                    newDescription = newDescription.replaceAll(\"  \", \" \");\n                                    if (newDescription != null) {\n                                        acctReq.add(new ProvisioningPlan.AttributeRequest(\"description\", ProvisioningPlan.Operation.Set, newDescription.trim()));\n                                    }\n                                }\n                            }\n                        }\n\t\t\t\t\t\tString suspended = getAccountAttributeValue(\"CZR-Application-Suspend\", \"Suspended\", personNumber);\n\t\t\t\t\t\tboolean isValidSOCSupendRequest = isValidSOCSupendRequest(\"CZR-Application-Suspend\", personNumber, suspended, false);\n\t\t\t\t\t\tlog.debug(\"In AD_BeforeProvisioning_JAccount Rule identity: \"+personNumber+\" Operation: \"+operation+\" Suspended: \"+suspended);\n\t\t\t\t\t\tacctReq.addArgument(\"excScriptSuspenedReqLog\", \"JAccount Enable Operation suspended: \"+suspended+\" Status:\"+getAccountAttributeValue(\"CZR-Application-Suspend\", \"Status\", personNumber)+\" EnabledDate:\"+getAccountAttributeValue(\"CZR-Application-Suspend\", \"EnabledDate\", personNumber)+\" SuspendedDate:\"+getAccountAttributeValue(\"CZR-Application-Suspend\", \"SuspendedDate\", personNumber)+\" isValidSOCSupendRequest:\"+isValidSOCSupendRequest+\" strSOCRequestLog:\"+strSOCRequestLog);\n\t\t\t\t\t\tif(\"N\".equalsIgnoreCase(suspended) && strOldDesc.contains(\"DO NOT ENABLE PER IAM\") && isValidSOCSupendRequest) {\n\t\t\t\t\t\t\tstrOldDesc = strOldDesc.replace(\"DO NOT ENABLE PER IAM\", \"\");\n\t\t\t\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"description\", ProvisioningPlan.Operation.Set, strOldDesc));\n\t\t\t\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"userAccountControl\", ProvisioningPlan.Operation.Set, 512));\n\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptSuspendedState\", \"activate\");\t\n\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptActivationReason\", getAccountAttributeValue(\"CZR-Application-Suspend\", \"ReasonForActivation\", personNumber));\n\t\t\t\t\t\t}\n                    }\n                }\n\t\t\t} else {\n\t\t\t\tthrow new Exception(\"operation object value returned is null or empty\");\n\t\t\t}\n\t\t}\n    } else {\n        throw new Exception(\"accntRequest object value returned is null or empty\");\n    }\n} else {\n    throw new Exception(\"plan object value returned is null or empty\");\n}\n \n"
  },
  "attributes": {
    "sourceVersion": "2025-12-26 23:01:05"
  },
  "id": "f7b0a5fe8b3d4c11ac17f92759dc6207",
  "name": "CZR_ActiveDirectory_BeforeProvisioning_JAccount",
  "created": "2025-12-08T14:21:13.927Z",
  "modified": "2025-12-26T23:01:06.097Z"
}