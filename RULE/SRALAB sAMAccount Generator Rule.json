{
  "description": "This will generate a AD username.",
  "type": "AttributeGenerator",
  "signature": {
    "input": [],
    "output": null
  },
  "sourceCode": {
    "version": "2025-12-03 16:02:04",
    "script": "\nimport sailpoint.tools.GeneralException;    \nimport java.util.Iterator;\nimport sailpoint.object.*;\nimport java.util.ArrayList;\nimport sailpoint.api.*;\nimport java.util.List;\nimport org.apache.commons.lang.StringUtils;\nimport sailpoint.server.IdnRuleUtil;\nimport java.util.Arrays;\n\n/*\nIDN shall use the below formula to calculate user sAMAccountName in the below order: \n1. $FirstName +  LastName  \n2. $FirstName + LastName + 1 \n3. $FirstName + LastName + (number used previously + 1) \n*/\n\nint MAX_ITERATIONS = 100;\nString AD_SOURCE_ID = application.getId();\nString WORKDAY_SOURCE_ID = application.getAttributeValue(\"workdaySourceId\");\nString AZURE_SOURCE_ID = application.getAttributeValue(\"azureSourceId\");\nString AZURE_DBTABLE_ID = application.getAttributeValue(\"azuredbSourceId\");\n\nArrayList USERNAME_SOURCEAD = new ArrayList(Arrays.asList(new String[]{AD_SOURCE_ID}));\nArrayList USERNAME_SOURCE_WD_AZUR = new ArrayList(Arrays.asList(new String[]{WORKDAY_SOURCE_ID,AZURE_SOURCE_ID}));\nArrayList SMTP_SOURCES = new ArrayList(Arrays.asList(new String[]{AZURE_SOURCE_ID, AD_SOURCE_ID}));\nArrayList SIP_SOURCES = new ArrayList(Arrays.asList(new String[]{AZURE_SOURCE_ID, AD_SOURCE_ID}));\nArrayList USERNAME_AZUREDB = new ArrayList(Arrays.asList(new String[]{AZURE_DBTABLE_ID}));\n\npublic String cleanName(String name) {\n    return name.toLowerCase().replaceAll(\"[^A-Za-z]+\", \"\");\n}\n\npublic boolean isUnique(String username) throws GeneralException {\n\t\n\t  // Check the Azure DB table RowKey field (Equals)\n    int accountsFoundAzureDB = idn.attrSearchCountAccounts(USERNAME_AZUREDB, \"promotedUserName\", \"Equals\", new ArrayList(Arrays.asList(new String[] {username, username.toLowerCase()})));\n\t\n    // Check the AD sAMAccountName field (Equals)\n    int accountsFoundAD = idn.attrSearchCountAccounts(USERNAME_SOURCEAD, \"promotedUserName\", \"Equals\", new ArrayList(Arrays.asList(new String[] {username, username.toLowerCase()})));\n\n    // Check Workday and Azure w/ @ symbol (StartsWith)\n \n    int accountsFoundWorkday = idn.attrSearchCountAccounts(USERNAME_SOURCE_WD_AZUR, \"promotedUserName\", \"StartsWith\", new ArrayList(Arrays.asList(new String[] {username + \"@\"})));\n\t\n\t// Check on the AD and Azure SMTP email addresses (StartsWith)\n\tint smtpFound = idn.attrSearchCountAccounts(SMTP_SOURCES, \"promotedSmtpAddresses\", \"StartsWith\", new ArrayList(Arrays.asList(new String[] {\"smtp:\" + username + \"@\"})));\n    // Check on the AD and Azure SIP email addresses (StartsWith)\n\tint sipFound = idn.attrSearchCountAccounts(SIP_SOURCES, \"promotedSipAddresses\", \"StartsWith\", new ArrayList(Arrays.asList(new String[] {\"sip:\" + username + \"@\"})));\n\n    return ((accountsFoundAzureDB == 0) && (accountsFoundAD == 0) && (accountsFoundWorkday == 0)  && (smtpFound == 0) && (sipFound == 0));\n}\n\npublic String generateSAMAccountName(String firstName, String lastName) throws GeneralException {\n    // Data protection\n    firstName = StringUtils.trimToNull(firstName);\n    lastName = StringUtils.trimToNull(lastName);\n\n    if ((firstName == null) || (lastName == null)) {\n        return null;\n    }\n\n    // Lower Case and Clean Spaces/Special Characters\n    firstName = cleanName(firstName);\n    lastName = cleanName(lastName);\n\n    // Base username: first initial + last name\n    String base = firstName.substring(0, 1) + lastName;\n    base = (base.length() > 20) ? StringUtils.substring(base, 0, 20) : base;\n\n    // Try base name first\n    if (isUnique(base)) {\n        log.debug(\"AD Create User Name | Unique username generated: \" + base);\n        return base;\n    }\n\n    // Try base + suffix with leading zeros\n    for (int i = 1; i <= MAX_ITERATIONS; i++) {\n        String suffix = (i < 10) ? \"0\" + i : String.valueOf(i);\n        int maxBaseLength = 20 - suffix.length(); // truncate base accordingly\n        String username = StringUtils.substring(base, 0, maxBaseLength) + suffix;\n\n        if (isUnique(username)) {\n            log.debug(\"AD Create User Name | Unique username generated with suffix: \" + username);\n            return username;\n        }\n    }\n\n    // If all attempts fail\n    return null;\n}\n\n\ntry {\n    return generateSAMAccountName(identity.getFirstname(), identity.getLastname());\n} catch (Exception e) {\n    log.debug(\"Assured Partners sAMAccountName Generation Rule: Error occurred during generateSamname check: \" + e);\n    return null;\n}\n          "
  },
  "attributes": {
    "sourceVersion": "2025-12-03 16:02:04"
  },
  "id": "4451e58d6e024db1974169dd0613d8d6",
  "name": "SRALAB sAMAccount Generator Rule",
  "created": "2025-12-03T16:02:04.887Z",
  "modified": "2025-12-03T16:02:04.887Z"
}