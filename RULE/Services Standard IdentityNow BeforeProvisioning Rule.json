{
  "description": "Before Provisioning Rule which changes disables and enables to a modify.",
  "type": "BeforeProvisioning",
  "signature": {
    "input": [],
    "output": null
  },
  "sourceCode": {
    "version": "2025-03-03 22:19:19",
    "script": "\n  \t\nimport sailpoint.object.Application;\nimport sailpoint.object.Attributes;\nimport sailpoint.object.Identity;\nimport sailpoint.object.ManagedAttribute.Type;\nimport sailpoint.object.ProvisioningPlan;\nimport sailpoint.object.ProvisioningPlan.AccountRequest;\nimport sailpoint.object.ProvisioningPlan.AttributeRequest;\nimport sailpoint.tools.GeneralException;\nimport sailpoint.tools.Util;\n\nimport java.text.SimpleDateFormat;\nimport sailpoint.rule.Account;\nimport sailpoint.rule.ManagedAttributeDetails;\nimport sailpoint.server.IdnRuleUtil;\n\nimport java.util.List;\nimport java.util.ArrayList;\nimport java.util.Date;\nimport java.util.Map;\nimport java.util.Random;\n\n\nimport java.util.HashMap;\n\n/*\n\t * Version 1.7.2\n\t * Last Updated: 08/18/2023\n\t */\n\t\n\t/*\n\t * Main Application Method. This will go through the passed in event configurations. \n\t * If any event trigger/operation matches, it will apply the action for that configuration\n\t * \n\t * The Before Provisioning Rule configurations allows for the generic BeforeProvisioningRule to process common events based on standard best practices. \n\t * The configuration itself is a list of JSON Maps that include 2 basic concepts\n\t * \t\tTrigger: This configuration determines if this event should be applied based on\n\t * \t\t\tOperation of the account request\n\t * \t\t\tIdentity Attribute values for the user being modified\n\t * \t\t\tAttribute updates in the account request\n\t * \t\t\tEntitlement updates in the account request\n\t * \t\t\tEntitlement Name updates in the account request\n\t *\t\t\tEntitlement Cardinality Update Triggers: This checks if the account request contains \n\t *\t\t\t\tupdates on the entitlement to either add when previously empty or remove the last entitlement\n\t *\t\t\tCurrent Account Status Trigger: This checks the current status of the account\n\t * \t\tAction: This configuration determines what to do if this event should be applied. Available options are\n\t * \t\t\tMove AD Account: Adds AC_NewParent to the specified OU\n\t * \t\t\tChange Operation: changes the AccountRequest Operation to the specified operation\n\t * \t\t\tRemove Entitlements: removes all entitlements based on the account in IdentityNow\n\t * \t\t\tRemove Sticky Entitlements: removes all entitlements based on the account in IdentityNow; used to remove those granted through entitlement request\n\t * \t\t\tRemove AD Entitlements: sets the memberOf attribute to a list containing the one group\n\t * \t\t\tScramble Password: sets the specified attribute to a string of characters\n\t * \t\t\tUpdate Attribute: Adds the specified attribute with the specified value\n\t * \t\t\tAdd Argument: Adds the specified argument with the specified value\n \t * \t\t\tAdd Argument If Not Null: Adds the specified argument with the specified value. If the value is null, it ignores.\n \t *\t\t\tEntitlementMetaData: Add the specified Argument and correspoing ManagedAttributeDetails in the account Request\n \t *\t\t\tEntitlementMetaDataDuplicate: Add the specified Argument and correspoing ManagedAttributeDetails in the account Request if duplicate\n \t *\t\t\tEntitlementMetaDataExisting: Add the specified Argument and correspoing ManagedAttributeDetails in the existing account entitlements\n \t *\t\t\tEntitlementMetaDataExistingDuplicate: Add the specified Argument and ciorrespoing ManagedAttributeDetails in the existing account entitlements if duplicate\n\t * \t\t\tThrow Error: Throws an error specified in the value attribute or \"Unspecified Exception\"\n\t * \t\t\tStop Processing: Stops processing the BeforeProvisioningRule and proceeds to provisioning.\n\t */\npublic void applyEventConfigurations(ProvisioningPlan plan, List events) throws GeneralException{\n\t\tif(events == null) {\n\t\t\tlog.info(\"Events are null\");\n\t\t\treturn;\n\t\t}\n\t\tif(plan == null) {\n\t\t\tlog.error(\"Plan is null\");\n\t\t\treturn;\n\t\t}\n\t\tList accountRequests = plan.getAccountRequests();\n\t\tIdentity identity = plan.getIdentity();\n\t\tfor(AccountRequest accountRequest: accountRequests) {\n\t\t\tfor(Map event: events) {\n\t\t\t\t// Check if this request matches the event configuration\n\t\t\t\tlog.debug(\"Check AccountRequest \" + accountRequest + \" matches event configuration: \" + event);\n\t\t\t\tif(!isAccountRequestMatch(identity, accountRequest, event)) {\n\t\t\t\t\tlog.info(\"Match NOT Found\");\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// Found a match. need to apply the configurations associated\n\t\t\t\tlog.info(\"Match Found ... apply configurations\");\n\t\t\t\tList actionConfigs = (List) event.get(\"eventActions\");\n\t\t\t\tif(actionConfigs == null || actionConfigs.isEmpty()) {\n\t\t\t\t\tlog.error(\"No actions for event\");\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tfor(Map actionConfig: actionConfigs) {\n\t\t\t\t\t/*\n\t\t\t\t\t * Each action should have\n\t\t\t\t\t * \tAction: What to do\n\t\t\t\t\t *  Attribute: Specific to the action\n\t\t\t\t\t *  Value: Specific to the action\n\t\t\t\t\t */\n\t\t\t\t\tString action = (String) actionConfig.get(\"Action\");\n\t\t\t\t\tif(action == null) {\n\t\t\t\t\t\tlog.error(\"Action Config does not have Action set\");\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tString attribute = (String) actionConfig.get(\"Attribute\");\n\t\t\t\t\tObject value = (String) actionConfig.get(\"Value\");\n\t\t\t\t\tString attrOp = (String) actionConfig.get(\"Operation\");\n\t\t\t\t\t\n\t\t\t\t\tswitch(action) {\n\t\t\t\t\tcase \"ADMoveAccount\":moveADAccount(identity, accountRequest, value);break;\n\t\t\t\t\tcase \"ChangeOperation\":changeOperation(accountRequest, value);break;\n\t\t\t\t\tcase \"RemoveEntitlements\":removeEntitlements(identity, accountRequest, attribute);break;\n\t\t\t\t\tcase \"RemoveStickyEntitlements\":removeStickyEntitlements(identity, accountRequest, attribute);break;\n\t\t\t\t\tcase \"RemoveADEntitlements\":removeADEntitlements(identity, accountRequest, value);break;\n\t\t\t\t\tcase \"ScramblePassword\":scramblePassword(accountRequest, attribute, value);break;\n\t\t\t\t\tcase \"UpdateAttribute\":updateAttribute(identity, accountRequest, attribute, value);break;\n\t\t\t\t\tcase \"AddArgument\":addArgument(identity, accountRequest, attribute, value);break;\n\t\t\t\t\tcase \"AddArgumentIfNotNull\":addArgument(identity, accountRequest, attribute, value, true);break;\n\t\t\t\t\tcase \"EntitlementMetaData\":addEntMetaDataArgument(accountRequest, attribute, value, attrOp);break;\n\t\t\t\t\tcase \"EntitlementMetaDataExisting\":addExistingEntMetaDataArgument(accountRequest, attribute, value);break;\n\t\t\t\t\tcase \"EntitlementMetaDataExistingDuplicate\":addExistingEntMetaDataArgumentDuplicate(accountRequest, attribute, value);break;\n\t\t\t\t\tcase \"EntitlementMetaDataDuplicate\":addEntMetaDataArgumentDuplicate(accountRequest, attribute, value, attrOp);break;\n\t\t\t\t\tcase \"ThrowError\":throwError(identity, accountRequest, attribute, value);break;\n\t\t\t\t\tcase \"StopProcessing\":return;\n\t\t\t\t\tdefault: log.error(\"Invalid Action: \" + action);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\t\n\t\t/*\n\t * Helper Action Methods \n\t */\n\tpublic void moveADAccount(Identity identity, AccountRequest accountRequest, Object value) {\n\t\tlog.debug(\"Enter MoveADAccount: \" + value);\n\t\tif(accountRequest == null) {\n\t\t\tlog.error(\"MoveADAccount: Invalid Arguments: accountRequest is null\");\n\t\t\treturn;\n\t\t}\n\t\tif(value instanceof String) {\n\t\t\tlog.debug(\"MoveADAccount: value is a string, send through replace\");\n\t\t\tString newOU = replaceIdentityValue(identity, accountRequest, (String) value);\n\t\t\tlog.info(\"MoveADAccount: replaced new value: \" + newOU);\n\t\t\tString currentNativeIdentity = accountRequest.getNativeIdentity();\n\t\t\tif(currentNativeIdentity == null) {\n\t\t\t\tlog.error(\"moveADAccount: Invalid State: Current Native Identity is null\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif(newOU == null || \"\".equals(newOU)) {\n\t\t\t\tlog.error(\"moveADAccount: Invalid Arguments: newOU is null\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tint indexOfCurrentOU = currentNativeIdentity.indexOf(newOU);\n\t\t\tif(indexOfCurrentOU > 0 && !currentNativeIdentity.substring(0, indexOfCurrentOU).contains(\"OU=\")) {\n\t\t\t\tlog.info(\"moveADAccount: Account already lives in OU\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t//TODO: Uniqueness checks and serialization\n\t\t\taccountRequest.add(new AttributeRequest(\"AC_NewParent\", ProvisioningPlan.Operation.Set, newOU));\n\t\t}\n\t\telse{\n\t\t\tlog.error(\"MoveADAccount: value is not a string or is null: \" + value);\n\t\t}\n\t\tlog.debug(\"Exit MoveADAccount\");\n\t}\n\tpublic void changeOperation(AccountRequest accountRequest, Object value) {\n\t\tlog.debug(\"Enter changeOperation: \" + value);\n\t\tAccountRequest.Operation newOp = null;\n\t\ttry {\n\t\t\tnewOp = AccountRequest.Operation.valueOf((String) value);\n\t\t}\n\t\tcatch(IllegalArgumentException e) {\n\t\t\tlog.error(\"ChangeOperation: Invalid Operation: \" + value);\n\t\t}\n\t\tif(newOp != null) {\n\t\t\tlog.info(\"ChangeOperation: update Operation: \" + newOp);\n\t\t\taccountRequest.setOperation(newOp);\n\t\t}\n\t\tlog.debug(\"Exit changeOperation\");\n\t}\n\tpublic void removeEntitlements(Identity identity, AccountRequest accountRequest, String attribute) {\n\t\tlog.debug(\"Enter RemoveEntitlements: \" + attribute);\n\t\tif(accountRequest == null) {\n\t\t\tlog.error(\"RemoveEntitlements: Invalid Arguments: accountRequest is null\");\n\t\t\treturn;\n\t\t}\n\t\tif(attribute == null) {\n\t\t\tlog.error(\"RemoveEntitlements: Invalid Arguments: attribute is null\");\n\t\t\treturn;\n\t\t}\n\t\tif(identity == null) {\n\t\t\tlog.error(\"RemoveEntitlements: Invalid Arguments: Identity is null\");\n\t\t\treturn;\n\t\t}\n\n\t\tAccount account = getAccount(identity, accountRequest);\n\t\tif(null != idn.getRawAccountAttribute(account, attribute)) {\n\t\t\tList ents = asList(idn.getRawAccountAttribute(account, attribute));\n\t\t\tif(ents != null) {\n\t\t\t\taccountRequest.add(new AttributeRequest(attribute, ProvisioningPlan.Operation.Remove, ents));\n\t\t\t}\n\t\t}\n\t\tlog.debug(\"Exit RemoveEntitlements\");\n\t}\n\tpublic void removeStickyEntitlements(Identity identity, AccountRequest accountRequest, String attribute) {\n\t\tlog.debug(\"Enter removeStickyEntitlements: \" + attribute);\n\n\t\t//...null checks...\n\t\tAccount account = getAccount(identity, accountRequest);\n\t\tif(null != idn.getRawAccountAttribute(account, attribute)) {\n\t\t\tList ents = (List)idn.getRawAccountAttribute(account, attribute);\n\t\t\tif(ents != null) {\n\t\t\t\tAttributeRequest attrRequest = new AttributeRequest(attribute, ProvisioningPlan.Operation.Remove, ents);\n\t\t\t\tattrRequest.put(\"assignment\", true);\n\t\t\t\taccountRequest.add(attrRequest);\n\t\t\t}\n\t\t}\n\t\tlog.debug(\"Exit removeStickyEntitlements\");\n\t}\n\tpublic void removeADEntitlements(Identity identity, AccountRequest accountRequest, Object value) {\n\t\tlog.debug(\"Enter removeADEntitlements: \" + value);\n\t\tif(accountRequest == null) {\n\t\t\tlog.error(\"removeADEntitlements: Invalid Arguments: accountRequest is null\");\n\t\t\treturn;\n\t\t}\n\t\tString adDomainUsers = null;\n\t\tif(value == null) {\n\t\t\tlog.error(\"removeADEntitlements: Invalid Arguments: value is null\");\n\t\t\treturn;\n\t\t}\n\t\telse if(value instanceof String) {\n\t\t\tif(((String) value).contains(\"DC\")) {\n\t\t\t\tadDomainUsers = (String)value;\n\t\t\t}\n\t\t}\n\t\tif(adDomainUsers == null) {\n\t\t\tlog.error(\"removeADEntitlements: Invalid Arguments: value is not valid\");\n\t\t\treturn;\n\t\t}\n\t\tif(identity == null) {\n\t\t\tlog.error(\"removeADEntitlements: Invalid Arguments: Identity is null\");\n\t\t\treturn;\n\t\t}\n\t\tList groupList = new ArrayList();\n\t\tgroupList.add(adDomainUsers);\n\t\taccountRequest.add(new AttributeRequest(\"memberOf\", ProvisioningPlan.Operation.Set, groupList));\n\t\tlog.debug(\"Exit RemoveEntitlements\");\n\t}\n\tpublic void scramblePassword(AccountRequest accountRequest, String attribute, Object value) {\n\t\tlog.debug(\"Enter ScramblePassword\");\n\t\tif(accountRequest == null) {\n\t\t\tlog.error(\"UpdateAttribute: Invalid Arguments: accountRequest is null\");\n\t\t\treturn;\n\t\t}\n\t\tif(attribute == null) {\n\t\t\tlog.error(\"UpdateAttribute: Invalid Arguments: attribute is null\");\n\t\t\treturn;\n\t\t}\n\t\tString newPassword = \"\";\n\t\tString charset = \"ABNCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz1234567890!@#$%^&*()_+-={}[]:;<>?,./\";\n\t\tint count;\n\t\tint index;\n\t\tint len;\n\t\tRandom rnd = new Random();\n\t\tlen = charset.length();\n\t\tfor (count = 0; count < 18; count++) {\n\t\t\tindex = rnd.nextInt(len);\n\t\t\tnewPassword += charset.charAt(index);\n\t\t}\n\t\taccountRequest.add(new AttributeRequest(attribute, ProvisioningPlan.Operation.Set, newPassword));\n\t\t//TODO: Update to use PasswordGenerator\n\t\tlog.debug(\"Exit ScramblePassword\");\n\t}\n\tpublic void updateAttribute(Identity identity, AccountRequest accountRequest, String attribute, Object value) {\n\t\tlog.debug(\"Enter UpdateAttribute: \" + value);\n\t\tif(accountRequest == null) {\n\t\t\tlog.error(\"UpdateAttribute: Invalid Arguments: accountRequest is null\");\n\t\t\treturn;\n\t\t}\n\t\tif(attribute == null) {\n\t\t\tlog.error(\"UpdateAttribute: Invalid Arguments: attribute is null\");\n\t\t\treturn;\n\t\t}\n\t\tObject newValue = null;\n\t\tif(value instanceof String) {\n\t\t\tlog.debug(\"UpdateAttribute: value is a string, send through replace\");\n\t\t\tnewValue = replaceIdentityValue(identity, accountRequest, (String) value);\n\t\t\tlog.info(\"UpdateAttribute: replaced new value: \" + newValue );\n\t\t}\n\t\telse{\n\t\t\tlog.debug(\"UpdateAttribute: value is not a string or is null: \" + value);\n\t\t\tnewValue = value;\n\t\t}\n\t\taccountRequest.add(new AttributeRequest(attribute, ProvisioningPlan.Operation.Set, newValue));\n\t\tlog.debug(\"Exit UpdateAttribute\");\n\t}\n\tpublic void addArgument(Identity identity, AccountRequest accountRequest, String attribute, Object value) {\n\t\tlog.debug(\"Enter AddArgument without ignoreIfNotNull ... calling other method with a false\");\n\t\taddArgument(identity, accountRequest, attribute, value, false);\n\t}\n\tpublic void addArgument(Identity identity, AccountRequest accountRequest, String attribute, Object value, boolean ignoreIfNotNull) {\n\t\tlog.debug(\"Enter AddArgument: \" + value);\n\t\tlog.debug(\"Ignore If Not Null: \" + ignoreIfNotNull);\n\t\tif(accountRequest == null) {\n\t\t\tlog.error(\"AddArgument: Invalid Arguments: accountRequest is null\");\n\t\t\treturn;\n\t\t}\n\t\tif(attribute == null) {\n\t\t\tlog.error(\"AddArgument: Invalid Arguments: attribute is null\");\n\t\t\treturn;\n\t\t}\n\t\tObject newValue = null;\n\t\tList lsExistingEnt = new ArrayList();\n\t\tif(value instanceof String) {\n\t\t\t\n\t\tnewValue = replaceIdentityValue(identity, accountRequest, (String) value);\n\t\tString objString = String.valueOf(newValue);\n\t\t\tif (objString.startsWith(\"[\")) {\n\t\t\t\tString strippedString = objString.substring(1, objString.length() - 1);\n\t\t\t\tList stringList = Util.filterNulls(Util.csvToList(strippedString));\n\t\t\t\tif (stringList.size() == 1) {\n\t\t\t\t\tnewValue = (String) stringList.get(0);\n\t\t\t\t\tlog.debug(\"AddArgument: Single Value::\" + newValue);\n\t\t\t\t} else {\n\t\t\t\t\tnewValue =lsExistingEnt;\n\t\t\t\t}\n\t\t\t}\n\t\t\tlog.info(\"AddArgument: replaced new value: \" + newValue);\n\t\t}\n\t\telse{\n\t\t\tlog.debug(\"AddArgument: value is not a string or is null: \" + value);\n\t\t\tnewValue = value;\n\t\t}\n\t\tAttributes args = accountRequest.getArguments();\n\t\tif(args == null) {\n\t\t\targs = new Attributes();\n\t\t\taccountRequest.setArguments(args);\n\t\t}\n\t\tif((newValue == null || newValue.toString().isEmpty()) && ignoreIfNotNull) {\n\t\t\tlog.debug(\"AddArgument: value is null and ignoreIfNotNull is true ... ignoring\");\n\t\t}\n\t\telse {\t\t\n\t\t\targs.put(attribute, newValue);\n\t\t\tlog.debug(\"AddArgument: setting value\");\n\t\t}\n\t\tlog.debug(\"Exit AddArgument\");\n\t}\n\t\n\t\n\tpublic void addMetaDataArgument(AccountRequest accountRequest, String attribute, Object value) throws GeneralException {\n\t\tlog.debug(\"Enter addMetaDataArgument: \" + value);\n\t\tif (accountRequest == null) {\n\t\t\tlog.error(\"addMetaDataArgument: Invalid Arguments: accountRequest is null\");\n\t\t\treturn;\n\t\t}\n\t\tif (attribute == null) {\n\t\t\tlog.error(\"addMetaDataArgument: Invalid Arguments: attribute is null\");\n\t\t\treturn;\n\t\t}\n\t\tObject newValue = value;\n\t\tAttributes args = accountRequest.getArguments();\n\t\tif (args == null) {\n\t\t\targs = new Attributes();\n\t\t\taccountRequest.setArguments(args);\n\t\t}\n\t\tif ((newValue == null || newValue.toString().isEmpty())) {\n\t\t\tlog.debug(\"addMetaDataArgument: value is null and ignoreIfNotNull is true ... ignoring\");\n\t\t} else {\n\t\t\t\n\t\t\targs.put(attribute, newValue);\n\t\t\tlog.debug(\"addMetaDataArgument: setting value\");\n\t\t}\n\t\tlog.debug(\"Exit addMetaDataArgument\");\n\t}\n\n\tpublic void addEntMetaDataArgument(AccountRequest accountRequest, String attribute,\n\t\t\tObject value, String attrOp) throws GeneralException {\n\t\tlog.debug(\"Starting addEntMetaDataArgument::\");\n\t\tString strEntAttr = (String) value;\n\t\tlog.debug(\"addEntMetaDataArgument:: Attr:\" + strEntAttr);\n\t\tMap mapFinalMgd = new HashMap();\n\t\tList entAttrReqs = accountRequest.getAttributeRequests(strEntAttr);\n\t\tif (entAttrReqs != null) {\n\t\t\tfor (AttributeRequest entAttrReq : entAttrReqs) {\n\t\t\t\tboolean doCompare = false;\n\t\t\t\tif (\"Add\".equals(attrOp) && entAttrReq.getOperation() == ProvisioningPlan.Operation.Add) {\n\t\t\t\t\tlog.debug(\"Looking at an Add and operation in action is Add\");\n\t\t\t\t\tdoCompare = true;\n\t\t\t\t} else if (\"Remove\".equals(attrOp) && entAttrReq.getOperation() == ProvisioningPlan.Operation.Remove) {\n\t\t\t\t\tlog.debug(\"Looking at an Remove and operation in action is Remove\");\n\t\t\t\t\tdoCompare = true;\n\t\t\t\t} else if (\"Set\".equals(attrOp) && entAttrReq.getOperation() == ProvisioningPlan.Operation.Set) {\n\t\t\t\t\tlog.debug(\"Looking at an Set and operation in action is Set\");\n\t\t\t\t\tdoCompare = true;\n\t\t\t\t}\n\t\t\t\t\tList valuesUpdated = asList(entAttrReq.getValue());\n\t\t\t\t\tif (valuesUpdated != null) {\n\t\t\t\t\t\tfor (String entvalue : valuesUpdated) {\n\t\t\t\t\t\t\tManagedAttributeDetails entDetails = idn.getManagedAttributeDetails(application.getId(), strEntAttr, entvalue, Type.Entitlement);\n\t\t\t\t\t\t\tMap entAttrs = entDetails != null ? entDetails.getAttributes() : null;\n\t\t\t\t\t\tif (doCompare) {\n\t\t\t\t\t\t\tmapFinalMgd.put(entvalue, entAttrs);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tmapFinalMgd.put(entvalue, entAttrs);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\t\n\t\t\t}\n\t\t}\n\t\tlog.debug(\"addEntMetaDataArgument:: Entilement attribute:\"+mapFinalMgd);\t\n\t\taddMetaDataArgument(accountRequest, attribute, mapFinalMgd);\n\t\tlog.debug(\"Exit addEntMetaDataArgument::\");\n\t}\n}\n\npublic void addExistingEntMetaDataArgument(AccountRequest accountRequest, String attribute,\n\t\t\t\tObject entAttr) throws GeneralException {\n\t\t\tlog.debug(\"Starting addExistingEntMetaDataArgument::\");\n\t\t\t\n\t\t\tString strEntAttr = (String) entAttr;\n\t\t\tlog.debug(\"addExistingEntMetaDataArgument:: Attr:\"+strEntAttr);\t\t\n\t\t\tMap mapFinalMgd = new HashMap();\n\t\t\tList lsexisting = entAccountValue(accountRequest, strEntAttr);;\n\t\t\tif (lsexisting != null) {\n\t\t\t\tfor (String entvalue : lsexisting) {\n\t\t\t\t\tManagedAttributeDetails entDetails = idn.getManagedAttributeDetails(application.getId(), strEntAttr, entvalue, Type.Entitlement);\n\t\t\t\t\tMap entAttrs = entDetails != null ? entDetails.getAttributes() : null;\n\t\t\t\t\tmapFinalMgd.put(entvalue, entAttrs);\n\t\t\t}\t\n\t\t\tlog.debug(\"addExistingEntMetaDataArgument:: Entilement attribute:\"+mapFinalMgd);\t\n\t\t\taddMetaDataArgument(accountRequest, attribute, mapFinalMgd);\n\t\t\tlog.debug(\"Exit addExistingEntMetaDataArgument::\");\n\t\t}\n}\n\n\tpublic void addEntMetaDataArgumentDuplicate(AccountRequest accountRequest, String attribute,\n\t\t\tObject value, String attrOp) throws GeneralException {\n\t\tlog.debug(\"Starting addEntMetaDataArgumentDuplicate::\");\n\t\tString strEntAttr = (String) value;\n\t\tlog.debug(\"addEntMetaDataArgumentDuplicate:: Attr:\" + strEntAttr);\n\t\tMap mapFinalMgd = new HashMap();\n\t\tList entAttrReqs = accountRequest.getAttributeRequests(strEntAttr);\n\t\tif (entAttrReqs != null) {\n\t\t\tfor (AttributeRequest entAttrReq : entAttrReqs) {\n\t\t\t\tboolean doCompare = false;\n\t\t\t\tif (\"Add\".equals(attrOp) && entAttrReq.getOperation() == ProvisioningPlan.Operation.Add) {\n\t\t\t\t\tlog.debug(\"Looking at an Add and operation in action is Add\");\n\t\t\t\t\tdoCompare = true;\n\t\t\t\t} else if (\"Remove\".equals(attrOp) && entAttrReq.getOperation() == ProvisioningPlan.Operation.Remove) {\n\t\t\t\t\tlog.debug(\"Looking at an Remove and operation in action is Remove\");\n\t\t\t\t\tdoCompare = true;\n\t\t\t\t} else if (\"Set\".equals(attrOp) && entAttrReq.getOperation() == ProvisioningPlan.Operation.Set) {\n\t\t\t\t\tlog.debug(\"Looking at an Set and operation in action is Set\");\n\t\t\t\t\tdoCompare = true;\n\t\t\t\t}\n\t\t\t\t\tList valuesUpdated = asList(entAttrReq.getValue());\n\t\t\t\t\tif (valuesUpdated != null) {\n\t\t\t\t\t\tfor (String entvalue : valuesUpdated) {\n\t\t\t\t\t\t\tManagedAttributeDetails entDetails = idn.getManagedAttributeDetails(application.getId(), strEntAttr, entvalue, Type.Entitlement);\n\t\t\t\t\t\t\tMap entAttrs = entDetails != null ? entDetails.getAttributes() : null;\n\t\t\t\t\t\tif (doCompare) {\n\t\t\t\t\t\t\tmapFinalMgd.put(attribute+\"::\"+entvalue, entAttrs);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tmapFinalMgd.put(attribute+\"::\"+entvalue, entAttrs);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\t\n\t\t\t}\n\t\t}\n\t\tlog.debug(\"addEntMetaDataArgumentDuplicate:: Entilement attribute:\"+mapFinalMgd);\t\n\t\taddMetaDataArgument(accountRequest, attribute, mapFinalMgd);\n\t\tlog.debug(\"Exit addEntMetaDataArgumentDuplicate::\");\n\t}\n}\n\npublic void addExistingEntMetaDataArgumentDuplicate(AccountRequest accountRequest, String attribute,\n\t\t\t\tObject entAttr) throws GeneralException {\n\t\t\tlog.debug(\"Starting addExistingEntMetaDataArgumentDuplicate::\");\n\t\t\t\n\t\t\tString strEntAttr = (String) entAttr;\n\t\t\tlog.debug(\"addExistingEntMetaDataArgumentDuplicate:: Attr:\"+strEntAttr);\t\t\n\t\t\tMap mapFinalMgd = new HashMap();\n\t\t\tList lsexisting = entAccountValue(accountRequest, strEntAttr);;\n\t\t\tif (lsexisting != null) {\n\t\t\t\tfor (String entvalue : lsexisting) {\n\t\t\t\t\tManagedAttributeDetails entDetails = idn.getManagedAttributeDetails(application.getId(), strEntAttr, entvalue, Type.Entitlement);\n\t\t\t\t\tMap entAttrs = entDetails != null ? entDetails.getAttributes() : null;\n\t\t\t\t\tmapFinalMgd.put(attribute+\"::\"+entvalue, entAttrs);\n\t\t\t}\t\n\t\t\tlog.debug(\"addExistingEntMetaDataArgumentDuplicate:: Entilement attribute:\"+mapFinalMgd);\t\n\t\t\taddMetaDataArgument(accountRequest, attribute, mapFinalMgd);\n\t\t\tlog.debug(\"Exit addExistingEntMetaDataArgumentDuplicate::\");\n\t\t}\n}\n\t\n\tpublic void throwError(Identity identity, AccountRequest accountRequest, String attribute, Object value) throws GeneralException {\n\t\tlog.debug(\"Enter throwError: \" + value);\n\t\tif(value instanceof String)\n\t\t\tthrow new GeneralException((String) value);\n\t\telse {\n\t\t\tthrow new GeneralException(\"Unspecified Exception\");\n\t\t}\n\t}\n\t\n\t/*\n\t * Helper Matching Methods\n\t */\n\t \n\t/*\n\t * This is the main matching method. It will check the operation of the account request first.\n\t * Operation is the only required check. If there are not triggers, then every request of that operation matches.\n\t * if the operation matches, it will then check to see if everything of the following matches. These are all AND matches \n\t * \t\tIdentity Attribute Triggers: Validating against the identity\n\t * \t\tAccount Attribute Update Triggers: Validating against updates in the account request\n\t * \t\tAccount Attribute Current Triggers: Validating against current values in the account request\n\t * \t\tEntitlement Update Triggers: Similar to Account Attribute Update Triggers, but checking multivalued attributes Add or Remove\n\t * \t\tEntitlement Name Update Triggers: Similar to Entitlement Update Triggers, but the entitlement's name is checked instead of value.\n\t * \t\t\n\t */\n\tpublic boolean isAccountRequestMatch(Identity identity, AccountRequest accountRequest, Map event) {\n\t\tlog.debug(\"Enter isAccountRequestMatch: \" + accountRequest + \" on event \" + event);\n\t\tString opCheck = (String) event.get(\"Operation\");\n\t\tif(accountRequest.getOperation().toString().equals(opCheck)) {\n\t\t\tlog.debug(\"Account Request matches op of event: \" + opCheck);\n\n\t\t\tlog.debug(\"Check for Identity Attribute Triggers\");\n\t\t\tList idAttrTriggers = (List) event.get(\"Identity Attribute Triggers\");\n\t\t\tif(idAttrTriggers != null && !idAttrTriggers.isEmpty()) {\n\t\t\t\tfor(Map trigger: idAttrTriggers) {\n\t\t\t\t\tif(isIdentityAttributeConfigMatch(identity, trigger)) {\n\t\t\t\t\t\tlog.debug(\"Identity \" + identity + \" matches \" + trigger);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tlog.debug(\"Identity \" + identity + \" doesn't match \" + trigger);\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlog.debug(\"Checking for Account Attribute Update Triggers\");\n\t\t\tList acctAttrUpdateTriggers = (List) event.get(\"Account Attribute Update Triggers\");\n\t\t\tif(acctAttrUpdateTriggers != null && !acctAttrUpdateTriggers.isEmpty()) {\n\t\t\t\tfor(Map trigger: acctAttrUpdateTriggers) {\n\t\t\t\t\tif(isAccountAttributeUpdateConfigMatch(accountRequest, trigger)) {\n\t\t\t\t\t\tlog.debug(\"Request matches \" + trigger);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tlog.debug(\"Request doesn't match \" + trigger);\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlog.debug(\"Checking for Account Attribute Current Triggers\");\n\t\t\tList acctAttrCurrentTriggers = (List) event.get(\"Account Attribute Current Triggers\");\n\t\t\tlog.debug(\"Account Attribute Current Triggers: \" + acctAttrCurrentTriggers);\n\t\t\tif(acctAttrCurrentTriggers != null && !acctAttrCurrentTriggers.isEmpty()) {\n\t\t\t\tfor(Map trigger: acctAttrCurrentTriggers) {\n\t\t\t\t\tif(isAccountAttributeCurrentConfigMatch(identity, accountRequest, trigger)) {\n\t\t\t\t\t\tlog.debug(\"Request matches \" + trigger);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tlog.debug(\"Request doesn't match \" + trigger);\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlog.debug(\"Check for Entitlement Update Triggers\");\n\t\t\tList entUpdateTriggers = (List) event.get(\"Entitlement Update Triggers\");\n\t\t\tif(entUpdateTriggers != null && !entUpdateTriggers.isEmpty()) {\n\t\t\t\tfor(Map trigger: entUpdateTriggers) {\n\t\t\t\t\tif(isEntitlementUpdateConfigMatch(accountRequest, trigger)) {\n\t\t\t\t\t\tlog.debug(\"Request matches \" + trigger);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tlog.debug(\"Request doesn't match \" + trigger);\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlog.debug(\"Check for Entitlement Name Update Triggers\");\n\t\t\tList entNameUpdateTriggers = (List) event.get(\"Entitlement Name Update Triggers\");\n\t\t\tif(entNameUpdateTriggers != null && !entNameUpdateTriggers.isEmpty()) {\n\t\t\t\tfor(Map trigger: entNameUpdateTriggers) {\n\t\t\t\t\tif(isEntitlementNameUpdateConfigMatch(accountRequest, trigger)) {\n\t\t\t\t\t\tlog.debug(\"Request matches \" + trigger);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tlog.debug(\"Request doesn't match \" + trigger);\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlog.debug(\"Check for Entitlement Cardinality Update Triggers\");\n\t\t\tList cardinalityChangeTriggers = (List) event.get(\"Entitlement Cardinality Update Triggers\");\n\t\t\tif(cardinalityChangeTriggers != null && !cardinalityChangeTriggers.isEmpty()) {\n\t\t\t\tfor(Map trigger: cardinalityChangeTriggers) {\n\t\t\t\t\tif(isCardinalityMatch(accountRequest, trigger)) {\n\t\t\t\t\t\tlog.debug(\"Request matches \" + trigger);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tlog.debug(\"Request doesn't match \" + trigger);\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlog.debug(\"Check for Current Account Status Trigger\");\n\t\t\tString accountStatusCheck = (String) event.get(\"Current Account Status Trigger\");\n\t\t\tif(accountStatusCheck != null && !accountStatusCheck.equals(\"\")) {\n\t\t\t\tif(isAccountStatusMatch(accountRequest, accountStatusCheck)) {\n\t\t\t\t\tlog.debug(\"Request existing account status matches \" + accountStatusCheck);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tlog.debug(\"Request existing account status doesn't match \" + accountStatusCheck);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tlog.debug(\"AccountRequest \" + accountRequest + \" doesn't match operation check: \" + opCheck);\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\tpublic boolean isAccountAttributeUpdateConfigMatch(AccountRequest accountRequest, Map trigger) {\n\t\tif(trigger == null) {\n\t\t\tlog.error(\"Error isAccountAttributeUpdateConfigMatch Configuration: trigger is null\");\n\t\t\treturn false;\n\t\t}\n\t\tString attr = (String) trigger.get(\"Attribute\");\n\t\tString op = (String) trigger.get(\"Operation\");\n\t\tString val = (String) trigger.get(\"Value\");\n\t\tif(attr == null) {\n\t\t\tlog.error(\"Error Configuration: attribute is null\");\n\t\t\treturn false;\n\t\t}\n\t\tif(!\"eq\".equals(op) && !\"ne\".equals(op)) {\n\t\t\tlog.error(\"Error Configuration: operation is invalid: \" + op);\n\t\t\treturn false;\n\t\t}\n\t\tList attrReqs = accountRequest.getAttributeRequests();\n\t\tif(attrReqs != null) {\n\t\t\tfor(AttributeRequest attrReq: attrReqs) {\n\t\t\t\tif(attr.equals(attrReq.getName())) {\n\t\t\t\t\tObject attrVal = attrReq.getValue();\n\t\t\t\t\tboolean valsMatch = isValueMatch(attrVal, val);\n\t\t\t\t\tif(\"eq\".equals(op) && !valsMatch) {\n\t\t\t\t\t\tlog.debug(\"Check for eq did not match: \" + attrVal + \" vs \" + val);\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\tif(\"ne\".equals(op) && valsMatch) {\n\t\t\t\t\t\tlog.debug(\"Check for ne matched: \" + attrVal + \" vs \" + val);\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\tlog.debug(\"Found match for attribute change \" + op + \" \" + val);\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\tpublic boolean isAccountAttributeCurrentConfigMatch(Identity identity, AccountRequest accountRequest, Map trigger) {\n\t\tlog.debug(\"isAccountAttributeCurrentConfigMatch identity: \" + identity + \" accountRequest: \" + accountRequest + \" trigger: \" + trigger);\n\n\t\tif(trigger == null) {\n\t\t\tlog.error(\"Error isAccountAttributeCurrentConfigMatch Configuration: trigger is null\");\n\t\t\treturn false;\n\t\t}\n\n\t\tString attr = (String) trigger.get(\"Attribute\");\n\t\tString op = (String) trigger.get(\"Operation\");\n\t\tString val = (String) trigger.get(\"Value\");\n\n\t\tif(attr == null) {\n\t\t\tlog.error(\"Error Configuration: attribute is null\");\n\t\t\treturn false;\n\t\t}\n\n\t\tif(!\"eq\".equals(op) && !\"ne\".equals(op)) {\n\t\t\tlog.error(\"Error Configuration: operation is invalid: \" + op);\n\t\t\treturn false;\n\t\t}\n\n\t\tif(attr == null) {\n\t\t\tlog.error(\"Error Configuration: attribute is null\");\n\t\t\treturn false;\n\t\t}\n\n\t\tAccount acct = getAccount(identity, accountRequest);\n\t\tif(acct == null) {\n\t\t\tlog.debug(\"Account was null\");\n\t\t\treturn false;\n\t\t}\n\n\t\tMap accountAttributes = acct.getAttributes();\n\t\tif(accountAttributes == null) {\n\t\t\tlog.debug(\"accountAttributes was null\");\n\t\t\treturn false;\n\t\t}\n\n\t\tString currentValue = accountAttributes.get(attr);\n\t\tlog.debug(\"currentValue is: \" + currentValue);\n\n\t\tboolean valsMatch = isValueMatch(currentValue, val);\n\t\tif(\"eq\".equals(op) && !valsMatch) {\n\t\t\tlog.debug(\"Check for eq did not match: \" + currentValue + \" vs \" + val);\n\t\t\treturn false;\n\t\t}\n\t\tif(\"ne\".equals(op) && valsMatch) {\n\t\t\tlog.debug(\"Check for ne matched: \" + currentValue + \" vs \" + val);\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\tpublic boolean isIdentityAttributeConfigMatch(Identity identity, Map trigger) {\n\t\tlog.debug(\"Enter isIdentityAttributeConfigMatch: \" + identity + \" \" + trigger);\n\t\tif(trigger == null) {\n\t\t\tlog.error(\"Error isIdentityAttributeConfigMatch Configuration: trigger is null\");\n\t\t\treturn false;\n\t\t}\n\t\tString attr = (String) trigger.get(\"Attribute\");\n\t\tString op = (String) trigger.get(\"Operation\");\n\t\tString val = (String) trigger.get(\"Value\");\n\t\tif(attr == null) {\n\t\t\tlog.error(\"Error Configuration: attribute is null\");\n\t\t\treturn false;\n\t\t}\n\t\tif(!\"eq\".equals(op) && !\"ne\".equals(op)) {\n\t\t\tlog.error(\"Error Configuration: operation is invalid: \" + op);\n\t\t\treturn false;\n\t\t}\n\t\tlog.debug(\"Replace value: \" + val);\n\t\tObject idVal = identity.getAttribute(attr);\n\t\tboolean valsMatch = isValueMatch(idVal, val);\n\t\tif(\"eq\".equals(op) && !valsMatch) {\n\t\t\tlog.debug(\"Check for eq did not match: \" + idVal + \" vs \" + val);\n\t\t\treturn false;\n\t\t}\n\t\tif(\"ne\".equals(op) && valsMatch) {\n\t\t\tlog.debug(\"Check for ne matched: \" + idVal + \" vs \" + val);\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\tpublic boolean isEntitlementUpdateConfigMatch(AccountRequest accountRequest, Map trigger) {\n\t\tlog.debug(\"Enter isEntitlementUpdateConfigMatch: \" + identity + \" \" + trigger);\n\t\tif(trigger == null) {\n\t\t\tlog.error(\"Error isEntitlementUpdateConfigMatch Configuration: trigger is null\");\n\t\t\treturn false;\n\t\t}\n\t\tString attr = (String) trigger.get(\"Attribute\");\n\t\tString op = (String) trigger.get(\"Operation\");\n\t\tString val = (String) trigger.get(\"Value\");\n\t\tif(attr == null) {\n\t\t\tlog.error(\"Error Configuration: attribute is null\");\n\t\t\treturn false;\n\t\t}\n\t\tif(!\"Add\".equals(op) && !\"Remove\".equals(op) && !\"Set\".equals(op)) {\n\t\t\tlog.error(\"Error Configuration: operation is invalid: \" + op);\n\t\t\treturn false;\n\t\t}\n\t\tlog.debug(\"Check change in group: \" + val);\n\t\tboolean foundMatch = false;\n\t\tList entAttrReqs = accountRequest.getAttributeRequests(attr);\n\t\tif(entAttrReqs != null) {\n\t\t\tfor(AttributeRequest entAttrReq: entAttrReqs) {\n\t\t\t\tboolean doCompare = false;\n\t\t\t\tif(\"Add\".equals(op) && entAttrReq.getOperation() == ProvisioningPlan.Operation.Add) {\n\t\t\t\t\tlog.debug(\"Looking at an Add and operation in trigger is Add\");\n\t\t\t\t\tdoCompare = true;\n\t\t\t\t}\n\t\t\t\telse if(\"Remove\".equals(op) && entAttrReq.getOperation() == ProvisioningPlan.Operation.Remove) {\n\t\t\t\t\tlog.debug(\"Looking at an Remove and operation in trigger is Remove\");\n\t\t\t\t\tdoCompare = true;\n\t\t\t\t}\n\t\t\t\telse if(\"Set\".equals(op) && entAttrReq.getOperation() == ProvisioningPlan.Operation.Set) {\n\t\t\t\t\tlog.debug(\"Looking at an Set and operation in trigger is Set\");\n\t\t\t\t\tdoCompare = true;\n\t\t\t\t}\n\t\t\t\tif(doCompare) {\n\t\t\t\t\tList valuesUpdated = asList(entAttrReq.getValue());\n\t\t\t\t\tif(valuesUpdated != null) {\n\t\t\t\t\t\tfor(String update: valuesUpdated){\n\t\t\t\t\t\t\tif(isValueMatch(update, val)) {\n\t\t\t\t\t\t\t\tfoundMatch = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn foundMatch;\n\t}\n\n\tpublic boolean isCardinalityMatch(AccountRequest accountRequest, Map trigger) {\n\t\tlog.debug(\"Enter isCardinalityMatch: \" + accountRequest + \" \" + trigger);\n\t\tif(trigger == null) {\n\t\t\tlog.error(\"Error isCardinalityMatch Configuration: trigger is null\");\n\t\t\treturn false;\n\t\t}\n\t\tString attr = (String) trigger.get(\"Attribute\");\n\t\tString op = (String) trigger.get(\"Operation\");\n\t\t\n\n\t\tif(attr == null) {\n\t\t\tlog.error(\"Error Configuration: attribute is null\");\n\t\t\treturn false;\n\t\t}\n\n\t\tif(op == null) {\n\t\t\tlog.error(\"Error Configuration: operation is null\");\n\t\t\treturn false;\n\t\t}\n\t\tIdentity identity = plan.getIdentity();\n\t\tlog.debug(\"Have Identity: \" + identity);\n\t\tAccount acct = getAccount(identity, accountRequest);\n\t\tlog.debug(\"Have acct: \" + acct);\n\t\tif(acct == null) {\n\t\t\tlog.error(\"Error Configuration: account doesn't exist\");\n\t\t\treturn false;\n\t\t}\n\t\t\n\t\tString scenario = \"\";\n\t\tif (op.toUpperCase().equals(\"LASTREMOVED\")) {\n\t\t\tscenario = \"LASTREMOVED\";\n\t\t}\n\t\telse if (op.toUpperCase().equals(\"FIRSTADDED\")) {\n\t\t\tscenario = \"FIRSTADDED\";\n\t\t}\n\t\telse {\n\t\t\t//Currently, we only care if we are adding the first or removing the last.\n\t\t\t//Therefore, only the configuration combinations above are valid.\n\t\t\t//Theorertically we can expand this to look at arbitrary\n\t\t\t//cardinalities and comparators\n\t\t\tlog.error(\"Error Configuration: operation is invalid: \" + op);\n\t\t\treturn false;\n\t\t}\n\n\t\tlog.debug(\"Check change in group cardinality for attribute \" + attr);\n\t\tboolean foundMatch = false;\n\t\tMap pendingChangeMap = new HashMap();\n\t\tList entAttrReqs = accountRequest.getAttributeRequests(attr);\n\t\tlog.debug(\"Have entAttrReqs: \" + entAttrReqs);\n\t\tif(entAttrReqs != null && !entAttrReqs.isEmpty()) {\n\t\t\tfor(Object entAttrReqObj: entAttrReqs) {\n\t\t\t\tAttributeRequest entAttrReq = (AttributeRequest) entAttrReqObj;\n\t\t\t\tboolean collectForAnalysis = false;\n\t\t\t\tif(entAttrReq.getOperation() == ProvisioningPlan.Operation.Add) {\n\t\t\t\t\tlog.debug(\"Looking at an Add and operation in trigger has cardinality 1\");\n\t\t\t\t\tcollectForAnalysis = true;\n\t\t\t\t}\n\t\t\t\telse if(entAttrReq.getOperation() == ProvisioningPlan.Operation.Remove) {\n\t\t\t\t\tlog.debug(\"Looking at a Remove and operation in trigger has cardinality 0\");\n\t\t\t\t\tcollectForAnalysis = true;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t//Currently, we are ignoring set commands because \n\t\t\t\t\t//in most instances this should not result in a \n\t\t\t\t\t//change in cardinality. However, we may want to\n\t\t\t\t\t//add this feature one day to support potential\n\t\t\t\t\t//corner cases or plans that have not been compiled\n\t\t\t\t\t//against an accurate account model.\n\t\t\t\t\tlog.debug(\"Not an add or remove. Ignoring attribute request\");\n\t\t\t\t\tcollectForAnalysis = false;\n\t\t\t\t}\n\t\t\t\tif(collectForAnalysis) {\n\t\t\t\t\tList valuesUpdated = asList(entAttrReq.getValue());\n\t\t\t\t\tList changesForOperation = (List) pendingChangeMap.get(entAttrReq.getOperation());\n\t\t\t\t\tif (changesForOperation != null) {\n\t\t\t\t\t\tchangesForOperation.addAll(valuesUpdated);\n\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tchangesForOperation = new ArrayList();\n\t\t\t\t\t\tchangesForOperation.addAll(valuesUpdated);\n\t\t\t\t\t}\n\t\t\t\t\tpendingChangeMap.put(entAttrReq.getOperation(), changesForOperation);\n\t\t\t\t\tlog.debug(\"Updated map after request: \" + pendingChangeMap);\n\t\t\t\t}\n\t\t\t}\n\t\t\tList currentValues = asList(idn.getRawAccountAttribute(acct, attr));\n\t\t\tlog.debug(\"currentValues: \" + currentValues);\n\n\t\t\tint initialValuesSize = 0;\n\t\t\tif (currentValues != null && currentValues.size() > 0) {\n\t\t\t\tinitialValuesSize = currentValues.size();\n\t\t\t}\n\t\t\telse {\n\t\t\t\tcurrentValues = new ArrayList();\n\t\t\t}\n\t\t\tlog.debug(\"initialValuesSize: \" + initialValuesSize);\n\t\t\tList valuesToAdd = (List) pendingChangeMap.get(ProvisioningPlan.Operation.Add);\n\t\t\tif (valuesToAdd != null) {\n\t\t\t\tcurrentValues.addAll(valuesToAdd);\n\t\t\t}\n\t\t\tList valuesToRemove = (List) pendingChangeMap.get(ProvisioningPlan.Operation.Remove);\n\t\t\tif (valuesToRemove != null) {\n\t\t\t\tcurrentValues.removeAll(valuesToRemove);\n\t\t\t}\n\t\t\tint targetValuesSize = currentValues.size();\n\t\t\tlog.debug(\"targetValuesSize: \" + targetValuesSize);\n\t\t\tif (\"FIRSTADDED\".equals(scenario) && initialValuesSize == 0 && targetValuesSize > 0) {\n\t\t\t\tfoundMatch = true;\n\t\t\t}\n\t\t\telse if (\"LASTREMOVED\".equals(scenario) && initialValuesSize > 0 && targetValuesSize == 0) {\n\t\t\t\tfoundMatch = true;\n\t\t\t}\n\t\t}\n\t\treturn foundMatch;\n\t}\n\n\tpublic boolean isAccountStatusMatch(AccountRequest accountRequest, String status) {\n\t\tlog.debug(\"Enter isAccountStatusMatch: \" + accountRequest + \" \" + status);\n\t\tif(status == null) {\n\t\t\tlog.error(\"Error Configuration: Status is null\");\n\t\t\treturn false;\n\t\t}\n\n\t\tIdentity identity = plan.getIdentity();\n\t\tAccount acct = getAccount(identity, accountRequest);\n\n\t\tif (acct == null) {\n\t\t\t//This is likely a create operation, so we can't match\n\t\t\tlog.debug(\"Exit isAccountStatusMatch: no account\");\n\t\t\treturn false;\n\t\t}\n\t\t\n\t\tif (status.toUpperCase().equals(\"ACTIVE\")) {\n\t\t\tlog.debug(\"Exit isAccountStatusMatch: \" + !acct.isDisabled());\n\t\t\treturn !acct.isDisabled();\n\t\t}\n\t\telse if (status.toUpperCase().equals(\"DISABLED\")) {\n\t\t\tlog.debug(\"Exit isAccountStatusMatch: \" + acct.isDisabled());\n\t\t\treturn acct.isDisabled();\n\t\t}\n\t\telse {\n\t\t\t//Invalid Configuration\n\t\t\tlog.error(\"Error Configuration: Status is invalid: \" + status);\n\t\t\treturn false;\n\t\t}\n\t}\n\tpublic boolean isEntitlementNameUpdateConfigMatch(AccountRequest accountRequest, Map trigger) {\n\t\tlog.debug(\"Enter isEntitlementNameUpdateConfigMatch: \" + identity + \" \" + trigger);\n\t\tif(trigger == null) {\n\t\t\tlog.error(\"Error isEntitlementNameUpdateConfigMatch Configuration: trigger is null\");\n\t\t\treturn false;\n\t\t}\n\t\tString attr = (String) trigger.get(\"Attribute\");\n\t\tString op = (String) trigger.get(\"Operation\");\n\t\tString val = (String) trigger.get(\"Value\");\n\t\tif(attr == null) {\n\t\t\tlog.error(\"Error Configuration: attribute is null\");\n\t\t\treturn false;\n\t\t}\n\t\tif(!\"Add\".equals(op) && !\"Remove\".equals(op) && !\"Set\".equals(op)) {\n\t\t\tlog.error(\"Error Configuration: operation is invalid: \" + op);\n\t\t\treturn false;\n\t\t}\n\t\tlog.debug(\"Check change in group: \" + val);\n\t\tboolean foundMatch = false;\n\t\tList entAttrReqs = accountRequest.getAttributeRequests(attr);\n\t\tif(entAttrReqs != null) {\n\t\t\tfor(AttributeRequest entAttrReq: entAttrReqs) {\n\t\t\t\tboolean doCompare = false;\n\t\t\t\tif(\"Add\".equals(op) && entAttrReq.getOperation() == ProvisioningPlan.Operation.Add) {\n\t\t\t\t\tlog.debug(\"Looking at an Add and operation in trigger is Add\");\n\t\t\t\t\tdoCompare = true;\n\t\t\t\t}\n\t\t\t\telse if(\"Remove\".equals(op) && entAttrReq.getOperation() == ProvisioningPlan.Operation.Remove) {\n\t\t\t\t\tlog.debug(\"Looking at an Remove and operation in trigger is Remove\");\n\t\t\t\t\tdoCompare = true;\n\t\t\t\t}\n\t\t\t\telse if(\"Set\".equals(op) && entAttrReq.getOperation() == ProvisioningPlan.Operation.Set) {\n\t\t\t\t\tlog.debug(\"Looking at an Set and operation in trigger is Set\");\n\t\t\t\t\tdoCompare = true;\n\t\t\t\t}\n\t\t\t\tif(doCompare) {\n\t\t\t\t\tList valuesUpdated = asList(entAttrReq.getValue());\n\t\t\t\t\tif(valuesUpdated != null) {\n\t\t\t\t\t\tfor(String update: valuesUpdated){\n\t\t\t\t\t\t\tString entitlementDisplayName = getEntitlementDisplayName(application.getId(), attr, update);\n\t\t\t\t\t\t\tif(entitlementDisplayName != null && isValueMatch(entitlementDisplayName, val)) {\n\t\t\t\t\t\t\t\tfoundMatch = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn foundMatch;\n\t}\n\t/*\n\t * Helper Utility Methods\n\t */\n\t \n\t/*\n\t * Is Value Match is used when determining a specific val1 (identity attribute, account attribute, request attribute) matches val2\n\t * If val2 contains wild cards \"*\" or \"?\", then we need to check the wild card match method\n\t */\n\tpublic boolean isValueMatch(Object val1, String val2) {\n\t\tlog.debug(\"Enter isValueMatch: \" + val1 + \" \" + val2);\n\t\tif(val1 instanceof String) {\n\t\t\tval1 = replaceNullValuesWithNull((String) val1);\n\t\t}\n\t\tif(val2 instanceof String) {\n\t\t\tval2 = replaceNullValuesWithNull(val2);\n\t\t}\n\t\tif(val1 == null && val2 == null) {\n\t\t\tlog.debug(\"Exit isValueMatch: Both null\");\n\t\t\treturn true;\n\t\t}\n\t\tif(val1 == null && val2 != null) {\n\t\t\tlog.debug(\"Exit isValueMatch: obj1 null, val2 not\");\n\t\t\treturn false;\n\t\t}\n\t\tif(val1 != null && val2 == null) {\n\t\t\tlog.debug(\"Exit isValueMatch: obj1 not null, val2 null\");\n\t\t\treturn false;\n\t\t}\n\t\t\n\t\tif(val1 instanceof String) {\n\t\t\tlog.debug(\"val1 is string, comparing against val2\");\n\t\t\tif(val2.contains(\"?\") || val2.contains(\"*\")) {\n\t\t\t\tlog.debug(\"val2 contains wild cards. checking wild card match\");\n\t\t\t\treturn wildCardMatch((String) val1, val2);\n\t\t\t}\n\t\t\tif(((String) val1).equals(val2)) {\n\t\t\t\tlog.debug(\"val1 matches val2\");\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\t\n\t// The function that checks if\n\t// two given strings match. The first string\n\t// may contain wild card characters \"?\" and \"*\"\n\tpublic boolean wildCardMatch(String value, String pattern)\n\t{\n\t\tlog.debug(\"Enter wildCardMatch: \" + value + \" against \" + pattern);\n\t\t// If we reach at the end of both strings,\n\t\t// we are done\n\t\tif (pattern.length() == 0 && value.length() == 0) {\n\t\t\tlog.debug(\"Exit wildCardMatch: each value is empty now\");\n\t\t\t\treturn true;\n\t\t}\n \n\t\t// Make sure that the characters after '*'\n\t\t// are present in second string.\n\t\t// This function assumes that the first\n\t\t// string will not contain two consecutive '*'\n\t\tif (pattern.length() > 1 && pattern.charAt(0) == '*' &&\n\t\t\t\tvalue.length() == 0) {\n\t\t\tlog.debug(\"Exit wildCardMatch: pattern contains additional characters but value is empty\");\n\t\t\treturn false;\n\t\t}\n \n\t\t// If the first string contains '?',\n\t\t// or current characters of both strings match\n\t\tif ((pattern.length() > 1 && pattern.charAt(0) == '?') ||\n\t\t\t\t(pattern.length() != 0 && value.length() != 0 &&\n\t\t\t\t\t\tpattern.charAt(0) == value.charAt(0))) {\n\t\t\tlog.debug(\"Recurse wildCardMatch: first character of \" + value + \" matches first character of \" + pattern);\n\t\t\treturn wildCardMatch(value.substring(1),\n\t\t\t\t\t\tpattern.substring(1));\n\t\t}\n\t\t// If there is *, then there are two possibilities\n\t\t// a - We consider current character of second string\n\t\t// b - We ignore current character of second string.\n\t\tif (pattern.length() > 0 && pattern.charAt(0) == '*') {\n\t\t\tlog.debug(\"Recurse wildCardMatch: first character of \" + pattern + \" is a wild card need to check rest of pattern AND rest of string against \" + value);\n\t\t\treturn wildCardMatch(value, pattern.substring(1)) ||\n\t\t\t\t\twildCardMatch(value.substring(1), pattern);\n\t\t}\n\t\tlog.debug(\"Exit wildCardMatch: value \" + value + \" does not match pattern \" + pattern);\n\t\treturn false;\n\t}\n\t\n\tpublic String replaceNullValuesWithNull(String val) {\n\t\tif(\"#{null}\".equals(val) || \"\".equals(val)){\n\t\t\treturn null;\n\t\t}\n\t\treturn val;\n\t}\n\tpublic String replaceIdentityValue(Identity identity, AccountRequest accountRequest, String val) {\n\t\tlog.debug(\"Enter replaceIdentityValue: \" + identity + \": \" + val);\n\t\tif(\"#{null}\".equals(val) || val == null){\n\t\t\treturn null;\n\t\t}\n\t\tlog.debug(\"Start with val: \" + val);\n\t\tif(val.contains(\"#{now}\")) {\n\t\t\tval = val.replace(\"#{now}\", (new Date()).toString());\n\t\t}\n\t\tlog.debug(\"Val after now replacement: \" + val);\n\t\tint nextReplaceCount = val.split(\"#\\\\{now\\\\.\").length - 1;  // Adding '}' to allow for validator to ignore mismatched counts of braces\n\t\tfor (int i = 1; i <= nextReplaceCount && val.contains(\"#{now\"); i++) { // Adding '}' to allow for validator to ignore mismatched counts of braces\n\t\t\tlog.debug(\"Val still has now ... has a format change: \" + val);\n\t\t\tString dateRegex = \"(.*)(#\\\\{now\\\\.)([^\\\\}]*)(\\\\})(.*)\";  // Adding '{' to allow for validator to ignore mismatched counts of braces\n\t\t\tString dateFormat = val.replaceAll(dateRegex, \"$3\");\n\t\t\tlog.debug(\"Date Format: \" + dateFormat);\n\t\t\tif(dateFormat == null) {\n\t\t\t\tdateFormat = \"yyyy-MM-dd\";\n\t\t\t}\n\t\t\tString formattedDate = \"\";\n\t\t\tswitch(dateFormat){\n\t\t\tcase \"EPOCH_TIME_WIN32\":\n\t\t\t\tLong win32TimeStamp = ((new Date()).getTime()+ 11644473600000L) * 10000L ;\n\t\t\t\tformattedDate = \"\" + win32TimeStamp;\n\t\t\t\tbreak;\n\t\t\tcase \"EPOCH_TIME_JAVA\":\n\t\t\t\tformattedDate = \"\" + (new Date()).getTime();\n\t\t\t\tbreak;\n\t\t\tcase \"EPOCH_TIME\":\n\t\t\t\tformattedDate = \"\" + ((new Date()).getTime() / 1000);\n\t\t\t\tbreak;\n\t\t\tdefault: \n\t\t\t\tSimpleDateFormat sdf = null;\n\t\t\t\tlog.debug(\"Use SimpleDateFormat for \" + dateFormat);\n\t\t\t\tif(\"ISO8601\".equals(dateFormat)) {\n\t\t\t\t\tsdf = new SimpleDateFormat(\"yyyy-MM-dd'T'HH:mm:ss.SSSX\");\n\t\t\t}\n\t\t\telse {\n\t\t\t\t\tsdf = new SimpleDateFormat(dateFormat);\n\t\t\t\t}\n\t\t\t\tformattedDate = sdf.format(new Date());\n\t\t\t}\n\t\t\tlog.debug(\"replace #{now.\" + dateFormat+ \"} with \" + formattedDate);\n\t\t\tval = val.replace(\"#{now.\" + dateFormat+ \"}\", formattedDate);\n\t\t\t\n\t\t\tlog.debug(\"Val replaced with date formated change: \" + val);\n\t\t}\n\t\tnextReplaceCount = val.split(\"#\\\\{identity\\\\.\").length - 1;  // Adding '}' to allow for validator to ignore mismatched counts of braces\n\t\tfor (int i = 1; i <= nextReplaceCount && val.contains(\"#{identity\"); i++) {  // Adding '}' to allow for validator to ignore mismatched counts of braces\n\t\t\tString attributeRegex = \"(.*)(#\\\\{identity\\\\.)([^\\\\}]*)(\\\\})(.*)\";  // Adding '{' to allow for validator to ignore mismatched counts of braces\n\t\t\tString attributeName = val.replaceAll(attributeRegex, \"$3\");\n\t\t\tlog.debug(\"Identity attribute to grab: \" + attributeName);\n\t\t\tString identityVal = null; \n\t\t\tif(identity == null) {\n\t\t\t\tlog.warn(\"No Identity\");\n\t\t\t}\n\t\t\telse {\n\t\t\t\tidentityVal = (String) identity.getAttribute(attributeName);\n\t\t\t}\n\t\t\t\tif(identityVal == null) {\n\t\t\t\t\tidentityVal = \"\";\n\t\t\t\t}\n\t\t\tval = val.replace(\"#{identity.\" + attributeName + \"}\", identityVal);\n\t\t\t\tlog.debug(\"Val replaced with attribute: \" + val);\n\t\t\t}\n\t\tnextReplaceCount = val.split(\"#\\\\{manager\\\\.\").length - 1;  // Adding '}' to allow for validator to ignore mismatched counts of braces\n\t\tfor (int i = 1; i <= nextReplaceCount && val.contains(\"#{manager\"); i++) {  // Adding '}' to allow for validator to ignore mismatched counts of braces\n\t\t\tString attributeRegex = \"(.*)(#\\\\{manager\\\\.)([^\\\\}]*)(\\\\})(.*)\";  // Adding '{' to allow for validator to ignore mismatched counts of braces \n\t\t\tString attributeName = val.replaceAll(attributeRegex, \"$3\");\n\t\t\tlog.debug(\"Manager attribute to grab: \" + attributeName);\n\t\t\tString identityVal = null; \n\t\t\tif(identity == null || identity.getManager() == null) {\n\t\t\t\tlog.warn(\"No Manager\");\n\t\t\t}\n\t\t\telse {\n\t\t\t\tidentityVal = (String) identity.getManager().getAttribute(attributeName);\n\t\t\t}\n\t\t\tif(identityVal == null) {\n\t\t\t\tidentityVal = \"\";\n\t\t}\n\t\t\tval = val.replace(\"#{manager.\" + attributeName + \"}\", identityVal);\n\t\t\tlog.debug(\"Val replaced with attribute: \" + val);\n\t\t}\n\t\tnextReplaceCount = val.split(\"#\\\\{account\\\\.\").length - 1;  // Adding '}' to allow for validator to ignore mismatched counts of braces\n\t\tfor (int i = 1; i <= nextReplaceCount && val.contains(\"#{account\"); i++) {  // Adding '}' to allow for validator to ignore mismatched counts of braces\n\t\t\tString attributeRegex = \"(.*)(#\\\\{account\\\\.)([^\\\\}]*)(\\\\})(.*)\";  // Adding '{' to allow for validator to ignore mismatched counts of braces\n\t\t\tString attributeName = val.replaceAll(attributeRegex, \"$3\");\n\t\t\tlog.debug(\"Account attribute to grab: \" + attributeName);\n\t\t\tAccount account = getAccount(identity, accountRequest);\n\t\t\tlog.debug(\"Got account\");\n\t\t\tString accountVal = \"\";\n\t\t\tif(account != null) {\n\t\t\t\taccountVal = idn.getAccountAttribute(account, attributeName);\n\t\t\t\tlog.debug(\"Got account attribute value: \" + accountVal);\n\t\t\t}\n\t\t\tif(accountVal == null) {\n\t\t\t\taccountVal = \"\";\n\t\t\t}\n\t\t\tval = val.replace(\"#{account.\" + attributeName + \"}\", accountVal);\n\t\t\tlog.debug(\"Val replaced with attribute: \" + val);\n\t\t}\n\t\tlog.debug(\"Exit replaceIdentityValue: \" + val);\n\t\treturn val;\n\t}\n\n\n\tpublic List entAccountValue(AccountRequest accountRequest, String val) throws GeneralException {\n\tlog.debug(\"Enter entAccountValue:: \" + val);\n\t\tList lsExistingEnt = new ArrayList();\t\n\t\tif (val == null) {\n\t\t\treturn null;\n\t\t}\n\t\tlog.debug(\"Start with val: \" + val);\n\t\t\tAccount account = getAccount(identity, accountRequest);\n\t\t\tlog.debug(\"Got account\");\n\t\t\tif (account != null) {\n\t\t\t\tlsExistingEnt = Util.filterNulls(Util.asList(idn.getRawAccountAttribute(account, val)));\n\t\t\t\tlog.debug(\"Got account attribute value: \" + lsExistingEnt);\n\t\t\t}\n\t\t\tif (lsExistingEnt == null) {\n\t\t\t\tlsExistingEnt = new ArrayList();\n\t\t\t}\n\t\tlog.debug(\"Exit entAccountValue: \" + lsExistingEnt);\n\t\treturn lsExistingEnt;\n\t}\n\n\n\tpublic List entAccountAttrValue(AccountRequest accountRequest, String val) throws GeneralException {\n\t\tlog.debug(\"Enter entAccountAttrValue:: \" + val);\n\t\tList lsExistingEnt = new ArrayList();\n\t\tif (\"#{null}\".equals(val) || val == null) {\n\t\t\treturn null;\n\t\t}\n\t\tlog.debug(\"Start with val: \" + val);\n\t\tint nextReplaceCount = val.split(\"#\\\\{account\\\\.\").length - 1; // Adding '}' to allow for validator to ignore\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// mismatched counts of braces\n\t\tfor (int i = 1; i <= nextReplaceCount && val.contains(\"#{account\"); i++) { // Adding '}' to allow for validator\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// to ignore mismatched counts of\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// braces\n\t\t\tString attributeRegex = \"(.*)(#\\\\{account\\\\.)([^\\\\}]*)(\\\\})(.*)\"; // Adding '{' to allow for validator to\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// ignore mismatched counts of braces\n\t\t\tString attributeName = val.replaceAll(attributeRegex, \"$3\");\n\t\t\tlog.debug(\"Account attribute to grab: \" + attributeName);\n\t\t\tAccount account = getAccount(identity, accountRequest);\n\t\t\tlog.debug(\"Got account\");\n\t\t\tif (account != null) {\n\t\t\t\tlsExistingEnt = Util.filterNulls(Util.asList(idn.getRawAccountAttribute(account, attributeName)));\n\t\t\t\tlog.debug(\"Got account attribute value: \" + lsExistingEnt);\n\t\t\t}\n\t\t\tif (lsExistingEnt == null) {\n\t\t\t\tlsExistingEnt = new ArrayList();\n\t\t\t}\n\t\t}\n\t\tlog.debug(\"Exit entAccountAttrValue: \" + lsExistingEnt);\n\t\treturn lsExistingEnt;\n\t}\n\t\n\t/*\n\t * Method takes an object and returns a list. If the object is already a list, it returns the object\n\t * Otherwise it'll return a list containing the object if not null\n\t */\n\tpublic List asList(Object val){\n\t\tif(val == null) {\n\t\t\treturn null;\n\t\t}\n\t\tList retList = null;\n\t\tif(val instanceof List) {\n\t\t\tretList = (List) val;\n\t\t}\n\t\telse if(val instanceof String) {\n\t\t\tretList = new ArrayList();\n\t\t\tretList.add((String) val);\n\t\t}\n\t\treturn retList;\n\t}\n\t\n\tpublic Account getAccount(Identity identity, AccountRequest accountRequest) {\n\t\tString appName = accountRequest.getApplicationName();\n\t\tString nativeId = accountRequest.getNativeIdentity();\n\t\tAccount account =  idn.getAccountByNativeIdentity(appName,nativeId);\n\t\treturn account;\n\t}\n\t\n\tpublic String getEntitlementDisplayName(String id, String attr, String value) {\n\t\tManagedAttributeDetails entDetails = idn.getManagedAttributeDetails(id, attr, value, Type.Entitlement);\n\t\tMap entAttrs = entDetails != null ? entDetails.getAttributes() : null;\n\t\treturn (entAttrs != null && entAttrs.containsKey(\"displayName\")) ? (String) entAttrs.get(\"displayName\") : null;\n\t}\n\t\n\t/*\n\t\tMain Running Code \n\t*/\n\n\tlog.debug(\"starting\");\n\tAttributes appAtts = application.getAttributes();\n\tif(appAtts != null && appAtts.get(\"cloudServicesIDNSetup\") != null) {\n\t\t\n\t\tMap idnSetup = (Map) appAtts.get(\"cloudServicesIDNSetup\");\n\t\tlog.debug(\"In Before Provisioning Rule :::: idnSetup: \" + idnSetup);\n\t\tList eventConfigs = (List) idnSetup.get(\"eventConfigurations\");\n\t\tlog.debug(\"In Before Provisioning Rule :::: eventConfigs: \" + eventConfigs);\n\t\tapplyEventConfigurations(plan, eventConfigs);\n\t}\n\n\n\n  "
  },
  "attributes": {
    "sourceVersion": "2025-03-03 22:19:19"
  },
  "id": "0593e15ef1fc4d7b8a54bdebfab7e735",
  "name": "Services Standard IdentityNow BeforeProvisioning Rule",
  "created": "2025-03-03T22:19:20.358Z",
  "modified": "2025-03-03T22:19:20.358Z"
}