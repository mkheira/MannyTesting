{
  "description": "Executes PowerShell commands on the IQService component after a source account is created.",
  "type": "ConnectorAfterCreate",
  "signature": {
    "input": [],
    "output": null
  },
  "sourceCode": {
    "version": "1.0",
    "script": "function log($string) {\r\n\t$timestamp = \"$(Get-Date -format \"MM-dd-yyyy HH:mm.ss\"): \";\r\n\t$entry = $timestamp + $string;\r\n    $entry | Out-File -Filepath $logFile -append;\r\n}\r\n\r\nfunction Get-AttributeValueFromAccountRequest([sailpoint.Utils.objects.AccountRequest] $request, [String] $targetAttribute) {\r\n\t$value = $null;\r\n    if ($request) {\r\n      foreach ($attrib in $request.AttributeRequests) {\r\n        if ($attrib.Name -eq $targetAttribute) {\r\n          $value = $attrib.Value;\r\n          break;\r\n        }\r\n      }\r\n    }\r\n\treturn $value;\r\n}\r\n  \r\nTry {\r\n\tAdd-type -path \"D:\\IQService\\Utils.dll\";\r\n\t# Read the environment variables\r\n\t$sReader = New-Object System.IO.StringReader([System.String]$env:Request);\r\n\t$sResult = New-Object System.IO.StringReader([System.String]$env:Result);\r\n\r\n\t# Form the xml reader objects\r\n\t$xmlReader = [System.xml.XmlTextReader]([sailpoint.utils.xml.XmlUtil]::getReader($sReader));\r\n\t$xmlReader_Result = [System.xml.XmlTextReader]([sailpoint.utils.xml.XmlUtil]::getReader($sResult));\r\n\r\n\t# Create SailPoint objects\r\n\t$requestObject = New-Object sailpoint.utils.objects.AccountRequest($xmlReader);\r\n\t$resultObject = New-Object sailpoint.utils.objects.ServiceResult($xmlReader_Result);\t\r\n\t  \r\n\t$op = $requestObject.operation;\r\n\t$dn = $requestObject.nativeIdentity;\r\n\t$sa = Get-AttributeValueFromAccountRequest $requestObject \"sAMAccountName\";\r\n\t$upn = Get-AttributeValueFromAccountRequest $requestObject \"userPrincipalName\";\r\n\t$displayname = Get-AttributeValueFromAccountRequest $requestObject \"displayname\";\r\n\t$epwd = Get-AttributeValueFromAccountRequest $requestObject \"password\";\r\n\t$pwd = [sailpoint.Utils.tools.Util]::decode($epwd,$true);\r\n\t\r\n\t$logDate = Get-Date -Format \"yyyy-MM-dd\";\r\n\t$logFile = \"D:\\Sailpoint\\ISCLogsWH\\ADAfterCreate\\ADAfterCreate-$logDate-$sa.log\";\r\n\t\r\n\tlog(\"CZR AD After Create Starts =======> $sa\");\r\n\tlog(\"Request Object: =======> $requestObject\");\r\n\t\r\n\t$arguments = $requestObject.Attributes;\r\n\tforeach ($item in $arguments.Keys) {\r\n\t\tlog(\"$item = $($arguments[$item])\");\r\n\t}\r\n\t\r\n\t$excScript = $arguments.excScript;\r\n\t$excScriptSendPwdEmail = $arguments.excScriptSendPwdEmail;\r\n\t$excScriptSAMAccName = $arguments.excScriptSAMAccName;\r\n\t$excScriptUPN = $arguments.excScriptUPN;\r\n\t$excScriptEmpType = $arguments.excScriptEmpType;\r\n\t$excScriptDomain = $arguments.excScriptDomain;\r\n\t$excScriptLicenseToAssign = $arguments.excScriptLicenseToAssign;\r\n\t$excScriptBR = $arguments.excScriptBR;\r\n\t$excScriptSetupLike = $arguments.excScriptSetupLike;\r\n\t$excScriptName = $arguments.excScriptName;\r\n\t$excScriptSetupLikeSource = $arguments.excScriptSetupLikeSource;\r\n\t$excScriptCnowTaskNumber = $arguments.excScriptCnowTaskNumber;\r\n\t$excScriptCnowTaskSysId = $arguments.excScriptCnowTaskSysId;\r\n\t$excScriptWorkerType = $arguments.excScriptWorkerType;\r\n\t$excScriptIdentityDisplayName = $arguments.excScriptIdentityDisplayName;\r\n\t$excScriptManagerDisplayName = $arguments.excScriptManagerDisplayName;\r\n\t$excScriptManagerEmail = $arguments.excScriptManagerEmail;\r\n\t$excScriptCnowNetworkAccessRequired = $arguments.excScriptCnowNetworkAccessRequired;\r\n\t$excScriptCnowExchangeMailboxRequired = $arguments.excScriptCnowExchangeMailboxRequired;\r\n\t$excScriptPersonNumber = $arguments.excScriptPersonNumber;\r\n\t$excScriptCnowRequestedBy = $arguments.excScriptCnowRequestedBy;\r\n\t$excScriptCnowRequestedByEmail = $arguments.excScriptCnowRequestedByEmail;\t\r\n\t$excScriptJobTitle = $arguments.excScriptJobTitle;\r\n\t$excScriptDepartment = $arguments.excScriptDepartment;\r\n\t$excScriptLocationDesc = $arguments.excScriptLocationDesc;\r\n\t$excScriptAssignmentStartDate = $arguments.excScriptAssignmentStartDate;\r\n\t$excScriptContractorRequestedByEmail = $arguments.excScriptContractorRequestedByEmail;\r\n\t$excScriptContractorOnboarding = $arguments.excScriptContractorOnboarding;\r\n\t\r\n\t$processName = \"Create\";\r\n\t$appname = \"CZR-Application-ActiveDirectory-WilliamHill\";\r\n\tif((![string]::IsNullOrEmpty($excScriptBR)) -and $excScriptBR -eq \"true\") {\r\n\t\t$processName = \"Joiner\";\r\n\t}\r\n\t\r\n\tif((![string]::IsNullOrEmpty($excScriptSetupLike)) -and $excScriptSetupLike -eq \"true\") {\r\n\t\tif((![string]::IsNullOrEmpty($excScriptSetupLikeSource)) -and $excScriptSetupLikeSource -eq \"CNOW\") {\r\n\t\t\t$processName = \"CNOWRequest\";\r\n\t\t}\r\n\t}\r\n\t\r\n\tif((![string]::IsNullOrEmpty($excScriptWorkerType)) -and $excScriptWorkerType -eq \"Employee\") {\r\n\t\tif((![string]::IsNullOrEmpty($excScriptSetupLike)) -and $excScriptSetupLike -eq \"true\") {\r\n\t\t\tif((![string]::IsNullOrEmpty($excScriptSetupLikeSource)) -and $excScriptSetupLikeSource -eq \"ISC\") {\r\n\t\t\t\t$processName = \"EmployeeAccessRequest\";\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\tif((![string]::IsNullOrEmpty($excScriptWorkerType)) -and $excScriptWorkerType -eq \"Contractor\") {\r\n\t\tif((![string]::IsNullOrEmpty($excScriptSetupLike)) -and $excScriptSetupLike -eq \"true\") {\r\n\t\t\tif((![string]::IsNullOrEmpty($excScriptSetupLikeSource)) -and $excScriptSetupLikeSource -eq \"ISC\") {\r\n\t\t\t\t$processName = \"ContractorAccessRequest\";\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\tif($resultObject.Errors.count -eq 0) {\r\n\t\tif ($op -eq \"Create\") {\r\n\t\t\tlog(\"AD account creation success for user =======> $sa\");\t\t\t\r\n\t\t\tlog(\"AD Connector After Create input excScript =======> $excScript\");\r\n\t\t\tlog(\"AD Connector After Create input excScriptSendPwdEmail =======> $excScriptSendPwdEmail\");\r\n\t\t\tlog(\"AD Connector After Create input excScriptSAMAccName =======> $excScriptSAMAccName\");\r\n\t\t\tlog(\"AD Connector After Create input excScriptUPN =======> $excScriptUPN\");\r\n\t\t\tlog(\"AD Connector After Create input excScriptEmpType =======> $excScriptEmpType\");\r\n\t\t\tlog(\"AD Connector After Create input excScriptDomain =======> $excScriptDomain\");\r\n\t\t\tlog(\"AD Connector After Create input excScriptLicenseToAssign =======> $excScriptLicenseToAssign\");\r\n\t\t\tlog(\"AD Connector After Create input excScriptBR =======> $excScriptBR\");\r\n\t\t\tlog(\"AD Connector After Create input excScriptSetupLike =======> $excScriptSetupLike\");\r\n\t\t\tlog(\"AD Connector After Create input excScriptName =======> $excScriptName\");\r\n\t\t\tlog(\"AD Connector After Create input excScriptSetupLikeSource =======> $excScriptSetupLikeSource\");\r\n\t\t\tlog(\"AD Connector After Create input excScriptCnowTaskNumber =======> $excScriptCnowTaskNumber\");\r\n\t\t\tlog(\"AD Connector After Create input excScriptCnowTaskSysId =======> $excScriptCnowTaskSysId\");\r\n\t\t\tlog(\"AD Connector After Create input excScriptWorkerType =======> $excScriptWorkerType\");\r\n\t\t\tlog(\"AD Connector After Create input excScriptIdentityDisplayName =======> $excScriptIdentityDisplayName\");\r\n\t\t\tlog(\"AD Connector After Create input excScriptManagerDisplayName =======> $excScriptManagerDisplayName\");\r\n\t\t\tlog(\"AD Connector After Create input excScriptManagerEmail =======> $excScriptManagerEmail\");\r\n\t\t\tlog(\"AD Connector After Create input excScriptCnowNetworkAccessRequired =======> $excScriptCnowNetworkAccessRequired\");\r\n\t\t\tlog(\"AD Connector After Create input excScriptCnowExchangeMailboxRequired =======> $excScriptCnowExchangeMailboxRequired\");\r\n\t\t\tlog(\"AD Connector After Create input excScriptPersonNumber =======> $excScriptPersonNumber\");\r\n\t\t\tlog(\"AD Connector After Create input excScriptCnowRequestedBy =======> $excScriptCnowRequestedBy\");\r\n\t\t\tlog(\"AD Connector After Create input excScriptCnowRequestedByEmail =======> $excScriptCnowRequestedByEmail\");\r\n\t\t\tlog(\"AD Connector After Create input excScriptJobTitle =======> $excScriptJobTitle\");\r\n\t\t\tlog(\"AD Connector After Create input excScriptDepartment =======> $excScriptDepartment\");\r\n\t\t\tlog(\"AD Connector After Create input excScriptLocationDesc =======> $excScriptLocationDesc\");\r\n\t\t\tlog(\"AD Connector After Create input excScriptAssignmentStartDate =======> $excScriptAssignmentStartDate\");\r\n\t\t\tlog(\"AD Connector After Create input excScriptContractorRequestedByEmail =======> $excScriptContractorRequestedByEmail\");\r\n\t\t\tlog(\"AD Connector After Create input excScriptContractorOnboarding =======> $excScriptContractorOnboarding\");\r\n\t\t\t\r\n\t\t\t# Call Enable Mailbox script\r\n\t\t\tif((![string]::IsNullOrEmpty($excScript)) -and ($excScript -eq \"true\")) {\r\n\t\t\t\tlog(\"AD Enable Mailbox is requested for this user =======> $sa\");\t\t\t\t\t\t\t\t\r\n\t\t\t\tlog(\"Calling Enable Mailbox script for user: $sa\");\r\n\t\t\t\t$argumentList = \"D:\\Sailpoint\\ScriptsWH\\EnableMailbox.ps1 -sa '$excScriptSAMAccName' -upn '$excScriptUPN' -dn '$dn' -personnumber '$excScriptPersonNumber' -displayname '$excScriptIdentityDisplayName' -workertype '$excScriptWorkerType' -emptype '$excScriptEmpType' -domain '$excScriptDomain' -license '$excScriptLicenseToAssign' -br '$excScriptBR' -setuplike '$excScriptSetupLike' -setuplikesource '$excScriptSetupLikeSource' -tasknum '$excScriptCnowTaskNumber' -taskid '$excScriptCnowTaskSysId'\";\r\n\t\t\t\tlog(\"argumentList: $argumentList\");\r\n\t\t\t\tStart-Process -FilePath \"powershell.exe\" -ArgumentList \"$argumentList\";\r\n\t\t\t\tlog(\"Finised Calling Enable Mailbox script for user: $sa\");\t\t\t\t\r\n\t\t\t} else {\r\n\t\t\t\tlog(\"AD Enable Mailbox is not requested for this user =======> $sa\");\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t# Call send email script on new password only for CNOW requests\r\n\t\t\t#if((![string]::IsNullOrEmpty($excScriptSetupLike)) -and ($excScriptSetupLike -eq \"true\")) {\r\n\t\t\t#\tif((![string]::IsNullOrEmpty($excScriptSetupLikeSource)) -and ($excScriptSetupLikeSource -eq \"CNOW\")) {\r\n\t\t\t#\t\tif((![string]::IsNullOrEmpty($excScriptCnowNetworkAccessRequired)) -and ($excScriptCnowNetworkAccessRequired -eq \"true\")) {\r\n\t\t\t\t\t\tif((![string]::IsNullOrEmpty($excScriptSendPwdEmail)) -and ($excScriptSendPwdEmail -eq \"true\")) {\r\n\t\t\t\t\t\t\tlog(\"AD Send Password Email is requested for this user =======> $sa\");\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tlog(\"Calling Send Password Email script for user: $sa\");\r\n\t\t\t\t\t\t\t$argumentList = \"D:\\Sailpoint\\ScriptsWH\\SendADPasswordEmail.ps1 -sa '$excScriptSAMAccName' -upn '$excScriptUPN' -personnumber '$excScriptPersonNumber' -displayname '$excScriptIdentityDisplayName' -mgrdisplayname '$excScriptManagerDisplayName' -manageremail '$excScriptManagerEmail' -cnowRequestedBy '$excScriptCnowRequestedBy' -cnowRequestedByEmail '$excScriptCnowRequestedByEmail' -jobTitle '$excScriptJobTitle' -department '$excScriptDepartment' -locationdesc '$excScriptLocationDesc' -assignmentstartdate '$excScriptAssignmentStartDate' -contractorRequestedByEmail '$excScriptContractorRequestedByEmail' -contractorOnboarding '$excScriptContractorOnboarding' -pwd '$pwd'\";\r\n\t\t\t\t\t\t\tlog(\"argumentList: $argumentList\");\r\n\t\t\t\t\t\t\tStart-Process -FilePath \"powershell.exe\" -ArgumentList \"$argumentList\";\r\n\t\t\t\t\t\t\tlog(\"Finished Calling AD Send Password Email script for user: =======> $sa\");\r\n\t\t\t\t\t\t}\r\n\t\t\t#\t\t}  else {\r\n\t\t\t#\t\t\tlog(\"AD Password Email not required for this user =======> $sa\");\r\n\t\t\t#\t\t}\t\t\t\t\t\t\r\n\t\t\t#\t}  else {\r\n\t\t\t#\t\tlog(\"AD Password Email not required for this user =======> $sa\");\r\n\t\t\t#\t}\r\n\t\t\t#} else {\r\n\t\t\t#\tlog(\"AD Password Email not required for this user =======> $sa\");\r\n\t\t\t#}\r\n\t\t\t\r\n\t\t\t#Call update CNOW Ticket\r\n\t\t\tif((![string]::IsNullOrEmpty($excScriptSetupLike)) -and ($excScriptSetupLike -eq \"true\")) {\r\n\t\t\t\tif((![string]::IsNullOrEmpty($excScriptSetupLikeSource)) -and ($excScriptSetupLikeSource -eq \"CNOW\")) {\r\n\t\t\t\t\tif((![string]::IsNullOrEmpty($excScriptCnowNetworkAccessRequired)) -and ($excScriptCnowNetworkAccessRequired -eq \"true\")) {\r\n\t\t\t\t\t\tif((![string]::IsNullOrEmpty($excScriptCnowExchangeMailboxRequired)) -and ($excScriptCnowExchangeMailboxRequired -eq \"false\")) {\r\n\t\t\t\t\t\t\t$action = \"UPDATE_CLOSE_COMPLETE\";\r\n\t\t\t\t\t\t\t$message = \"Successfully completed network access\";\r\n\t\t\t\t\t\t\t$argumentList = \"D:\\Sailpoint\\ScriptsWH\\UpdateCNOWTask.ps1 -tasknum '$excScriptCnowTaskNumber' -taskid '$excScriptCnowTaskSysId' -action '$action' -error '$message'\";\r\n\t\t\t\t\t\t\tlog(\"argumentList: $argumentList\");\r\n\t\t\t\t\t\t\tStart-Process -FilePath \"powershell.exe\" -ArgumentList \"$argumentList\";\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t$action = \"UPDATE\";\r\n\t\t\t\t\t\t\t$message = \"Successfully completed network access, Exchange Mailbox in progress..\";\r\n\t\t\t\t\t\t\t$argumentList = \"D:\\Sailpoint\\ScriptsWH\\UpdateCNOWTask.ps1 -tasknum '$excScriptCnowTaskNumber' -taskid '$excScriptCnowTaskSysId' -action '$action' -error '$message'\";\r\n\t\t\t\t\t\t\tlog(\"argumentList: $argumentList\");\r\n\t\t\t\t\t\t\tStart-Process -FilePath \"powershell.exe\" -ArgumentList \"$argumentList\";\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} \r\n\t} else {\t\t\r\n\t\tif ($op -eq \"Create\") {\r\n\t\t\tlog(\"AD account creation failed for user =======> $sa\");\r\n\t\t\t$errorMessage = $resultObject.Errors -join \", \";\r\n\t\t\t#Call JML Failure Notification script\r\n\t\t\tif((![string]::IsNullOrEmpty($errorMessage))) {\r\n\t\t\t\t$argumentList = \"D:\\Sailpoint\\ScriptsWH\\JMLFailureNotification.ps1 -processname '$processName' -sa '$excScriptSAMAccName' -dn '$dn' -appname '$appname' -personnumber '$excScriptPersonNumber'  -displayname '$excScriptIdentityDisplayName' -tasknum '$excScriptCnowTaskNumber' -error '$errorMessage'\";\r\n\t\t\t\tlog(\"argumentList: $argumentList\");\r\n\t\t\t\tStart-Process -FilePath \"powershell.exe\" -ArgumentList \"$argumentList\";\r\n\t\t\t}\t\t\t\r\n\t\t\t#Call update CNOW Ticket\r\n\t\t\tif((![string]::IsNullOrEmpty($excScriptSetupLike)) -and ($excScriptSetupLike -eq \"true\")) {\r\n\t\t\t\tif((![string]::IsNullOrEmpty($excScriptSetupLikeSource)) -and ($excScriptSetupLikeSource -eq \"CNOW\")) {\r\n\t\t\t\t\t$action = \"UPDATE_CLOSE_INCOMPLETE\";\r\n\t\t\t\t\t$argumentList = \"D:\\Sailpoint\\ScriptsWH\\UpdateCNOWTask.ps1 -tasknum '$excScriptCnowTaskNumber' -taskid '$excScriptCnowTaskSysId' -action '$action' -error '$errorMessage'\";\r\n\t\t\t\t\tlog(\"argumentList: $argumentList\");\r\n\t\t\t\t\tStart-Process -FilePath \"powershell.exe\" -ArgumentList \"$argumentList\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tlog(\"CZR AD After Create Ends =======> $sa\");\r\n} Catch {\r\n\t$ErrorMessage = $_.Exception.Message;\r\n\t$ErrorItem = $_.Exception.ItemName;\r\n\tlog(\"Error: Item = $ErrorItem -> Message = $ErrorMessage\");\r\n}"
  },
  "attributes": {
    "ObjectOrientedScript": "true",
    "extension": ".ps1",
    "sourceVersion": "1.0",
    "disabled": "false",
    "program": "powershell.exe",
    "timeout": "300"
  },
  "id": "34d2ba1f54a64bfa846ef4f599be81ce",
  "name": "CZR_ActiveDirectory_AfterCreate_WilliamHill",
  "created": "2025-11-02T23:14:53.682Z",
  "modified": "2025-11-14T16:15:34.287Z"
}