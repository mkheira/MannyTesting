{
  "id": "3aa96f60-f36c-4c70-b3d7-f9b04cb70ef3",
  "name": "CZR-Workflow-ServiceNowCatalog-Timebound - Teams Record and USB access - Loop",
  "description": "Teams Recording access and USB access Timebound will be controlled thru this workflow. After the period listed for each role, access will be automatically revoked.Approval must follow the next-level reporting structure, and then proceed to management for final authorization.",
  "created": "2025-09-22T21:50:50.610919345Z",
  "modified": "2025-10-01T21:34:07.781208138Z",
  "modifiedBy": {
    "type": "IDENTITY",
    "id": "a0d9586ce9314f9f89c2d094dca4e27e",
    "name": "500000384"
  },
  "definition": {
    "start": "Define Variable",
    "steps": {
      "Define Variable": {
        "actionId": "sp:define-variable",
        "attributes": {
          "id": "sp:define-variable",
          "variables": [
            {
              "description": "",
              "name": "recipientId",
              "transforms": [],
              "variableA.$": "$.trigger.recipient.id"
            }
          ]
        },
        "displayName": "",
        "nextStep": "Loop",
        "type": "Mutation"
      },
      "Define Variable 1": {
        "actionId": "sp:define-variable",
        "attributes": {
          "id": "sp:define-variable",
          "variables": [
            {
              "description": "",
              "name": "TestResult2",
              "transforms": [],
              "variableA.$": "$.loop.loopInput"
            }
          ]
        },
        "displayName": "",
        "nextStep": "End Step - Success",
        "type": "Mutation"
      },
      "End Step - Success": {
        "actionId": "sp:operator-success",
        "displayName": "",
        "type": "success"
      },
      "Loop": {
        "actionId": "sp:loop:iterator",
        "attributes": {
          "context.$": "$.defineVariable.recipientId",
          "input.$": "$.trigger.accountRequests[*].attributeRequests[?(@.attributeName=='assignedRoles')]",
          "start": "Define Variable 4",
          "steps": {
            "Compare Strings": {
              "actionId": "sp:compare-strings",
              "choiceList": [
                {
                  "comparator": "StringEquals",
                  "nextStep": "Define Variable 3",
                  "variableA.$": "$.defineVariable2.rolename",
                  "variableB": "USB - 30 Day Read Only Access [cloudRole-1756912019712]"
                }
              ],
              "defaultStep": "Compare Strings 1",
              "displayName": "USB - 30 Day Read Only Access",
              "type": "choice"
            },
            "Compare Strings 1": {
              "actionId": "sp:compare-strings",
              "choiceList": [
                {
                  "comparator": "StringEquals",
                  "nextStep": "Define Variable 5",
                  "variableA.$": "$.defineVariable2.rolename",
                  "variableB": "USB - 30 Day Read and Write Access [cloudRole-1756912198014]"
                }
              ],
              "defaultStep": "Compare Strings 2",
              "displayName": "USB - 30 Days Read and Write Access",
              "type": "choice"
            },
            "Compare Strings 2": {
              "actionId": "sp:compare-strings",
              "choiceList": [
                {
                  "comparator": "StringEquals",
                  "nextStep": "Define Variable 6",
                  "variableA.$": "$.defineVariable2.rolename",
                  "variableB": "USB - 48 Hour Read Only Access [cloudRole-1756912442852]"
                }
              ],
              "defaultStep": "Compare Strings 3",
              "displayName": "USB - 48 Hour Read Only Access",
              "type": "choice"
            },
            "Compare Strings 3": {
              "actionId": "sp:compare-strings",
              "choiceList": [
                {
                  "comparator": "StringEquals",
                  "nextStep": "Define Variable 7",
                  "variableA.$": "$.defineVariable2.rolename",
                  "variableB": "USB - 48 Hours Read and Write Access [cloudRole-1756912502392]"
                }
              ],
              "defaultStep": "End Step - Failure 1",
              "displayName": "USB - 48 Hours Read and Write Access",
              "type": "choice"
            },
            "Define Variable 2": {
              "actionId": "sp:define-variable",
              "attributes": {
                "id": "sp:define-variable",
                "variables": [
                  {
                    "description": "",
                    "name": "rolename",
                    "transforms": [],
                    "variableA.$": "$.loop.loopInput.attributeValue"
                  }
                ]
              },
              "displayName": "",
              "nextStep": "Compare Strings",
              "type": "Mutation"
            },
            "Define Variable 3": {
              "actionId": "sp:define-variable",
              "attributes": {
                "id": "sp:define-variable",
                "variables": [
                  {
                    "description": "removalDate",
                    "name": "removalDate",
                    "transforms": [
                      {
                        "id": "sp:transform:addTime:time",
                        "input": {
                          "length": 5,
                          "unit": "minutes"
                        }
                      }
                    ],
                    "variableA.$": "$.now()"
                  }
                ]
              },
              "displayName": "",
              "nextStep": "HTTP Request",
              "type": "Mutation"
            },
            "Define Variable 4": {
              "actionId": "sp:define-variable",
              "attributes": {
                "id": "sp:define-variable",
                "variables": [
                  {
                    "description": "",
                    "name": "recipient",
                    "transforms": [],
                    "variableA.$": "$.loop.context"
                  }
                ]
              },
              "displayName": "",
              "nextStep": "Define Variable 2",
              "type": "Mutation"
            },
            "Define Variable 5": {
              "actionId": "sp:define-variable",
              "attributes": {
                "id": "sp:define-variable",
                "variables": [
                  {
                    "description": "removalDate",
                    "name": "removalDate",
                    "transforms": [
                      {
                        "id": "sp:transform:addTime:time",
                        "input": {
                          "length": 5,
                          "unit": "minutes"
                        }
                      }
                    ],
                    "variableA.$": "$.now()"
                  }
                ]
              },
              "displayName": "",
              "nextStep": "HTTP Request 1",
              "type": "Mutation"
            },
            "Define Variable 6": {
              "actionId": "sp:define-variable",
              "attributes": {
                "id": "sp:define-variable",
                "variables": [
                  {
                    "description": "removalDate",
                    "name": "removalDate",
                    "transforms": [
                      {
                        "id": "sp:transform:addTime:time",
                        "input": {
                          "length": 5,
                          "unit": "minutes"
                        }
                      }
                    ],
                    "variableA.$": "$.now()"
                  }
                ]
              },
              "displayName": "",
              "nextStep": "HTTP Request 2",
              "type": "Mutation"
            },
            "Define Variable 7": {
              "actionId": "sp:define-variable",
              "attributes": {
                "id": "sp:define-variable",
                "variables": [
                  {
                    "description": "removalDate",
                    "name": "removalDate",
                    "transforms": [
                      {
                        "id": "sp:transform:addTime:time",
                        "input": {
                          "length": 5,
                          "unit": "minutes"
                        }
                      }
                    ],
                    "variableA.$": "$.now()"
                  }
                ]
              },
              "displayName": "",
              "nextStep": "HTTP Request 3",
              "type": "Mutation"
            },
            "End Step - Failure 1": {
              "actionId": "sp:operator-failure",
              "displayName": "",
              "failureDetails": null,
              "failureName": "Failed",
              "type": "failure"
            },
            "End Step - Success 1": {
              "actionId": "sp:operator-success",
              "displayName": "",
              "type": "success"
            },
            "HTTP Request": {
              "actionId": "sp:http",
              "attributes": {
                "authenticationType": "OAuth",
                "jsonRequestBody": {
                  "requestType": "REVOKE_ACCESS",
                  "requestedFor": [
                    "{{$.defineVariable4.recipient}}"
                  ],
                  "requestedItems": [
                    {
                      "comment": " USB - 30 Day Read Only Access -Active Directory group has been automatically removed by ISC. If you believe this is an error, please reach out to your manager or the Team AD group owner for assistance.",
                      "id": "16257a9f615e43d5bcddc0d4bd001746",
                      "removeDate": "{{$.defineVariable3.removalDate}}",
                      "type": "ROLE"
                    }
                  ]
                },
                "method": "post",
                "oAuthClientId": "f7f34d9888cd4b0cb8123b7ed92c427f",
                "oAuthClientSecret": "$.secrets.f4154dc9-7c52-4998-b00d-0ade9962d7ca",
                "oAuthCredentialLocation": "oAuthInBody",
                "oAuthTokenUrl": "https://caesars-sb.api.identitynow.com/oauth/token",
                "requestContentType": "json",
                "url": "https://caesars-sb.api.identitynow.com/v2024/access-requests"
              },
              "description": "Revoke Access - USB 48 Day Read Only Role",
              "displayName": "",
              "nextStep": "End Step - Success 1",
              "type": "action",
              "versionNumber": 2
            },
            "HTTP Request 1": {
              "actionId": "sp:http",
              "attributes": {
                "authenticationType": "OAuth",
                "jsonRequestBody": {
                  "requestType": "REVOKE_ACCESS",
                  "requestedFor": [
                    "{{$.defineVariable4.recipient}}"
                  ],
                  "requestedItems": [
                    {
                      "comment": " USB 30 Day Access Read and Write  -Active Directory group has been automatically removed by ISC. If you believe this is an error, please reach out to your manager or the Team AD group owner for assistance.",
                      "id": "80faec5ca54e43ccbf24da5db102591c",
                      "removeDate": "{{$.defineVariable5.removalDate}}",
                      "type": "ROLE"
                    }
                  ]
                },
                "method": "post",
                "oAuthClientId": "f7f34d9888cd4b0cb8123b7ed92c427f",
                "oAuthClientSecret": "$.secrets.ccaa9c1d-5815-489b-8a44-0cedf8ee9219",
                "oAuthCredentialLocation": "oAuthInBody",
                "oAuthTokenUrl": "https://caesars-sb.api.identitynow.com/oauth/token",
                "requestContentType": "json",
                "url": "https://caesars-sb.api.identitynow.com/v2024/access-requests"
              },
              "description": "Revoke Access - USB 48 Day Read Only Role",
              "displayName": "",
              "nextStep": "End Step - Success 1",
              "type": "action",
              "versionNumber": 2
            },
            "HTTP Request 2": {
              "actionId": "sp:http",
              "attributes": {
                "authenticationType": "OAuth",
                "jsonRequestBody": {
                  "requestType": "REVOKE_ACCESS",
                  "requestedFor": [
                    "{{$.defineVariable4.recipient}}"
                  ],
                  "requestedItems": [
                    {
                      "comment": " USB 48 Hours Read Only Access  -Active Directory group has been automatically removed by ISC. If you believe this is an error, please reach out to your manager or the Team AD group owner for assistance.",
                      "id": "ebd810dd6bbb4c0da5420fae92cac6ae",
                      "removeDate": "{{$.defineVariable6.removalDate}}",
                      "type": "ROLE"
                    }
                  ]
                },
                "method": "post",
                "oAuthClientId": "f7f34d9888cd4b0cb8123b7ed92c427f",
                "oAuthClientSecret": "$.secrets.f378ae7c-ffa5-4019-8afe-bd061225b79d",
                "oAuthCredentialLocation": "oAuthInBody",
                "oAuthTokenUrl": "https://caesars-sb.api.identitynow.com/oauth/token",
                "requestContentType": "json",
                "url": "https://caesars-sb.api.identitynow.com/v2024/access-requests"
              },
              "description": "Revoke Access - USB 48 Day Read Only Role",
              "displayName": "",
              "nextStep": "End Step - Success 1",
              "type": "action",
              "versionNumber": 2
            },
            "HTTP Request 3": {
              "actionId": "sp:http",
              "attributes": {
                "authenticationType": "OAuth",
                "jsonRequestBody": {
                  "requestType": "REVOKE_ACCESS",
                  "requestedFor": [
                    "{{$.defineVariable4.recipient}}"
                  ],
                  "requestedItems": [
                    {
                      "comment": " USB 48 Hours Read and Write Access -Active Directory group has been automatically removed by ISC. If you believe this is an error, please reach out to your manager or the Team AD group owner for assistance.",
                      "id": "3b7dd6cf98f74c52aa8e5dd72f143482",
                      "removeDate": "{{$.defineVariable7.removalDate}}",
                      "type": "ROLE"
                    }
                  ]
                },
                "method": "post",
                "oAuthClientId": "f7f34d9888cd4b0cb8123b7ed92c427f",
                "oAuthClientSecret": "$.secrets.6a493c8d-b170-4124-b580-b1762ce17380",
                "oAuthCredentialLocation": "oAuthInBody",
                "oAuthTokenUrl": "https://caesars-sb.api.identitynow.com/oauth/token",
                "requestContentType": "json",
                "url": "https://caesars-sb.api.identitynow.com/v2024/access-requests"
              },
              "description": "Revoke Access - USB 48 Day Read Only Role",
              "displayName": "",
              "nextStep": "End Step - Success 1",
              "type": "action",
              "versionNumber": 2
            }
          }
        },
        "displayName": "",
        "nextStep": "Define Variable 1",
        "type": "action",
        "versionNumber": 1
      }
    }
  },
  "enabled": false,
  "creator": {
    "type": "IDENTITY",
    "id": "9880e87611d64a5b9a6c66acd11b7301",
    "name": "Lingareddy Some"
  },
  "owner": {
    "type": "IDENTITY",
    "id": "a0d9586ce9314f9f89c2d094dca4e27e",
    "name": "500000384"
  },
  "trigger": {
    "type": "EVENT",
    "attributes": {
      "filter.$": "$.accountRequests[?( @.accountOperation == 'Modify' && @.provisioningResult == 'committed')].attributeRequests[?(@.operation == \"Add\" && ( @.attributeValue == \"CN=USB 30 Day Access Read and Write,OU=Okta,OU=Applications,OU=SailPointUsers,DC=dev,DC=lab,DC=local\" || @.attributeValue == \"CN=USB 30 Day Access ReadOnly,OU=Okta,OU=Applications,OU=SailPointUsers,DC=dev,DC=lab,DC=local\" || @.attributeValue == \"CN=USB 48 Hour Access Read and Write,OU=Okta,OU=Applications,OU=SailPointUsers,DC=dev,DC=lab,DC=local\" || @.attributeValue == \"CN=USB 48 Hour Access Read Only,OU=Okta,OU=Applications,OU=SailPointUsers,DC=dev,DC=lab,DC=local\"|| @.attributeValue == \"CN=Teams Recording 30 day access,OU=Okta,OU=Applications,OU=SailPointUsers,DC=dev,DC=lab,DC=local\"))]",
      "id": "idn:post-provisioning"
    }
  }
}