{
  "description": "",
  "type": "BeforeProvisioning",
  "signature": {
    "input": [],
    "output": null
  },
  "sourceCode": {
    "version": "2025-12-26 23:01:06",
    "script": "\n  \nimport java.util.ArrayList;\nimport java.util.List;\nimport java.util.Arrays;\nimport java.util.HashMap;\nimport sailpoint.object.Identity;\nimport sailpoint.object.ProvisioningPlan;\nimport sailpoint.object.ProvisioningPlan.Operation;\nimport sailpoint.object.ProvisioningPlan.AccountRequest;\nimport sailpoint.object.ProvisioningPlan.AttributeRequest;\nimport sailpoint.object.ProvisioningPlan.AccountRequest.Operation;\nimport sailpoint.tools.Util;\nimport org.apache.commons.lang3.StringUtils;\nimport java.text.SimpleDateFormat; \nimport java.util.Date;\nimport java.time.format.DateTimeFormatter;\nimport java.time.LocalDate;\nimport java.time.LocalDateTime;\nimport java.time.Month;\nimport java.util.Calendar;\nimport java.util.TimeZone;\nimport sailpoint.rule.Account;\nimport java.util.regex.Matcher;\nimport java.util.regex.Pattern;\nimport java.util.Random;\nimport java.util.Map;\nimport sailpoint.tools.GeneralException;\nimport sailpoint.server.IdnRuleUtil;\n\nString applicationName = application.getName();\nString nativeIdentity = null;\nIdentity identity = null;\nString lifeCycleState = null;\nString workerType = null;\nString adProvFlagBr = null;\nString adProvFlagSetupLike = null;\nString setupLikePersonId = null;\nString exchangeMailboxRequired = null;\nString networkAccessRequired = null;\nString adProvFlagCnowSetupLike = null;\n\nString cnowSetupLikePersonIdWH = null;\nString cnowNetworkAccessRequiredWH = null;\nString cnowExchangeMailboxRequiredWH = null;\nString cnowTaskNumberWH = null;\nString cnowTaskSysIdWH = null;\nString cnowRequestedByWH = null;\nString cnowRequestedByEmailWH = null;\n\nString managementLevelFlag = null;\nString employeeType = null;\nString division = null;\nString managementLevel = null;\nString oicSourceName = idn.getSourceAttributeBySourceName(application.getName(), \"oicSourceName\");\nString personNumber = null;\nString assignmentStatusType = null;\nString activeLocationCode = null;\nString locationCode = null;\nString displayName = null;\nString managerDisplayName = null;\nString managerEmail = null;\nString jobTitle = null;\nString department = null;\nString locationDescription = null;\nString assignmentStartDateStr = null;\nDate terminationDate = null;\nDate assignmentStartDate = null;\nList assignments = new ArrayList();\nString contractorRequestedByEmail = null;\nString strSOCRequestLog = \"\";\n\npublic ArrayList getADAccountRequests(ProvisioningPlan plan) {\n\tArrayList adAcctRequests = new ArrayList();\n\tif (null != plan && !plan.isEmpty()) {\n\t\tList accRequests = plan.getAccountRequests();\n\t\tif (null != accRequests && !accRequests.isEmpty()) {\n\t\t\tfor (AccountRequest acctRequest : accRequests) {\n\t\t\t\tString appName = acctRequest.getApplication();\n\t\t\t\tif (null != appName && appName.startsWith(applicationName)) {\n\t\t\t\t\tadAcctRequests.add(acctRequest); \n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\treturn adAcctRequests;\n}\n\npublic String getLicenseToBeAssigned(String division, String empType, String managementLevel) {\n\tString corp = null;\n\tString licenseToBeAssigned = \"\";\n\tMap licenseMappingMap = (Map) application.getAttributeValue(\"licenseMapping\");\n\tif(null != division) {\n\t\tcorp = division.substring(0,4);\n\t}\t\n\tif(null != licenseMappingMap) {\n\t\tMap mngLevelMap =licenseMappingMap.get(\"P|E\");\n\t\tif(corp != null && corp.equalsIgnoreCase(\"CORP\")){\n\t\t\tlicenseToBeAssigned = licenseMappingMap.get(\"CorperateLicense\");\n        } else if((empType.equalsIgnoreCase(\"E\") || empType.equalsIgnoreCase(\"P\")) && null != managementLevel && mngLevelMap.get(managementLevel) != null){\n\t\t\tlicenseToBeAssigned = mngLevelMap.get(managementLevel);\n        } else if(empType.equalsIgnoreCase(\"C\")) {\n\t\t\tlicenseToBeAssigned = licenseMappingMap.get(empType);\n        } else if(empType.equalsIgnoreCase(\"V\")) {\n\t\t\tlicenseToBeAssigned = licenseMappingMap.get(empType);\n        } else if(empType.equalsIgnoreCase(\"Contractor\")) {\n\t\t\tlicenseToBeAssigned = licenseMappingMap.get(empType);\n        } else if(empType.equalsIgnoreCase(\"Vendor\")) {\n\t\t\tlicenseToBeAssigned = licenseMappingMap.get(empType);\n        } else if(empType.equalsIgnoreCase(\"Board of Directors\")) {\n\t\t\tlicenseToBeAssigned = licenseMappingMap.get(empType);\n        } else if(empType.equalsIgnoreCase(\"Regulator\")) {\n\t\t\tlicenseToBeAssigned = licenseMappingMap.get(empType);\n        } else if(empType.equalsIgnoreCase(\"Special Firms\")) {\n\t\t\tlicenseToBeAssigned = licenseMappingMap.get(empType);\n        } else {\n\t\t\tlicenseToBeAssigned = licenseMappingMap.get(\"DefaultLicense\");\n        }      \n\t}\n\treturn licenseToBeAssigned;\n}\n\npublic List getFilteredADGroups(String setupLikePersonId) {\n\tList setupLikeADGroupsFiltered = new ArrayList();\n\tif(null != setupLikePersonId) {\n\t\tList setupLikeADGroups = new ArrayList();\n\t\tAccount setupLikeADAccount = idn.getFirstAccount(applicationName, setupLikePersonId);\n\t\tif(setupLikeADAccount != null) {\n\t\t\tObject setupLikeADGroupObj = idn.getRawAccountAttribute(setupLikeADAccount, \"memberOf\");\n\t\t\tif(null != setupLikeADGroupObj && setupLikeADGroupObj instanceof String) {\n\t\t\t\tsetupLikeADGroups.add(String.valueOf(setupLikeADGroupObj));\n\t\t\t} else if(null != setupLikeADGroupObj && setupLikeADGroupObj instanceof List) {\n\t\t\t\tsetupLikeADGroups = (List) setupLikeADGroupObj;\n\t\t\t}\t\t\t\t\t\n\t\t\tif(null != setupLikeADGroups && !setupLikeADGroups.isEmpty()) {\n\t\t\t\tsetupLikeADGroupsFiltered.addAll(setupLikeADGroups);\n\t\t\t\tString filterADGroupPattern = (String) application.getAttributeValue(\"filterADGroupPattern\");\n\t\t\t\tfor(String adGroup : setupLikeADGroups){\n\t\t\t\t\tPattern findMyPattern = Pattern.compile(filterADGroupPattern, Pattern.CASE_INSENSITIVE);\n\t\t\t\t\tMatcher foundAMatch = findMyPattern.matcher(adGroup);\t\t\t\t\t\n\t\t\t\t\tif(foundAMatch.find()){\n\t\t\t\t\t\tsetupLikeADGroupsFiltered.remove(adGroup);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\t\n\treturn setupLikeADGroupsFiltered;\n}\n\npublic String getOUBasedOnLocation(String locationCode) {\n\tString newOU = null;\n\tif(null != locationCode) {\n\t\tMap orgUnitMappings =  (Map) application.getAttributeValue(\"orgUnitMappings\");\n\t\tif(null != orgUnitMappings && orgUnitMappings.containsKey(locationCode)) {\n\t\t\tnewOU = orgUnitMappings.get(locationCode);\n\t\t}\n\t}\n\treturn newOU;\n}\n\npublic List getRBACProxyADGroups(String activeLocationCode, String personNumber, String managementLevelFlag) {\n\tList proxyADGroups = new ArrayList();\n\tboolean excLocFlag=false;\n\tboolean mngLevelFlag = \"true\".equalsIgnoreCase(managementLevelFlag);\n\tboolean divisionFlag=false;\n\tList assignments = (List) idn.getRawAccountAttribute(oicSourceName, personNumber, \"assignments\");\t\t\t\t\t\t\n\tif(null != assignments && assignments instanceof List && !assignments.isEmpty()) {\n\t\tfor(String assignment : assignments){\n\t\t\tString[] strArray=assignment.split(\"##\");\n\t\t\tString division=strArray[2];\n\t\t\tif(division!=null && division.startsWith(\"Corp\")){\n\t\t\t\tdivisionFlag = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\t\n\tif(null != activeLocationCode) {\n\t\tString[] activeLocationCodeArray = activeLocationCode.split(\",\");\n\t\tList adLocExclusionList = (List) application.getAttributeValue(\"adLocExclusionList\");\n\t\tfor(String activeLocation : activeLocationCodeArray) {\n\t\t\tif(null != adLocExclusionList && adLocExclusionList.contains(activeLocation.trim())) {\n\t\t\t\texcLocFlag = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\t\t\t\t\t\t\t\n\tif(!excLocFlag && mngLevelFlag) {\n\t\tMap groupsMap = new HashMap();\n\t\tif(divisionFlag) {\n\t\t\tgroupsMap = (Map) application.getAttributeValue(\"corpProxyUserADGroups\");\n\t\t} else {\n\t\t\tgroupsMap = (Map) application.getAttributeValue(\"proxyUserADGroups\");\n\t\t}\n\t\tif(null != activeLocationCode) {\n\t\t\tString[] activeLocationCodeArray = activeLocationCode.split(\",\");\n\t\t\tfor(String activeLocation : activeLocationCodeArray) {\n\t\t\t\tString proxyGroupName = groupsMap.get(activeLocation.trim());\n\t\t\t\tif(null != proxyGroupName) {\n\t\t\t\t\tproxyADGroups.add(proxyGroupName);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\treturn proxyADGroups;\n}\n\npublic List getRBACOktaGeneysGroups(String activeLocationCode) {\n\tList oktaGenesysADGroups = new ArrayList();\n\tif(null != activeLocationCode && activeLocationCode.contains(\"BLV_CALL\")){\n\t\toktaGenesysADGroups = (List) application.getAttributeValue(\"oktaGenesysGroups\");\n\t}\t\t\n\treturn oktaGenesysADGroups;\n}\n\npublic List getOldRBACOktaGeneysGroups(Object memberOfValueObj) {\n\tList result = new ArrayList();\n\tList oktaGenesysADGroups = (List) application.getAttributeValue(\"oktaGenesysGroups\");\n\tfor(String oktaGenesysADGroup : oktaGenesysADGroups) {\t\t\n\t\tif(null != memberOfValueObj && memberOfValueObj instanceof String) {\n\t\t\tif(String.valueOf(memberOfValueObj).equalsIgnoreCase(oktaGenesysADGroup)) {\n\t\t\t\tresult.add(String.valueOf(memberOfValueObj));\n\t\t\t} \n\t\t} else if(null != memberOfValueObj && memberOfValueObj instanceof List) {\n\t\t\tList groups = (List) memberOfValueObj;\n\t\t\tif(null != groups && !groups.isEmpty()) {\n\t\t\t\tfor(String group : groups) {\n\t\t\t\t\tif(group.equalsIgnoreCase(oktaGenesysADGroup)) {\n\t\t\t\t\t\tresult.add(group);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\treturn result;\n} \n\npublic List getRBACKGlobalProtectGroups(String managementLevelFlag, String personNumber, String oicSourceName) {\n\tList globalProtectADGroups = new ArrayList();\n\tif(null != managementLevelFlag && \"true\".equalsIgnoreCase(managementLevelFlag)) {\n\t\tglobalProtectADGroups = (List) application.getAttributeValue(\"globalProtectGroups\");\t\t\t\t\t\n\t} else {\t\t\t\t\t\t\t\n\t\tList assignments = (List) idn.getRawAccountAttribute(oicSourceName, personNumber, \"assignments\");\n\t\tboolean divisionFlag=false;\n\t\tif(null != assignments && assignments instanceof List && !assignments.isEmpty()) {\n\t\t\tfor(String assignment : assignments){\n\t\t\t\tString[] strArray=assignment.split(\"##\");\n\t\t\t\tString division=strArray[2];\n\t\t\t\tif(division!=null && division.equalsIgnoreCase(\"Corp Finance - IT\")){\n\t\t\t\t\tdivisionFlag = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif(divisionFlag) {\n\t\t\tglobalProtectADGroups = (List) application.getAttributeValue(\"globalProtectGroups\");\n\t\t}\n\t}\n\treturn globalProtectADGroups;\n}\n\npublic List getOldRBACProxyADGroups(Object memberOfValueObj) {\n\tList result = new ArrayList();\n\tif(null != memberOfValueObj && memberOfValueObj instanceof String) {\n\t\tif(String.valueOf(memberOfValueObj).startsWith(\"CN=Proxy Users\")) {\n\t\t\tresult.add(String.valueOf(memberOfValueObj));\n\t\t} \n\t} else if(null != memberOfValueObj && memberOfValueObj instanceof List) {\n\t\tList groups = (List) memberOfValueObj;\n\t\tif(null != groups && !groups.isEmpty()) {\n\t\t\tfor(String group : groups) {\n\t\t\t\tif(group.startsWith(\"CN=Proxy Users\")) {\n\t\t\t\t\tresult.add(group);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\treturn result;\n}\n\npublic List getBirthrightGroups(String assignmentStatusType, String activeLocationCode, String personNumber, String managementLevelFlag, String oicSourceName) {\n  if (assignmentStatusType == null || \"INACTIVE\".equalsIgnoreCase(assignmentStatusType)) {\n    return new ArrayList();\n  }\n  List all = new ArrayList();\n  List g1 = getRBACOktaGeneysGroups(activeLocationCode);\n  if (g1 != null && !g1.isEmpty()) all.addAll(g1);\n  List g2 = getRBACKGlobalProtectGroups(managementLevelFlag, personNumber, oicSourceName);\n  if (g2 != null && !g2.isEmpty()) all.addAll(g2);\n  List g3 = getRBACProxyADGroups(activeLocationCode, personNumber, managementLevelFlag);\n  if (g3 != null && !g3.isEmpty()) all.addAll(g3);\n  return all;\n}\n\npublic void addBirthrightIfAny(ProvisioningPlan.AccountRequest r, List grps) {\n  if (grps != null && !grps.isEmpty()) {\n    r.add(new ProvisioningPlan.AttributeRequest(\"memberOf\", ProvisioningPlan.Operation.Add, grps));\n  }\n}\n\npublic boolean removeGroup(String group) {\n\tList o365Groups =  (List) application.getAttributeValue(\"o365Groups\");\n\tString domainUsersGroup = \"CN=Domain Users,OU\";\n\tif(null != group && group.startsWith(domainUsersGroup)) {\n\t\treturn true;\n\t}\n\tif(null != group && null != o365Groups && !o365Groups.isEmpty()) {\n\t\tfor(String  o365Grp : o365Groups) {\n\t\t\tif(group.equalsIgnoreCase(o365Grp))\n\t\t\t\treturn true;\n\t\t}\n\t}\n\treturn false;\n}\n\npublic boolean hasExchangeGrp(List groups) {\n\tboolean result = false;\n\tList o365Groups =  (List) application.getAttributeValue(\"o365Groups\");\n\tif(null != groups && groups.size() != 0 && null != o365Groups){\n\t\tfor(String group : groups) {\n\t\t\tif(null != o365Groups && o365Groups.size() != 0) {\n\t\t\t\tfor(String  o365Grp : o365Groups) {\n\t\t\t\t\tif(group.equalsIgnoreCase(o365Grp)) {\n\t\t\t\t\t\tresult = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(result) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\treturn result;\n}\n\npublic List removeGroup(List groups) {\n    List returnList = new ArrayList();\n\tString domainUsersGroup = \"CN=Domain Users,OU\";\n\tList o365Groups =  (List) application.getAttributeValue(\"o365Groups\");\n    if(null != groups && groups.size() != 0 && null != o365Groups){\n      for(String group : groups) {\n\t\tif(group.startsWith(domainUsersGroup))\n\t\t\tcontinue;\n        boolean o365 = false;\n        if(null != o365Groups && o365Groups.size() != 0) {\n          for(String  o365Grp : o365Groups) {\n            if(group.equalsIgnoreCase(o365Grp))\n              o365=true;\n          }\n          if(!o365)\n            returnList.add(group);\n        }\n      }\n    }\n    return returnList;\n}\n\npublic List removeDomainUsersGroup(List groups) {\n    List returnList = new ArrayList();\n\tString domainUsersGroup = \"CN=Domain Users,OU\";\t\n    if(null != groups && groups.size() != 0){\n      for(String group : groups) {\n\t\tif(group.startsWith(domainUsersGroup))\n\t\t\tcontinue;\n\t\treturnList.add(group);\n      }\n    }\n    return returnList;\n}\n\npublic boolean isSetupLike(List attReqs, String sourceAttrName) {\n\tboolean result = false;\n\tif(null != attReqs && !attReqs.isEmpty()) {\n\t\tfor(ProvisioningPlan.AttributeRequest attReq : attReqs) {\n\t\t\tif(attReq.getOperation() == ProvisioningPlan.Operation.Add) {\n\t\t\t\tObject memberOf = attReq.getValue();\n\t\t\t\tif(null != memberOf) {\n\t\t\t\t\tString targetEnt = idn.getSourceAttributeBySourceName(application.getName(), sourceAttrName);\n\t\t\t\t\tif(null != targetEnt) {\n\t\t\t\t\t\tif(memberOf instanceof String && String.valueOf(memberOf).equalsIgnoreCase(targetEnt)) {\n\t\t\t\t\t\t\tresult = true;\n\t\t\t\t\t\t} else if(memberOf instanceof List) {\n\t\t\t\t\t\t\tList groups = (List) memberOf;\n\t\t\t\t\t\t\tif(groups.contains(targetEnt)) {\n\t\t\t\t\t\t\t\tresult = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\t\n\treturn result;\n}\n\npublic String generatePassword() {\n\tString capitalCaseLetters = \"ABCDEFGHIJKLMNOPQRSTUVWXYZ\";\n\tString lowerCaseLetters = \"abcdefghijklmnopqrstuvwxyz\";\n    String numbers = \"1234567890\";\n    String specialCharacters = \"$#@*!^_-\";\n    int passwordLength = 14;\n    char[] password = new char[passwordLength];\n    String combinedChars = capitalCaseLetters + lowerCaseLetters + specialCharacters + numbers;\n    Random random = new Random();\n        \n    password[0] = lowerCaseLetters.charAt(random.nextInt(lowerCaseLetters.length()));\n    password[1] = capitalCaseLetters.charAt(random.nextInt(capitalCaseLetters.length()));\n    password[2] = specialCharacters.charAt(random.nextInt(specialCharacters.length()));\n    password[3] = numbers.charAt(random.nextInt(numbers.length()));\n\n    for (int i = 4; i < passwordLength; i++) {\n\t\tpassword[i] = combinedChars.charAt(random.nextInt(combinedChars.length()));\n\t}\n\treturn String.valueOf(password);\n}\n\npublic String getAssignmentStartDateString(Object assignmentStartDateObj) {\n\tString result = \"\";\n\tif(null != assignmentStartDateObj) {\n\t\tif(assignmentStartDateObj instanceof String && assignmentStartDateObj != \"\") {\n\t\t\tresult = (String) assignmentStartDateObj;\n\t\t} else if(assignmentStartDateObj instanceof Date) {\n\t\t\tDate tmpDate = (Date) assignmentStartDateObj;\n\t\t\tresult = new SimpleDateFormat(\"yyyy-MM-dd\").format(tmpDate);\n\t\t}\n\t}\n\treturn result;\n}\n\npublic Date getTerminationDate(Object termDateObj) {\n\tDate result = null;\t\t\t\t\t\n\tif(null != termDateObj && termDateObj instanceof String && termDateObj != \"\") {\n\t\tSimpleDateFormat myFormat = new SimpleDateFormat(\"yyyy-MM-dd\");\n\t\tresult = myFormat.parse(termDateObj);\n\t} else if (null != termDateObj && termDateObj instanceof Date) {\n\t\tSimpleDateFormat myFormat = new SimpleDateFormat(\"yyyy-MM-dd\");\n\t\tresult = myFormat.parse(myFormat.format(termDateObj));\n\t}\n\treturn result;\n}\n\npublic String adFileTimePlusOneDay(Date base) {\n    Calendar cal = Calendar.getInstance();\n    cal.setTime(base);\n    cal.add(Calendar.DATE, 1);\n    long millis = cal.getTimeInMillis();\n    long fileTime = (millis * 10000L)\n                    + 116444736000000000L        \n                    + 216000000000L;       \n    return String.valueOf(fileTime);\n}\n\npublic String adFileTimeAtMidnightPDT(LocalDate d) {\n    Calendar c = Calendar.getInstance(TimeZone.getTimeZone(\"PDT\"));\n    c.clear();\n    c.set(d.getYear(), d.getMonthValue() - 1, d.getDayOfMonth(), 0, 0, 0);\n    long millis = c.getTimeInMillis();\n    long fileTime = (millis * 10000L) + 116444736000000000L + 216000000000L;\n    return String.valueOf(fileTime);\n}\n\npublic Date minDate(Date a, Date b) {\n    if (a == null) return b;\n    if (b == null) return a;\n    return a.compareTo(b) <= 0 ? a : b;\n}\n\npublic AccountRequest leaverPlan(AccountRequest acctReq, String personNumber, String nativeIdentity, String action) {\n\tif(null != identity && null != personNumber && null != nativeIdentity && null != action && null != acctReq) {\n\t\tboolean exchangeDeprovNeeded = false;\n\t\tboolean terminationFlag = false;\n\t\tboolean legalHold = false;\n\t\tString harrahsLegalHoldGroup = (String) idn.getSourceAttributeBySourceName(applicationName, \"harrahsLegalHoldGroup\");\n\t\tString harrahsLegalHoldOU = (String) idn.getSourceAttributeBySourceName(applicationName, \"harrahsLegalHoldOU\");\n\t\tString contractorDisabledOUHarrahs = (String) idn.getSourceAttributeBySourceName(applicationName, \"contractorDisabledOUHarrahs\");\n\t\tString oldOUHarrahs = nativeIdentity.toUpperCase();\n\t\tString description = (String) idn.getRawAccountAttribute(applicationName, nativeIdentity, \"description\");\n\t\tif(null != description)\n\t\t\tdescription = description.toUpperCase();\n\t\telse\n\t\t\tdescription = \"\";\n\t\tString mailNickNameHarrahs = (String) idn.getRawAccountAttribute(applicationName, nativeIdentity, \"mailNickname\");\n\t\tString upn = (String) idn.getRawAccountAttribute(applicationName, nativeIdentity, \"userPrincipalName\");\n\t\tString samName = (String) idn.getRawAccountAttribute(applicationName, nativeIdentity, \"sAMAccountName\");\n\t\tString parentHarrahsOU = \"\";\n\t\tString newHarrahsOU = null;\t\t\t\t\n\t\tif(null != mailNickNameHarrahs)\n\t\t\texchangeDeprovNeeded = true;\n\t\tif(null != oldOUHarrahs && null != description &&\n\t\t\tdescription.indexOf(\"TERM(\" ) == -1 &&\n\t\t\tdescription.indexOf(\"TERM (\" ) == -1 &&\n\t\t\toldOUHarrahs.indexOf(\"OU=SDS USERS\" ) == -1 && \n\t\t\toldOUHarrahs.indexOf(\"OU=BOSS USERS\" ) == -1\n\t\t) {\n\t\t\tterminationFlag = true;\n\t\t\tint i=oldOUHarrahs.indexOf(\"OU=USERS\");\n\t\t\tif(i != -1) {\n\t\t\t\tchar[] charArray=oldOUHarrahs.toCharArray();\n\t\t\t\tfor(int j = i; j < oldOUHarrahs.length(); j++)\n\t\t\t\t\tparentHarrahsOU=parentHarrahsOU+charArray[j];\n\t\t\t}\t\t\t\t\t\t\t\n\t\t}\n\t\tif(terminationFlag) {\n\t\t\tif(\"Employee\".equalsIgnoreCase(workerType) && \n\t\t\t\tnull != employeeType && \n\t\t\t\t(employeeType.equalsIgnoreCase(\"E\") || employeeType.equalsIgnoreCase(\"P\"))\n\t\t\t){\n\t\t\t\tif(null != parentHarrahsOU && !parentHarrahsOU.equals(\"\")){\n\t\t\t\t\tnewHarrahsOU = \"OU=Disabled,\" + parentHarrahsOU;\n\t\t\t\t} else {\n\t\t\t\t\tnewHarrahsOU = oldOUHarrahs;\n\t\t\t\t}\n\t\t\t} else if(null != contractorDisabledOUHarrahs){\n\t\t\t\tnewHarrahsOU = contractorDisabledOUHarrahs;\n\t\t\t}\t\t\t\t\t\t\t\n\t\t\tint intIndex =0;\n\t\t\tif(null != description) {\n\t\t\t\tintIndex= description.toUpperCase().indexOf(\"LEGAL HOLD\");\n\t\t\t\tif(intIndex != - 1) {\n\t\t\t\t\tlegalHold = true;\n\t\t\t\t\tif(null != harrahsLegalHoldGroup) {\n\t\t\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"memberOf\",ProvisioningPlan.Operation.Add, harrahsLegalHoldGroup));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tObject oldMemberOfValue = idn.getRawAccountAttribute(applicationName, nativeIdentity, \"memberOf\");\n\t\t\tif(\n\t\t\t\t\"Employee\".equalsIgnoreCase(workerType) &&\n\t\t\t\tnull != employeeType && \n\t\t\t\tnull != oldMemberOfValue &&\n\t\t\t\t(employeeType.equalsIgnoreCase(\"E\") || employeeType.equalsIgnoreCase(\"P\"))\n\t\t\t) {\n\t\t\t\tif(oldMemberOfValue instanceof String) {\n\t\t\t\t\tString group = (String) oldMemberOfValue;\n\t\t\t\t\tboolean exchangeGrp = removeGroup(group);\n\t\t\t\t\tif(!exchangeGrp) {\n\t\t\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"memberOf\",ProvisioningPlan.Operation.Remove,group));\n\t\t\t\t\t\texchangeDeprovNeeded = false;\n\t\t\t\t\t} else {\n\t\t\t\t\t\texchangeDeprovNeeded = true;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tList groups = (List) oldMemberOfValue;\n\t\t\t\t\tboolean hasExcGrp = hasExchangeGrp(groups);\n\t\t\t\t\tList exceptExchangeGrp = removeGroup(groups);\t\t\t\t\t\t\n\t\t\t\t\tif(null != groups && !hasExcGrp) {\n\t\t\t\t\t\texchangeDeprovNeeded = false;\n\t\t\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"memberOf\",ProvisioningPlan.Operation.Remove,exceptExchangeGrp));\n\t\t\t\t\t} else {\n\t\t\t\t\t\texchangeDeprovNeeded = true;\n\t\t\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"memberOf\",ProvisioningPlan.Operation.Remove,exceptExchangeGrp));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if(null != oldMemberOfValue) {\n\t\t\t\tif(oldMemberOfValue instanceof String) {\n\t\t\t\t\tString group = (String) oldMemberOfValue;\n\t\t\t\t\tif(null != group && !group.startsWith(\"CN=Domain Users,OU\")) {\n\t\t\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"memberOf\",ProvisioningPlan.Operation.Remove,group));\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tList groups = (List) oldMemberOfValue;\n\t\t\t\t\tList exceptDomainUsersGrp = removeDomainUsersGroup(groups);\n\t\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"memberOf\", ProvisioningPlan.Operation.Remove, exceptDomainUsersGrp));\n\t\t\t\t}\n\t\t\t}\t\t\t\t\t\t\t\n\t\t\tif(\n\t\t\t\tnull == oldMemberOfValue || \n\t\t\t\t(!exchangeDeprovNeeded) || \n\t\t\t\t(!employeeType.equalsIgnoreCase(\"E\") && !employeeType.equalsIgnoreCase(\"P\")) ||\n\t\t\t\t(!\"Employee\".equalsIgnoreCase(workerType))\n\t\t\t) {\n\t\t\t\tif(legalHold && null != harrahsLegalHoldOU) {\n\t\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"AC_NewParent\", ProvisioningPlan.Operation.Set, harrahsLegalHoldOU));\n\t\t\t\t} else {\n\t\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"AC_NewParent\", ProvisioningPlan.Operation.Set, newHarrahsOU));\n\t\t\t\t}\n\t\t\t}\n\t\t\tString oldDesc = (String) idn.getRawAccountAttribute(applicationName, nativeIdentity, \"description\");\n\t\t\tif(oldDesc == null)\n\t\t\t\toldDesc = \"\";\n\t\t\toldDesc = oldDesc.replaceAll(\"(?i)LOA\\\\([^)]*\\\\)\", \"\").replaceAll(\"  +\", \" \").trim();\n\t\t\tDate date = new Date();\n\t\t\tSimpleDateFormat formatter = new SimpleDateFormat(\"MM/dd/yyyy\");\n\t\t\tString todayDate = formatter.format(date);\n\t\t\tString termDescription = \"TERM(\" + todayDate + \") \" + oldDesc;\n\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"description\", ProvisioningPlan.Operation.Set, termDescription.trim()));\n\t\t\tDate baseDate = (terminationDate != null) ? terminationDate : new Date();\n\t\t\tString adTimeStamp = adFileTimePlusOneDay(baseDate);\t\t\n\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"accountExpires\", ProvisioningPlan.Operation.Set, adTimeStamp));\n\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"manager\", ProvisioningPlan.Operation.Set, \"\"));\n\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"userAccountControl\", ProvisioningPlan.Operation.Set, 512));\n\t\t\tacctReq.addArgument(\"excScriptUPN\", upn);\n\t\t\tacctReq.addArgument(\"excScriptSAMAccName\", samName);\n\t\t\tacctReq.addArgument(\"excScriptEmpType\", employeeType);\n\t\t\tacctReq.addArgument(\"excScriptWorkerType\", workerType);\n\t\t\tacctReq.addArgument(\"excScriptManagerDisplayName\", managerDisplayName);\n\t\t\tacctReq.addArgument(\"excScriptManagerEmail\", managerEmail);\n\t\t\tacctReq.addArgument(\"excScriptIdentityDisplayName\", displayName);\n\t\t\tacctReq.addArgument(\"excScriptLifeCycleState\", lifeCycleState);\n\t\t\tacctReq.addArgument(\"excScriptPersonNumber\", personNumber);\n\t\t\tif(exchangeDeprovNeeded) {\n\t\t\t\tacctReq.addArgument(\"excScript\", \"true\");\n\t\t\t\tacctReq.addArgument(\"excScriptName\", \"exchangeDeprovision\");\n\t\t\t\tacctReq.addArgument(\"excScriptDomain\", \"H\");\n\t\t\t}\n\t\t} else {\t\t\t\t\t\n\t\t\tif(\n\t\t\t\t((oldOUHarrahs.indexOf(\"OU=SDS USERS\" ) != -1) || (oldOUHarrahs.indexOf(\"OU=BOSS USERS\" ) != -1)) && \n\t\t\t\tnull != description &&\n\t\t\t\tdescription.indexOf(\"TERM(\" ) == -1 &&\n\t\t\t\tdescription.indexOf(\"TERM (\" ) == -1\n\t\t\t) {\n\t\t\t\tacctReq.setOperation(ProvisioningPlan.AccountRequest.Operation.Modify);\n\t\t\t\tacctReq.addArgument(\"excScriptSendExclusionSDSBOSSEmail\", \"true\");\n\t\t\t}\n\t\t}\t\t\n\t}\n\treturn acctReq;\t\n}\n\npublic AccountRequest modifyPlan(String personNumber, String nativeIdentity, String action, int legalHoldIndex) {\n\tAccountRequest acctReq = new AccountRequest();\n\tif(null != identity && null != personNumber && null != action) {\t\t\n\t\tString newDescription = null;\n\t\tString newOU = null;\n\t\tString newPassword = null;\n\t\tString newManagerDN = null;\n\t\tString fName = identity.getFirstname();\n\t\tString lName = identity.getLastname();\n\t\tString pName = (String) identity.getAttribute(\"preferredName\");\n\t\tString displayName = null;\n\t\tString suffix = (String) identity.getAttribute(\"employeeSuffix\");\n\t\tString location = (String) identity.getAttribute(\"locationDescription\");\n\t\tString company=null;\n\t\tString department=null;\n\t\tString dept = (String) identity.getAttribute(\"department\");\n\t\tString jobTitle = (String) identity.getAttribute(\"jobTitle\");\t\t\t\n\t\tString division = (String) identity.getAttribute(\"division\");\n\t\tString property = (String) identity.getAttribute(\"propertyCode\");\n\t\tString mName = (String) identity.getAttribute(\"employeeMiddleName\");\n\t\tString legalPay = (String) identity.getAttribute(\"LegalPaySystem\");\n\t\tString assignStatusTypeCode = (String) identity.getAttribute(\"assignmentStatusTypeCode\");\n\t\tString region = (String) identity.getAttribute(\"region\");\n\t\tString businessUnitName = (String) identity.getAttribute(\"businessUnitName\");\n\t\tString mngLevel = (String) idn.getRawAccountAttribute(oicSourceName, personNumber, \"ManagementLevel\");\n\t\tString locationCode = (String) identity.getAttribute(\"locationCode\");\n\t\tString assignmentStatusType = (String) identity.getAttribute(\"assignmentStatusType\");\n\t\tString managementLevelFlag = (String) identity.getAttribute(\"managementLevelFlag\");\n\t\tString activeLocationCode = (String) identity.getAttribute(\"activeLocationCode\");\n\t\tString cloudLifecycleState = (String) identity.getAttribute(\"cloudLifecycleState\");\n\t\tString empLastFourDigit = \"\";\t\t\t\t\t\t\n\t\tif(null != personNumber) {\n\t\t\tfor(int i = personNumber.length()-4; i < personNumber.length(); i++)\n\t\t\t\tempLastFourDigit = empLastFourDigit + personNumber.charAt(i); \n\t\t}\t\t\t\t\t\t\t\n\t\tif(null != jobTitle && null != empLastFourDigit)     \n\t\t\tnewDescription = jobTitle + \" *\" + empLastFourDigit;\n\t\tif(legalHoldIndex != -1)\n\t\t\tnewDescription = \"LEGAL HOLD \" + newDescription;\n\t\tnewOU = getOUBasedOnLocation(locationCode);\n\t\tnewPassword = generatePassword();\n\t\tnewManagerDN = (String) identity.getAttribute(\"managerHarrahsDn\");\t\t\t\t\t\t\n\t\tif(null != pName && null != lName)\n\t\t\tdisplayName = pName + \" \" + lName.split(\" \")[0];\n\t\telse if(null != fName && null != lName)\n\t\t\tdisplayName = fName + \" \" + lName.split(\" \")[0];\t\t\t\t\t\t\n\t\tif(null != property && null != division)\n\t\t\tcompany = property + \": \" + division;\n\t\tif(null != locationCode && null != dept)\n\t\t\tdepartment = locationCode + \": \" + dept; \n\t\tif(null != newOU) {\n\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"AC_NewParent\", ProvisioningPlan.Operation.Set, newOU));\n\t\t}\n\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"accountExpires\", ProvisioningPlan.Operation.Set, \"never\"));\n\t\tif(null != personNumber){\n\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"employeeNumber\", ProvisioningPlan.Operation.Set, personNumber));\n\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"employeeID\", ProvisioningPlan.Operation.Set, personNumber));\n\t\t}\t\t\t\t\t\t\n\t\tif(null != newManagerDN)\n\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"manager\", ProvisioningPlan.Operation.Set, newManagerDN));\t\t\t\t\t\t\n\t\tif(null != fName)\n\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"givenName\", ProvisioningPlan.Operation.Set,fName ));\t\t\t\t\t\t\t\n\t\tif(null != lName)\n\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"sn\", ProvisioningPlan.Operation.Set,lName ));\t\t\t\t\t\n\t\tif(null != suffix)\n\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"generationQualifier\", ProvisioningPlan.Operation.Set,suffix ));\t\t\t\t\t\t\n\t\tif(null != displayName)\n\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"displayName\", ProvisioningPlan.Operation.Set, displayName));\n\t\tif(null != company) {\n\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"company\", ProvisioningPlan.Operation.Set, company));\n\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"department\", ProvisioningPlan.Operation.Set, department));\n\t\t}\t\t\t\t\t\t\t\n\t\tif(null != jobTitle) {\n\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"title\", ProvisioningPlan.Operation.Set, jobTitle));\n\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"msExchExtensionAttribute39\", ProvisioningPlan.Operation.Set, jobTitle));\n\t\t}\n\t\tif(null != newDescription)\n\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"description\", ProvisioningPlan.Operation.Set, newDescription));\n\t\tif(null != mName)\n\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"middleName\", ProvisioningPlan.Operation.Set,mName ));\n\t\tif(null != employeeType && employeeType.equalsIgnoreCase(\"E\"))\n\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"employeeType\", ProvisioningPlan.Operation.Set,\"Employee\"));\n\t\tif(null != assignStatusTypeCode)\n\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"extensionAttribute12\", ProvisioningPlan.Operation.Set, assignStatusTypeCode ));\n\t\tif(null != region)\n\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"extensionAttribute4\", ProvisioningPlan.Operation.Set, region ));\n\t\tif(null != mngLevel)\n\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"extensionAttribute9\", ProvisioningPlan.Operation.Set, mngLevel ));\n\t\tif(null != businessUnitName)\n\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"extensionAttribute5\", ProvisioningPlan.Operation.Set, businessUnitName ));\t\n\t\tif(action.equalsIgnoreCase(\"rehireModify\")) {\n\t\t\tif(null != newPassword) {\n\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"password\", ProvisioningPlan.Operation.Set, newPassword));\n\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"pwdLastSet\", ProvisioningPlan.Operation.Set, true));\n\t\t\t}\n\t\t\tif(null != cloudLifecycleState && \"prehire\".equalsIgnoreCase(lifeCycleState)) {\n\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"userAccountControl\", ProvisioningPlan.Operation.Set, 514));\n\t\t\t} else if(null != cloudLifecycleState && \"active\".equalsIgnoreCase(lifeCycleState)) {\n\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"userAccountControl\", ProvisioningPlan.Operation.Set, 512));\n\t\t\t}\n\t\t}\n\t\tif(action.equalsIgnoreCase(\"rehireEnable\")) {\n\t\t\tif(null != newPassword) {\n\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"password\", ProvisioningPlan.Operation.Set, newPassword));\n\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"pwdLastSet\", ProvisioningPlan.Operation.Set, true));\n\t\t\t}\n\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"userAccountControl\", ProvisioningPlan.Operation.Set, 512));\n\t\t}\n\t\tif(action.equalsIgnoreCase(\"cnowModify\")) {\n\t\t\tif(null != cloudLifecycleState && \"prehire\".equalsIgnoreCase(lifeCycleState)) {\n\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"userAccountControl\", ProvisioningPlan.Operation.Set, 514));\n\t\t\t} else if(null != cloudLifecycleState && \"active\".equalsIgnoreCase(lifeCycleState)) {\n\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"userAccountControl\", ProvisioningPlan.Operation.Set, 512));\n\t\t\t}\n\t\t\tObject memberOfValueObj = idn.getRawAccountAttribute(applicationName, nativeIdentity, \"memberOf\");\n\t\t\tif(null != memberOfValueObj && memberOfValueObj instanceof String) {\n\t\t\t\tif(null != newPassword) {\n\t\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"password\", ProvisioningPlan.Operation.Set, newPassword));\n\t\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"pwdLastSet\", ProvisioningPlan.Operation.Set, true));\n\t\t\t\t\tacctReq.addArgument(\"excScriptSendPwdEmail\", \"true\");\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tList grps = (List) memberOfValueObj;\n\t\t\t\tif(null != grps && !grps.isEmpty() && grps.size() < 4) {\n\t\t\t\t\tif(null != newPassword) {\n\t\t\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"password\", ProvisioningPlan.Operation.Set, newPassword));\n\t\t\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"pwdLastSet\", ProvisioningPlan.Operation.Set, true));\n\t\t\t\t\t\tacctReq.addArgument(\"excScriptSendPwdEmail\", \"true\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\t\t\t\n\t\t}\n\t\tList br = getBirthrightGroups(assignmentStatusType, activeLocationCode, personNumber, managementLevelFlag, oicSourceName);\n\t\taddBirthrightIfAny(acctReq, br);\n\t}\n\treturn acctReq;\n}\n\npublic String cleanData(String inputString) {\n\tif (inputString != null) {\n\t\tinputString = inputString.replaceAll(\"[^A-Za-z0-9]\", \"\");\n\t\tinputString = StringUtils.trimToNull(inputString);\n\t\tif (inputString != null) {\n\t\t\tinputString = inputString.replaceAll(\"[\\\\s\\\\-()]\", \"\");\n\t\t\tinputString = inputString.replaceAll(\"&#39;\", \"\");\n\t\t\tinputString = inputString.toLowerCase();\n\t\t}\n\t}\n\treturn inputString;\n}\n\npublic boolean checkUnique(String cn) {\n\tboolean isCNUnique = false;\n\tString op = \"StartsWith\";\n\tString searchableCN = \"searchableCN\";\n\tString harrahsADSourceId = idn.getSourceAttributeBySourceName(application.getName(), \"harrahsADSourceId\");\n\tString whADSourceId = idn.getSourceAttributeBySourceName(application.getName(), \"whADSourceId\");\n\tString devADSourceId = idn.getSourceAttributeBySourceName(application.getName(), \"devADSourceId\");\n\tList SOURCE_IDS = new ArrayList(Arrays.asList(new String[] {\n\t\tharrahsADSourceId,\n\t\twhADSourceId,\n\t\tdevADSourceId\n\t}));\n\tList SEARCH_VALUES = new ArrayList(Arrays.asList(new String[] {\n\t\tcn\n\t}));\n\tisCNUnique = idn.attrSearchCountAccounts(SOURCE_IDS, searchableCN, op, SEARCH_VALUES) == 0 ? true : false;\n\treturn isCNUnique;\n}\n\npublic String getCN(String fname, String lname) {\n\tboolean isUnique = false;\n\tString firstName = fname;\n\tString lastName = lname;\n\tif(firstName != null)\n\t\tfirstName = firstName.trim();\n\tif(lastName != null)\n\t\tlastName = lastName.trim();\n\tString cn = new String();\n\tif(null != firstName && firstName.trim().length() > 0) {\n\t\tfirstName = cleanData(firstName);\n\t\tif(null != firstName && firstName.trim().length() > 0) {\n\t\t\tif(firstName.length() > 1) {\n\t\t\t\tfirstName = firstName.substring(0, 1).toUpperCase() + firstName.substring(1);\n\t\t\t} else {\n\t\t\t\tfirstName = firstName.toUpperCase();\n\t\t\t}\n\t\t}\n\t}\n\tif(null != lastName && lastName.trim().length() > 0) {\n\t\tlastName = cleanData(lastName);\n\t\tif(null != lastName && lastName.trim().length() > 0) {\n\t\t\tif(lastName.length() > 1) {\n\t\t\t\tlastName = lastName.substring(0, 1).toUpperCase() + lastName.substring(1);\n\t\t\t} else {\n\t\t\t\tlastName = lastName.toUpperCase();\n\t\t\t}\n\t\t}\n\t}\n\tif(null == firstName || null == lastName || firstName.trim().length() == 0 || lastName.trim().length() == 0) {\n\t\treturn cn;\n\t}\n\tcn = firstName + \" \" + lastName;\n\tString tempCN = cn;\n\tfor(int count = 1; count < 1000; count++) {\n\t\tisUnique = checkUnique(tempCN);\n\t\tif(isUnique) {\n\t\t\tcn = tempCN;\n\t\t\tbreak;\n\t\t}\n\t\ttempCN = firstName + \" \" + lastName + count;\n\t}\n\treturn cn;\n}\n\npublic String getAccountAttributeValue(String applicationName, String attributeName, String nativeIdentity) {\n\tString attrValue = \"\";\n\tAccount account = idn.getAccountByNativeIdentity(applicationName, nativeIdentity);\n\tstrSOCRequestLog = strSOCRequestLog+ \"In getAccountAttributeValue account:\"+account;\n\tif(account != null) {\n\t\tMap accountAttrMap = account.getAttributes();\n\t\tObject object = idn.getRawAccountAttribute(account, attributeName);\n\t\tstrSOCRequestLog = strSOCRequestLog+\" getRawAccountAttribute:\"+object+\" accountAttrMap:\"+accountAttrMap;\n\t\tif(accountAttrMap != null && accountAttrMap.size() > 0) {\n\t\t\tattrValue = accountAttrMap.get(attributeName);\n\t\t}if(object != null && (attrValue == null || (attrValue != null && attrValue.isEmpty()))) {\n\t\t\tif(object instanceof String) {\n\t\t\t\tattrValue = (String)object;\n\t\t\t}\n\t\t}\n\t}\n\tstrSOCRequestLog = strSOCRequestLog+ \" attributeName:\"+attributeName+ \" StringattributeValue:\"+attrValue;\n\treturn attrValue;\n}\n\npublic boolean isValidSOCSupendRequest(String applicationName, String personNumber, String suspended, boolean isSuspendedReq) {\n\tboolean retValue = false;\n\tObject dateObject = isSuspendedReq ? getAccountAttributeValue(applicationName, \"SuspendedDate\", personNumber) : getAccountAttributeValue(applicationName, \"EnabledDate\", personNumber);\n\tString status = getAccountAttributeValue(applicationName, \"Status\", personNumber);\t\n\tif((isSuspendedReq && \"Y\".equalsIgnoreCase(suspended) && \"inactive\".equalsIgnoreCase(status)) || (!isSuspendedReq && \"N\".equalsIgnoreCase(suspended) && \"active\".equalsIgnoreCase(status))) {\n\t\tretValue = true;\n\t}\n\tstrSOCRequestLog = strSOCRequestLog+ \"In isValidSOCSupendRequest applicationName:\"+applicationName+\" personNumber:\"+personNumber+\" suspended:\"+suspended+\":\"+suspended+\" requestedDate:\"+dateObject+\" status:\"+status+\" retValue:\"+retValue;\n\treturn retValue;\n}\n\nif (plan != null) {\n    ArrayList acctReqs = getADAccountRequests(plan);\n    if (null != acctReqs && !acctReqs.isEmpty()) {\n\t\tfor(AccountRequest acctReq : acctReqs){\n\t\t\tsailpoint.object.ProvisioningPlan.AccountRequest.Operation operation = acctReq.getOperation();\n\t\t\tnativeIdentity = acctReq.getNativeIdentity();\n\t\t\tif (null != operation) {\n\t\t\t\tidentity = plan.getIdentity();\n\t\t\t\tif(null != identity) {\n\t\t\t\t\tworkerType = (String) identity.getAttribute(\"workerType\");\n\t\t\t\t\tlifeCycleState = (String) identity.getAttribute(\"cloudLifecycleState\");\t\t\t\t\n\t\t\t\t\tadProvFlagBr = (String) identity.getAttribute(\"adProvFlagBr\");\t\t\t\t\t\n\t\t\t\t\tmanagementLevelFlag = (String) identity.getAttribute(\"managementLevelFlag\");\n\t\t\t\t\temployeeType = (String) identity.getAttribute(\"employeeType\");\t\t\t\t\n\t\t\t\t\tdivision = (String) identity.getAttribute(\"division\");\n\t\t\t\t\tpersonNumber = (String) identity.getAttribute(\"identificationNumber\");\n\t\t\t\t\tassignmentStatusType = (String) identity.getAttribute(\"assignmentStatusType\");\n\t\t\t\t\tactiveLocationCode = (String) identity.getAttribute(\"activeLocationCode\");\t\t\t\t\n\t\t\t\t\tadProvFlagSetupLike = (String) identity.getAttribute(\"adProvFlagSetupLike\");\n\t\t\t\t\tsetupLikePersonId =(String) identity.getAttribute(\"setupLikePersonId\");\n\t\t\t\t\tnetworkAccessRequired = (String) identity.getAttribute(\"networkAccessRequired\");\n\t\t\t\t\texchangeMailboxRequired = (String) identity.getAttribute(\"exchangeMailboxRequired\");\n\t\t\t\t\tadProvFlagCnowSetupLike = (String) identity.getAttribute(\"adProvFlagCnowSetupLike\");\n\t\t\t\t\t\n\t\t\t\t\tcnowSetupLikePersonIdWH = (String) identity.getAttribute(\"cnowSetupLikePersonIdWH\");\n\t\t\t\t\tcnowNetworkAccessRequiredWH = (String) identity.getAttribute(\"cnowNetworkAccessRequiredWH\");\n\t\t\t\t\tcnowExchangeMailboxRequiredWH = (String) identity.getAttribute(\"cnowExchangeMailboxRequiredWH\");\n\t\t\t\t\tcnowTaskNumberWH = (String) identity.getAttribute(\"cnowTaskNumberWH\");\n\t\t\t\t\tcnowTaskSysIdWH = (String) identity.getAttribute(\"cnowTaskSysIdWH\");\n\t\t\t\t\tcnowRequestedByWH = (String) identity.getAttribute(\"cnowRequestedByWH\");\n\t\t\t\t\tcnowRequestedByEmailWH = (String) identity.getAttribute(\"cnowRequestedByEmailWH\");\n\t\t\t\t\t\n\t\t\t\t\tdisplayName = (String) identity.getAttribute(\"displayName\");\n\t\t\t\t\tmanagerDisplayName = (String) identity.getAttribute(\"managerDisplayName\");\n\t\t\t\t\tmanagerEmail = (String) identity.getAttribute(\"managerEmail\");\t\t\t\t\n\t\t\t\t\tjobTitle = (String) identity.getAttribute(\"jobTitle\");\n\t\t\t\t\tdepartment = (String) identity.getAttribute(\"department\");\n\t\t\t\t\tlocationDescription = (String) identity.getAttribute(\"locationDescription\");\n\t\t\t\t\tassignmentStartDateStr = getAssignmentStartDateString(identity.getAttribute(\"assignmentStartDate\"));\n\t\t\t\t\tlocationCode = (String) identity.getAttribute(\"locationCode\");\n\t\t\t\t\tterminationDate = getTerminationDate(identity.getAttribute(\"terminationDate\"));\t\t\t\t\t\t\n\t\t\t\t\tmanagementLevel = (String) idn.getRawAccountAttribute(oicSourceName, personNumber, \"ManagementLevel\");\n\t\t\t\t\tcontractorRequestedByEmail = (String) identity.getAttribute(\"contractorRequestedByEmail\");\t\t\t\t\n\t\t\t\t\tacctReq.addArgument(\"excScriptIdentityDisplayName\", displayName);\n\t\t\t\t\tacctReq.addArgument(\"excScriptPersonNumber\", personNumber);\n\t\t\t\t\tacctReq.addArgument(\"excScriptManagerDisplayName\", managerDisplayName);\n\t\t\t\t\tacctReq.addArgument(\"excScriptManagerEmail\", managerEmail);\n\t\t\t\t\tif (operation.equals(ProvisioningPlan.AccountRequest.Operation.Create)) {\t\t\t\n\t\t\t\t\t\tif(\"Employee\".equalsIgnoreCase(workerType)) {\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif(null != adProvFlagBr && \"H\".equalsIgnoreCase(adProvFlagBr) && isSetupLike(acctReq.getAttributeRequests(\"memberOf\"), \"empBREnt\")) {\n\t\t\t\t\t\t\t\tif(null != managementLevelFlag && \"true\".equalsIgnoreCase(managementLevelFlag)) {\n\t\t\t\t\t\t\t\t\tString sAMAccountName = (String) acctReq.getAttributeRequest(\"sAMAccountName\").getValue();\n\t\t\t\t\t\t\t\t\tString upn = (String) acctReq.getAttributeRequest(\"userPrincipalName\").getValue();\n\t\t\t\t\t\t\t\t\tif(null != sAMAccountName) {\n\t\t\t\t\t\t\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"mailNickname\", ProvisioningPlan.Operation.Set, sAMAccountName));\n\t\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScript\", \"true\");\n\t\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptBR\", \"true\");\n\t\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptName\", \"exchangeProvision\");\n\t\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptSAMAccName\", sAMAccountName);\n\t\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptUPN\", upn);\n\t\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptEmpType\", employeeType);\n\t\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptWorkerType\", workerType);\n\t\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptDomain\", \"H\");\n\t\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptLicenseToAssign\", getLicenseToBeAssigned(division, employeeType, managementLevel));\n\t\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptSendPwdEmail\", \"true\");\n\t\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptJobTitle\", jobTitle);\n\t\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptDepartment\", department);\n\t\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptLocationDesc\", locationDescription);\n\t\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptAssignmentStartDate\", assignmentStartDateStr);\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"accountExpires\", ProvisioningPlan.Operation.Set, \"never\"));\n\t\t\t\t\t\t\t\tif(null != lifeCycleState && \"active\".equalsIgnoreCase(lifeCycleState)) {\n\t\t\t\t\t\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"userAccountControl\", ProvisioningPlan.Operation.Set, 512));\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"userAccountControl\", ProvisioningPlan.Operation.Set, 514));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tList brCreateEmp = getBirthrightGroups(assignmentStatusType, activeLocationCode, personNumber, managementLevelFlag, oicSourceName);\n\t\t\t\t\t\t\t\taddBirthrightIfAny(acctReq, brCreateEmp);\n\t\t\t\t\t\t\t} else if(null != adProvFlagSetupLike && \"H\".equalsIgnoreCase(adProvFlagSetupLike) && isSetupLike(acctReq.getAttributeRequests(\"memberOf\"), \"empSetupLikeISCEnt\")) {\n\t\t\t\t\t\t\t\tif(null != lifeCycleState && \"active\".equalsIgnoreCase(lifeCycleState)) {\n\t\t\t\t\t\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"userAccountControl\", ProvisioningPlan.Operation.Set, 512));\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"userAccountControl\", ProvisioningPlan.Operation.Set, 514));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"accountExpires\", ProvisioningPlan.Operation.Set, \"never\"));\n\t\t\t\t\t\t\t\tif(null != setupLikePersonId) {\n\t\t\t\t\t\t\t\t\tList setupLikeADGroupsFiltered = getFilteredADGroups(setupLikePersonId);\n\t\t\t\t\t\t\t\t\tif(null != setupLikeADGroupsFiltered && !setupLikeADGroupsFiltered.isEmpty()) {\n\t\t\t\t\t\t\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"memberOf\", ProvisioningPlan.Operation.Add, setupLikeADGroupsFiltered));\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tString sAMAccountName = (String) acctReq.getAttributeRequest(\"sAMAccountName\").getValue();\n\t\t\t\t\t\t\t\tString upn = (String) acctReq.getAttributeRequest(\"userPrincipalName\").getValue();\n\t\t\t\t\t\t\t\tif(null != sAMAccountName) {\n\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptSendPwdEmail\", \"true\");\n\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptSAMAccName\", sAMAccountName);\n\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptUPN\", upn);\n\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptEmpType\", employeeType);\n\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptWorkerType\", workerType);\n\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptJobTitle\", jobTitle);\n\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptDepartment\", department);\n\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptLocationDesc\", locationDescription);\n\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptAssignmentStartDate\", assignmentStartDateStr);\n\t\t\t\t\t\t\t\t}\t\t\t\t\t\n\t\t\t\t\t\t\n\t\t\t\t\t\t\t} else if(null != adProvFlagCnowSetupLike && \"WH\".equalsIgnoreCase(adProvFlagCnowSetupLike) && isSetupLike(acctReq.getAttributeRequests(\"memberOf\"), \"empSetupLikeCNOWEnt\")) {\n\t\t\t\t\t\t\t\tif(null != lifeCycleState && \"active\".equalsIgnoreCase(lifeCycleState)) {\n\t\t\t\t\t\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"userAccountControl\", ProvisioningPlan.Operation.Set, 512));\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"userAccountControl\", ProvisioningPlan.Operation.Set, 514));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"accountExpires\", ProvisioningPlan.Operation.Set, \"never\"));\n\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tif(null != cnowNetworkAccessRequiredWH && \"true\".equalsIgnoreCase(cnowNetworkAccessRequiredWH)) {\t\t\n\t\t\t\t\t\t\t\t\tList brCreateCnow = getBirthrightGroups(assignmentStatusType, activeLocationCode, personNumber, managementLevelFlag, oicSourceName);\n\t\t\t\t\t\t\t\t\tif(null != cnowSetupLikePersonIdWH) {\n\t\t\t\t\t\t\t\t\t\tList setupLikeADGroupsFiltered = getFilteredADGroups(cnowSetupLikePersonIdWH);\n\t\t\t\t\t\t\t\t\t\tif(null != setupLikeADGroupsFiltered && !setupLikeADGroupsFiltered.isEmpty()) {\n\t\t\t\t\t\t\t\t\t\t\tbrCreateCnow.addAll(setupLikeADGroupsFiltered);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\taddBirthrightIfAny(acctReq, brCreateCnow);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif((null != cnowNetworkAccessRequiredWH && \"true\".equalsIgnoreCase(cnowNetworkAccessRequiredWH)) || (null != cnowExchangeMailboxRequiredWH && \"true\".equalsIgnoreCase(cnowExchangeMailboxRequiredWH))) {\n\t\t\t\t\t\t\t\t\tString sAMAccountName = (String) acctReq.getAttributeRequest(\"sAMAccountName\").getValue();\n\t\t\t\t\t\t\t\t\tString upn = (String) acctReq.getAttributeRequest(\"userPrincipalName\").getValue();\n\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptSetupLike\", \"true\");\n\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptSetupLikeSource\", \"CNOW\");\n\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptCnowTaskNumber\", cnowTaskNumberWH);\n\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptCnowTaskSysId\", cnowTaskSysIdWH);\n\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptSAMAccName\", sAMAccountName);\n\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptUPN\", upn);\n\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptEmpType\", employeeType);\n\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptWorkerType\", workerType);\n\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptCnowNetworkAccessRequired\", cnowNetworkAccessRequiredWH);\n\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptJobTitle\", jobTitle);\n\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptDepartment\", department);\n\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptLocationDesc\", locationDescription);\n\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptAssignmentStartDate\", assignmentStartDateStr);\n\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptCnowExchangeMailboxRequired\", cnowExchangeMailboxRequiredWH);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tif(null != cnowNetworkAccessRequiredWH && \"true\".equalsIgnoreCase(cnowNetworkAccessRequiredWH)) {\n\t\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptSendPwdEmail\", \"true\");\n\t\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptCnowRequestedBy\", cnowRequestedByWH);\n\t\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptCnowRequestedByEmail\", cnowRequestedByEmailWH);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t}\t\t\t\t\t\n\t\t\t\t\t\t} else if(\"Contractor\".equalsIgnoreCase(workerType)) {\n\t\t\t\t\t\t\tif(null != adProvFlagSetupLike && \"H\".equalsIgnoreCase(adProvFlagSetupLike) && isSetupLike(acctReq.getAttributeRequests(\"memberOf\"), \"conSetupLikeISCEnt\")) {\n\t\t\t\t\t\t\t\tif(employeeType != null && \"Vendor\".equalsIgnoreCase(employeeType)) {\n\t\t\t\t\t\t\t\t\tLocalDate d = LocalDate.now().plusDays(3);\n\t\t\t\t\t\t\t\t\tString adTimeStamp = adFileTimeAtMidnightPDT(d);\n\t\t\t\t\t\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"accountExpires\", ProvisioningPlan.Operation.Set, adTimeStamp));\n\t\t\t\t\t\t\t\t} else if (terminationDate != null) {\n\t\t\t\t\t\t\t\t\tCalendar cal = Calendar.getInstance();\n\t\t\t\t\t\t\t\t\tcal.add(Calendar.YEAR, 1);\n\t\t\t\t\t\t\t\t\tcal.set(Calendar.HOUR_OF_DAY, 0);\n\t\t\t\t\t\t\t\t\tcal.set(Calendar.MINUTE, 0);\n\t\t\t\t\t\t\t\t\tcal.set(Calendar.SECOND, 0);\n\t\t\t\t\t\t\t\t\tcal.set(Calendar.MILLISECOND, 0);\n\t\t\t\t\t\t\t\t\tDate nextYearDate = cal.getTime();\n\t\t\t\t\t\t\t\t\tDate pick = minDate(terminationDate, nextYearDate);\n\t\t\t\t\t\t\t\t\tString adTimeStamp = adFileTimePlusOneDay(pick);\n\t\t\t\t\t\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"accountExpires\", ProvisioningPlan.Operation.Set, adTimeStamp));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"userAccountControl\", ProvisioningPlan.Operation.Set, 512));\n\t\t\t\t\t\t\t\tif(null != setupLikePersonId && null != networkAccessRequired && \"true\".equalsIgnoreCase(networkAccessRequired)) {\n\t\t\t\t\t\t\t\t\tList setupLikeADGroupsFiltered = getFilteredADGroups(setupLikePersonId);\n\t\t\t\t\t\t\t\t\tif(null != setupLikeADGroupsFiltered && !setupLikeADGroupsFiltered.isEmpty()) {\n\t\t\t\t\t\t\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"memberOf\", ProvisioningPlan.Operation.Add, setupLikeADGroupsFiltered));\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif((null != exchangeMailboxRequired && \"true\".equalsIgnoreCase(exchangeMailboxRequired)) ||  (null != networkAccessRequired && \"true\".equalsIgnoreCase(networkAccessRequired))) {\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptSetupLike\", \"true\");\n\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptSetupLikeSource\", \"ISC\");\n\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptWorkerType\", workerType);\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptSAMAccName\", (String) acctReq.getAttributeRequest(\"sAMAccountName\").getValue());\n\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptUPN\", (String) acctReq.getAttributeRequest(\"userPrincipalName\").getValue());\n\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptEmpType\", employeeType);\n\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptNetworkAccessRequired\", networkAccessRequired);\n\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptExchangeMailboxRequired\", exchangeMailboxRequired);\n\t\t\t\t\t\t\t\t\tif(null != networkAccessRequired && \"true\".equalsIgnoreCase(networkAccessRequired)) {\n\t\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptSendPwdEmail\", \"true\");\n\t\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptContractorRequestedByEmail\", contractorRequestedByEmail);\n\t\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptContractorOnboarding\", \"true\");\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif(null != exchangeMailboxRequired && \"true\".equalsIgnoreCase(exchangeMailboxRequired)) {\n\t\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScript\", \"true\");\n\t\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptName\", \"exchangeProvision\");\n\t\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptDomain\", \"H\");\n\t\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptLicenseToAssign\", getLicenseToBeAssigned(null, employeeType, null));\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\t\t\t\t\n\t\t\t\t\telse if (operation.equals(ProvisioningPlan.AccountRequest.Operation.Modify)) {\n\t\t\t\t\t\tif (isSetupLike(acctReq.getAttributeRequests(\"memberOf\"), \"SOCPasswordReset\")) {\n\t\t\t\t\t\t\tlog.debug(\"SOCPasswordReset found\");\n\t\t\t\t\t\t\tList groupReqs = acctReq.getAttributeRequests(\"memberOf\");\n\t\t\t\t\t\t\tif (groupReqs != null) {\n\t\t\t\t\t\t\t\tfor (ProvisioningPlan.AttributeRequest r : new ArrayList(groupReqs)) {\n\t\t\t\t\t\t\t\t\tacctReq.remove(r); // safe removal\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tString newPassword = generatePassword();\n\t\t\t\t\t\t\tif (newPassword != null) {\n\t\t\t\t\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"password\", ProvisioningPlan.Operation.Set, newPassword));\n\t\t\t\t\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"pwdLastSet\", ProvisioningPlan.Operation.Set, true));\n\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptSOCSendPwdEmail\", \"true\");\n\t\t\t\t\t\t\t\tString sAMAccountName = (String) idn.getRawAccountAttribute(applicationName, nativeIdentity, \"sAMAccountName\");\n\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptSAMAccName\",sAMAccountName);\n\t\t\t\t\t\t\t\tString upn = (String) idn.getRawAccountAttribute(applicationName, nativeIdentity, \"userPrincipalName\");\t\t\n\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptUPN\",upn);\n\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptJobTitle\",jobTitle);\n\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptLocationDesc\",locationDescription);\n\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptAssignmentStartDate\",assignmentStartDateStr);\n\t\t\t\t\t\t\t\tacctReq.addArgument(\"pwd\",newPassword);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tString oldDesc = (String) idn.getRawAccountAttribute(applicationName, nativeIdentity, \"description\");\n\t\t\t\t\t\tif(null == oldDesc)\n\t\t\t\t\t\t\toldDesc = \"\";\n\t\t\t\t\t\tif((\"Employee\".equalsIgnoreCase(workerType) || \"Contractor\".equalsIgnoreCase(workerType)) && null != lifeCycleState && (\"inactive\".equalsIgnoreCase(lifeCycleState) || \"inactiveImmediateTerm\".equalsIgnoreCase(lifeCycleState)|| \"lsalclbbdc\".equalsIgnoreCase(lifeCycleState))) {\n\t\t\t\t\t\t\tif(null != acctReq.getAttributeRequest(\"manager\")) {\n\t\t\t\t\t\t\t\tacctReq.getAttributeRequest(\"manager\").setValue(\"\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(\"Employee\".equalsIgnoreCase(workerType) && ( (nativeIdentity.toUpperCase().indexOf(\"OU=LEGAL HOLD\") != -1) || (nativeIdentity.toUpperCase().indexOf(\"OU=DISABLED\") != -1) || (oldDesc.toUpperCase().indexOf(\"TERM(\") != -1) || (oldDesc.toUpperCase().indexOf(\"TERM (\") != -1) ||  (oldDesc.toUpperCase().indexOf(\"TERM \") != -1))) {\n\t\t\t\t\t\t\tList adAttSyncAttributes = (List) application.getAttributeValue(\"adAttSyncAttributes\");\n\t\t\t\t\t\t\tList attrReqNamesToRemove = new ArrayList();\n\t\t\t\t\t\t\tfor(AttributeRequest attrReq : acctReq.getAttributeRequests()) {\n\t\t\t\t\t\t\t\tif(null != attrReq && null != adAttSyncAttributes && adAttSyncAttributes.contains(attrReq.getName())) {\n\t\t\t\t\t\t\t\t\tattrReqNamesToRemove.add(attrReq.getName());\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif(null != attrReqNamesToRemove && !attrReqNamesToRemove.isEmpty()) {\n\t\t\t\t\t\t\t\tfor(String attrReqName : attrReqNamesToRemove) {\n\t\t\t\t\t\t\t\t\tacctReq.remove(acctReq.getAttributeRequest(attrReqName));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(\"Employee\".equalsIgnoreCase(workerType) && null != lifeCycleState && (\"prehire\".equalsIgnoreCase(lifeCycleState) || \"active\".equalsIgnoreCase(lifeCycleState) || \"leaveOfAbsence\".equalsIgnoreCase(lifeCycleState)) && null != nativeIdentity && nativeIdentity.toUpperCase().indexOf(\"OU=LEGAL HOLD\") == -1) {\n\t\t\t\t\t\t\tint legalHoldIndex = oldDesc.toUpperCase().indexOf(\"LEGAL HOLD\");\n\t\t\t\t\t\t\tif(null != acctReq.getAttributeRequest(\"msExchExtensionAttribute39\") && nativeIdentity.toUpperCase().indexOf(\"OU=DISABLED\") == -1) {\n\t\t\t\t\t\t\t\tString newTitle = (String) acctReq.getAttributeRequest(\"msExchExtensionAttribute39\").getValue();\n\t\t\t\t\t\t\t\tString oldTitile = (String) idn.getRawAccountAttribute(applicationName, nativeIdentity, \"msExchExtensionAttribute39\");\n\t\t\t\t\t\t\t\tif(null == oldTitile)\n\t\t\t\t\t\t\t\t\toldTitile = \"\";\n\t\t\t\t\t\t\t\tString empLastFourDigit=\"\";\n\t\t\t\t\t\t\t\tif(personNumber!=null){\n\t\t\t\t\t\t\t\t\tfor(int i = personNumber.length()-4; i < personNumber.length();i++)\n\t\t\t\t\t\t\t\t\t\tempLastFourDigit=empLastFourDigit+personNumber.charAt(i); \n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tString newDesc = oldDesc.replace((oldTitile + \" *\" + empLastFourDigit), (newTitle + \" *\" + empLastFourDigit));\n\t\t\t\t\t\t\t\tnewDesc = newDesc.replaceAll(\"  \", \" \");\n\t\t\t\t\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"description\", ProvisioningPlan.Operation.Set, newDesc.trim()));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif(null != acctReq.getAttributeRequest(\"department\") && nativeIdentity.toUpperCase().indexOf(\"OU=DISABLED\") == -1) {\n\t\t\t\t\t\t\t\tString oldDepartment = (String) idn.getRawAccountAttribute(applicationName, nativeIdentity, \"department\");\n\t\t\t\t\t\t\t\tif(null == oldDepartment)\n\t\t\t\t\t\t\t\t\toldDepartment = \"\";\n\t\t\t\t\t\t\t\tObject memberOfValueObj = idn.getRawAccountAttribute(applicationName, nativeIdentity, \"memberOf\");\t\t\t\t\t\n\t\t\t\t\t\t\t\tif(null != locationCode && !oldDepartment.startsWith(locationCode)) {\n\t\t\t\t\t\t\t\t\tString newOU = getOUBasedOnLocation(locationCode);\n\t\t\t\t\t\t\t\t\tif(null != newOU && !nativeIdentity.contains(newOU)) {\n\t\t\t\t\t\t\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"AC_NewParent\", ProvisioningPlan.Operation.Set, newOU));\t\t\t\n\t\t\t\t\t\t\t\t\t\tif(null != assignmentStatusType && !assignmentStatusType.equalsIgnoreCase(\"INACTIVE\")){\n\t\t\t\t\t\t\t\t\t\t\tList proxyADGroups = getRBACProxyADGroups(activeLocationCode, personNumber, managementLevelFlag);\n\t\t\t\t\t\t\t\t\t\t\tList oldProxyADGroups = getOldRBACProxyADGroups(memberOfValueObj);\n\t\t\t\t\t\t\t\t\t\t\tList oldProxyADGroupsToRemove = new ArrayList();\n\t\t\t\t\t\t\t\t\t\t\tif(null != oldProxyADGroups && oldProxyADGroups.size() > 0) {\n\t\t\t\t\t\t\t\t\t\t\t\tfor(String oldProxyADGroup : oldProxyADGroups) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tif(null != proxyADGroups && !proxyADGroups.isEmpty() && !proxyADGroups.contains(oldProxyADGroup)) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\toldProxyADGroupsToRemove.add(oldProxyADGroup);\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tif(null != proxyADGroups && !proxyADGroups.isEmpty()) {\n\t\t\t\t\t\t\t\t\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"memberOf\", ProvisioningPlan.Operation.Add, proxyADGroups));\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tif(null != oldProxyADGroupsToRemove && !oldProxyADGroupsToRemove.isEmpty()) {\n\t\t\t\t\t\t\t\t\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"memberOf\", ProvisioningPlan.Operation.Remove, oldProxyADGroupsToRemove));\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif(null != assignmentStatusType && !assignmentStatusType.equalsIgnoreCase(\"INACTIVE\")){\n\t\t\t\t\t\t\t\t\t\tList oktaGenesysADGroups = getRBACOktaGeneysGroups(activeLocationCode);\n\t\t\t\t\t\t\t\t\t\tif(null != oktaGenesysADGroups && !oktaGenesysADGroups.isEmpty()) {\n\t\t\t\t\t\t\t\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"memberOf\", ProvisioningPlan.Operation.Add, oktaGenesysADGroups));\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\tList oldOktaGenesysADGroups = getOldRBACOktaGeneysGroups(memberOfValueObj);\n\t\t\t\t\t\t\t\t\t\t\tif(null != oldOktaGenesysADGroups && !oldOktaGenesysADGroups.isEmpty()) {\n\t\t\t\t\t\t\t\t\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"memberOf\", ProvisioningPlan.Operation.Remove, oldOktaGenesysADGroups));\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif((null != acctReq.getAttributeRequest(\"givenName\") || null != acctReq.getAttributeRequest(\"sn\")) && nativeIdentity.toUpperCase().indexOf(\"OU=DISABLED\") == -1) {\n\t\t\t\t\t\t\t\tString fname = identity.getFirstname();\n\t\t\t\t\t\t\t\tString lname = identity.getLastname();\n\t\t\t\t\t\t\t\tif(null != fname && null != lname) {\n\t\t\t\t\t\t\t\t\tString newCn = getCN(fname, lname);\n\t\t\t\t\t\t\t\t\tif(null != newCn && newCn.trim().length() > 0) {\n\t\t\t\t\t\t\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"cn\", ProvisioningPlan.Operation.Set, newCn.trim()));\n\t\t\t\t\t\t\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"AC_NewName\", ProvisioningPlan.Operation.Set, newCn.trim()));\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif((\"prehire\".equalsIgnoreCase(lifeCycleState) || \"active\".equalsIgnoreCase(lifeCycleState)) && null != adProvFlagBr && \"H\".equalsIgnoreCase(adProvFlagBr) && isSetupLike(acctReq.getAttributeRequests(\"memberOf\"), \"empBREnt\")) {\n\t\t\t\t\t\t\t\tAccountRequest acctReqTemp = modifyPlan(personNumber, nativeIdentity, \"rehireModify\", legalHoldIndex);\n\t\t\t\t\t\t\t\tif(null != acctReqTemp && null != acctReqTemp.getAttributeRequests() && !acctReqTemp.getAttributeRequests().isEmpty()) {\n\t\t\t\t\t\t\t\t\tList attReqs = acctReqTemp.getAttributeRequests();\n\t\t\t\t\t\t\t\t\tacctReq.addAll(attReqs);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif(null != managementLevelFlag && \"true\".equalsIgnoreCase(managementLevelFlag)) {\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tString sAMAccountName = (String) idn.getRawAccountAttribute(applicationName, nativeIdentity, \"sAMAccountName\");\n\t\t\t\t\t\t\t\t\tString upn = (String) idn.getRawAccountAttribute(applicationName, nativeIdentity, \"userPrincipalName\");\t\t\t\t\n\t\t\t\t\t\t\t\t\tif(null != sAMAccountName) {\n\t\t\t\t\t\t\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"mailNickname\", ProvisioningPlan.Operation.Set, sAMAccountName));\n\t\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScript\", \"true\");\n\t\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptBR\", \"true\");\n\t\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptName\", \"exchangeProvision\");\n\t\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptSAMAccName\", sAMAccountName);\n\t\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptUPN\", upn);\n\t\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptEmpType\", employeeType);\n\t\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptWorkerType\", workerType);\n\t\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptDomain\", \"H\");\n\t\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptLicenseToAssign\", getLicenseToBeAssigned(division, employeeType, managementLevel));\n\t\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptSendPwdEmail\", \"true\");\n\t\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptJobTitle\", jobTitle);\n\t\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptDepartment\", department);\n\t\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptLocationDesc\", locationDescription);\n\t\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptAssignmentStartDate\", assignmentStartDateStr);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif(null != adProvFlagSetupLike && \"H\".equalsIgnoreCase(adProvFlagSetupLike) && isSetupLike(acctReq.getAttributeRequests(\"memberOf\"), \"empSetupLikeISCEnt\")) {\n\t\t\t\t\t\t\t\tif(null != lifeCycleState && \"active\".equalsIgnoreCase(lifeCycleState)) {\n\t\t\t\t\t\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"userAccountControl\", ProvisioningPlan.Operation.Set, 512));\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"userAccountControl\", ProvisioningPlan.Operation.Set, 514));\n\t\t\t\t\t\t\t\t} \n\t\t\t\t\t\t\t\tif(null != setupLikePersonId) {\n\t\t\t\t\t\t\t\t\tList setupLikeADGroupsFiltered = getFilteredADGroups(setupLikePersonId);\n\t\t\t\t\t\t\t\t\tif(null != setupLikeADGroupsFiltered && !setupLikeADGroupsFiltered.isEmpty()) {\n\t\t\t\t\t\t\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"memberOf\", ProvisioningPlan.Operation.Add, setupLikeADGroupsFiltered));\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t} else if(null != adProvFlagCnowSetupLike && \"WH\".equalsIgnoreCase(adProvFlagCnowSetupLike) && isSetupLike(acctReq.getAttributeRequests(\"memberOf\"), \"empSetupLikeCNOWEnt\")) {\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tif(null != cnowNetworkAccessRequiredWH && \"true\".equalsIgnoreCase(cnowNetworkAccessRequiredWH)) {\n\t\t\t\t\t\t\t\t\tAccountRequest acctReqTemp = modifyPlan(personNumber, nativeIdentity, \"cnowModify\", legalHoldIndex);\n\t\t\t\t\t\t\t\t\tif(null != acctReqTemp && null != acctReqTemp.getAttributeRequests() && !acctReqTemp.getAttributeRequests().isEmpty()) {\n\t\t\t\t\t\t\t\t\t\tList attReqs = acctReqTemp.getAttributeRequests();\n\t\t\t\t\t\t\t\t\t\tacctReq.addAll(attReqs);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif(null != cnowSetupLikePersonIdWH) {\n\t\t\t\t\t\t\t\t\t\tList setupLikeADGroupsFiltered = getFilteredADGroups(cnowSetupLikePersonIdWH);\n\t\t\t\t\t\t\t\t\t\tif(null != setupLikeADGroupsFiltered && !setupLikeADGroupsFiltered.isEmpty()) {\n\t\t\t\t\t\t\t\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"memberOf\", ProvisioningPlan.Operation.Add, setupLikeADGroupsFiltered));\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif((null != cnowNetworkAccessRequiredWH && \"true\".equalsIgnoreCase(cnowNetworkAccessRequiredWH)) || (null != cnowExchangeMailboxRequiredWH && \"true\".equalsIgnoreCase(cnowExchangeMailboxRequiredWH))) {\n\t\t\t\t\t\t\t\t\tString sAMAccountName = (String) idn.getRawAccountAttribute(applicationName, nativeIdentity, \"sAMAccountName\");\n\t\t\t\t\t\t\t\t\tString upn = (String) idn.getRawAccountAttribute(applicationName, nativeIdentity, \"userPrincipalName\");\n\t\t\t\t\t\t\t\t\tcnowTaskNumberWH = (String) identity.getAttribute(\"cnowTaskNumberWH\");\n\t\t\t\t\t\t\t\t\tcnowTaskSysIdWH = (String) identity.getAttribute(\"cnowTaskSysIdWH\");\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptSetupLike\", \"true\");\n\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptSetupLikeSource\", \"CNOW\");\n\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptCnowTaskNumber\", cnowTaskNumberWH);\n\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptCnowTaskSysId\", cnowTaskSysIdWH);\n\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptSAMAccName\", sAMAccountName);\n\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptUPN\", upn);\n\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptEmpType\", employeeType);\n\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptWorkerType\", workerType);\n\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptCnowNetworkAccessRequired\", cnowNetworkAccessRequiredWH);\n\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptJobTitle\", jobTitle);\n\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptDepartment\", department);\n\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptLocationDesc\", locationDescription);\n\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptAssignmentStartDate\", assignmentStartDateStr);\n\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptCnowExchangeMailboxRequired\", cnowExchangeMailboxRequiredWH);\n\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptCnowRequestedBy\", cnowRequestedByWH);\n\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptCnowRequestedByEmail\", cnowRequestedByEmailWH);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t}\t\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(\"Employee\".equalsIgnoreCase(workerType) && \"P\".equalsIgnoreCase(employeeType) && null != lifeCycleState && \"inactive\".equalsIgnoreCase(lifeCycleState)) {\n\t\t\t\t\t\t\tif(null != acctReq.getAttributeRequests(\"memberOf\")) {\n\t\t\t\t\t\t\t\tString termWorkerTypePEnt = idn.getSourceAttributeBySourceName(application.getName(), \"termWorkerTypePEnt\");\n\t\t\t\t\t\t\t\tboolean flag = false;\n\t\t\t\t\t\t\t\tAttributeRequest termWorkerTypePEntAttrRequest = null;\n\t\t\t\t\t\t\t\tfor(AttributeRequest attributeRequest : acctReq.getAttributeRequests(\"memberOf\")){\n\t\t\t\t\t\t\t\t\tObject memberOfValueObj = attributeRequest.getValue();\n\t\t\t\t\t\t\t\t\tif(memberOfValueObj != null && memberOfValueObj instanceof String && String.valueOf(memberOfValueObj).equalsIgnoreCase(termWorkerTypePEnt)){\n\t\t\t\t\t\t\t\t\t\ttermWorkerTypePEntAttrRequest = attributeRequest;\n\t\t\t\t\t\t\t\t\t\tflag = true;\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t   } else if(memberOfValueObj != null && memberOfValueObj instanceof List && ((List)memberOfValueObj).contains(termWorkerTypePEnt)){\n\t\t\t\t\t\t\t\t\t\ttermWorkerTypePEntAttrRequest = attributeRequest;\n\t\t\t\t\t\t\t\t\t\tflag = true;\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t  }\n\t\t\t\t\t\t\t\t\t if(flag){\n\t\t\t\t\t\t\t\t   acctReq.remove(termWorkerTypePEntAttrRequest);\n\t\t\t\t\t\t\t\t   acctReq = leaverPlan(acctReq, personNumber, nativeIdentity, \"leaverWorkerTypeP\");\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(\"Employee\".equalsIgnoreCase(workerType) && \"E\".equalsIgnoreCase(employeeType) && null != lifeCycleState && ( \"inactive\".equalsIgnoreCase(lifeCycleState) || \"lsalclbbdc\".equalsIgnoreCase(lifeCycleState) || \"inactiveImmediateTerm\".equalsIgnoreCase(lifeCycleState))) {\n\t\t\t\t\t\t\tif(null != acctReq.getAttributeRequests(\"memberOf\")) {\n\t\t\t\t\t\t\t\tString termWorkerTypeLOAEnt = idn.getSourceAttributeBySourceName(application.getName(), \"terminateEmployeeLOA\");\n\t\t\t\t\t\t\t\tboolean flag = false;\n\t\t\t\t\t\t\t\tAttributeRequest termEmployeeLOAEntAttrRequest = null;\n\t\t\t\t\t\t\t\t\tfor(AttributeRequest attributeRequest : acctReq.getAttributeRequests(\"memberOf\")){\n\t\t\t\t\t\t\t\t\t\tObject memberOfValueObj = attributeRequest.getValue();\n\t\t\t\t\t\t\t\t\t\tif(memberOfValueObj != null && memberOfValueObj instanceof String && String.valueOf(memberOfValueObj).equalsIgnoreCase(termWorkerTypeLOAEnt)){\n\t\t\t\t\t\t\t\t\t\ttermEmployeeLOAEntAttrRequest = attributeRequest;\n\t\t\t\t\t\t\t\t\t\tflag = true;\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t   } else if(memberOfValueObj != null && memberOfValueObj instanceof List && ((List)memberOfValueObj).contains(termWorkerTypeLOAEnt)){\n\t\t\t\t\t\t\t\t\t\t\ttermEmployeeLOAEntAttrRequest = attributeRequest;\n\t\t\t\t\t\t\t\t\t\t\tflag = true;\n\t\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t  }\n\t\t\t\t\t\t\t\t\tif(flag){\n\t\t\t\t\t\t\t\t   acctReq.remove(termEmployeeLOAEntAttrRequest);\n\t\t\t\t\t\t\t\t   acctReq = leaverPlan(acctReq, personNumber, nativeIdentity, \"leaverWorkerTypeLOA\");\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (acctReq.getOperation() == ProvisioningPlan.AccountRequest.Operation.Modify && acctReq.getAttributeRequests(\"memberOf\") != null) {\n\t\t\t\t\t\t\tfor (AttributeRequest attReq : acctReq.getAttributeRequests(\"memberOf\")) {\n\t\t\t\t\t\t\t\tif (attReq != null && attReq.getOperation() == ProvisioningPlan.Operation.Add) {\n\t\t\t\t\t\t\t\t\tObject val = attReq.getValue();\n\t\t\t\t\t\t\t\t\tList groups = new ArrayList();\n\t\t\t\t\t\t\t\t\tif (val instanceof String) {\n\t\t\t\t\t\t\t\t\t\tgroups.add((String) val);\n\t\t\t\t\t\t\t\t\t} else if (val instanceof List) {\n\t\t\t\t\t\t\t\t\t\tgroups.addAll((List) val);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tfor (String g : groups) {\n\t\t\t\t\t\t\t\t\t\tString EmpConvert = idn.getSourceAttributeBySourceName(application.getName(), \"CEConvert\");\n\t\t\t\t\t\t\t\t\t\tif (g != null && g.equalsIgnoreCase(EmpConvert)) {\n\t\t\t\t\t\t\t\t\t\t\tString locationCode   = (String) identity.getAttribute(\"cnowEmpLocation\");\n\t\t\t\t\t\t\t\t\t\t\tString jobTitle       = (String) identity.getAttribute(\"cnowEmpTitle\");\n\t\t\t\t\t\t\t\t\t\t\tString workerType     = (String) identity.getAttribute(\"cnowEmpType\");\n\t\t\t\t\t\t\t\t\t\t\tString personNumber   = (String) identity.getAttribute(\"cnowConversionEmpId\");\n\t\t\t\t\t\t\t\t\t\t\tString EmpJAId        = (String) identity.getAttribute(\"cnowEmpJaId\");\n\t\t\t\t\t\t\t\t\t\t\tString targetOU = getOUBasedOnLocation(locationCode);\n\t\t\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"cNowScriptAdConversion\", \"CEConvert\");\n\t\t\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"cNowScriptEmpJAId\", EmpJAId);\n\t\t\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"cNowScriptPersonNumber\", personNumber);\n\t\t\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"cNowScriptWorkerType\", workerType);\n\t\t\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"cNowScriptJobTitle\", jobTitle);\n\t\t\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"cNowScriptTargetOU\", targetOU);\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\tString contractorNativeIdentity = acctReq.getNativeIdentity();\n\t\t\t\t\t\t\t\t\t\t\tAccountRequest contractorAcctReq = new AccountRequest();\n\t\t\t\t\t\t\t\t\t\t\tcontractorAcctReq.setOperation(ProvisioningPlan.AccountRequest.Operation.Modify);\n\t\t\t\t\t\t\t\t\t\t\tcontractorAcctReq.setNativeIdentity(contractorNativeIdentity);\t\n\t\t\t\t\t\t\t\t\t\t\tcontractorAcctReq.setApplication(applicationName);\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\tcontractorAcctReq.add(new ProvisioningPlan.AttributeRequest(\"employeeNumber\", ProvisioningPlan.Operation.Set, personNumber));\n\t\t\t\t\t\t\t\t\t\t\tcontractorAcctReq.add(new ProvisioningPlan.AttributeRequest(\"employeeID\", ProvisioningPlan.Operation.Set, personNumber));\n\t\t\t\t\t\t\t\t\t\t\tcontractorAcctReq.add(new ProvisioningPlan.AttributeRequest(\"employeeType\", ProvisioningPlan.Operation.Set, workerType));\n\t\t\t\t\t\t\t\t\t\t\tcontractorAcctReq.add(new ProvisioningPlan.AttributeRequest(\"title\", ProvisioningPlan.Operation.Set, jobTitle));\n\t\t\t\t\t\t\t\t\t\t\tif (targetOU != null) {\n\t\t\t\t\t\t\t\t\t\t\t\tcontractorAcctReq.add(new ProvisioningPlan.AttributeRequest(\"AC_NewParent\", ProvisioningPlan.Operation.Set, targetOU));\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tplan.add(contractorAcctReq);\n\t\t\t\t\t\t\t\t\t\t\tList brCreateEmp = getBirthrightGroups(assignmentStatusType, activeLocationCode, personNumber, managementLevelFlag, oicSourceName);\n\t\t\t\t\t\t\t\t\t\t\taddBirthrightIfAny(acctReq, brCreateEmp);\n\t\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\t\t\t\t\n\t\t\t\t\t}\t\t\t\t\t\t\t\n\t\t\t\t\telse if (operation.equals(ProvisioningPlan.AccountRequest.Operation.Disable)) {\n\t\t\t\t\t\tString suspended = getAccountAttributeValue(\"CZR-Application-Suspend\", \"Suspended\", personNumber);\n\t\t\t\t\t\tboolean isValidSOCSupendRequest = isValidSOCSupendRequest(\"CZR-Application-Suspend\", personNumber, suspended, true);\n\t\t\t\t\t\tstrSOCRequestLog = strSOCRequestLog+ \"WilliamHill In Disable:\"+suspended+\":\"+isValidSOCSupendRequest;\n\t\t\t\t\t\tacctReq.addArgument(\"excScriptSuspenedReqLog\", strSOCRequestLog);\n\t\t\t\t\t\tif(\"Y\".equalsIgnoreCase(suspended) && isValidSOCSupendRequest) {\n\t\t\t\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"description\", ProvisioningPlan.Operation.Set, \"DO NOT ENABLE PER IAM\"));\n\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptSuspendedState\", \"suspend\");\n\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptSuspendedReason\", getAccountAttributeValue(\"CZR-Application-Suspend\", \"ReasonForSuspension\", personNumber));\n\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptSAMAccName\", (String)idn.getRawAccountAttribute(applicationName, nativeIdentity, \"sAMAccountName\"));\n\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptUPN\", (String)idn.getRawAccountAttribute(applicationName, nativeIdentity, \"userPrincipalName\"));\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(\"Employee\".equalsIgnoreCase(workerType)) {\n\t\t\t\t\t\t\tif(null != lifeCycleState && \"leaveOfAbsence\".equalsIgnoreCase(lifeCycleState) && null != nativeIdentity) {\n\t\t\t\t\t\t\t\tif(nativeIdentity.toUpperCase().indexOf(\"OU=DISABLED\")==-1 && nativeIdentity.toUpperCase().indexOf(\"OU=LEGAL HOLD\")==-1) {\n\t\t\t\t\t\t\t\t\tString oldDesc = (String) idn.getRawAccountAttribute(applicationName, nativeIdentity, \"description\");\n\t\t\t\t\t\t\t\t\tif(null == oldDesc)\n\t\t\t\t\t\t\t\t\t\toldDesc = \"\";\n\t\t\t\t\t\t\t\t\tDate date = new Date();\n\t\t\t\t\t\t\t\t\tSimpleDateFormat formatter = new SimpleDateFormat(\"MM/dd/yyyy\");\n\t\t\t\t\t\t\t\t\tString todayDate = formatter.format(date);\n\t\t\t\t\t\t\t\t\tString loaDescription = \"LOA(\" + todayDate + \") \" + oldDesc;\n\t\t\t\t\t\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"description\", ProvisioningPlan.Operation.Set, loaDescription.trim()));\n\t\t\t\t\t\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"userAccountControl\", ProvisioningPlan.Operation.Set, 514));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\t\t\t\t\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(null != lifeCycleState && null != nativeIdentity && (\"inactive\".equalsIgnoreCase(lifeCycleState) || \"inactiveImmediateTerm\".equalsIgnoreCase(lifeCycleState)|| \"lsalclbbdc\".equalsIgnoreCase(lifeCycleState))) {\n\t\t\t\t\t\t\tacctReq = leaverPlan(acctReq, personNumber, nativeIdentity, \"leaver\");\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t}\n\t\t\t\t\t}                \n\t\t\t\t\telse if (operation.equals(ProvisioningPlan.AccountRequest.Operation.Enable)) {\n\t\t\t\t\t\tString oldDesc = idn.getRawAccountAttribute(applicationName, nativeIdentity, \"description\") != null ? (String) idn.getRawAccountAttribute(applicationName, nativeIdentity, \"description\") : \"\";\n\t\t\t\t\t\tString strOldDesc = oldDesc;\n\t\t\t\t\t\tif(\"Employee\".equalsIgnoreCase(workerType)) {\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif(null != lifeCycleState && \"active\".equalsIgnoreCase(lifeCycleState) && null != nativeIdentity && nativeIdentity.toUpperCase().indexOf(\"OU=LEGAL HOLD\") == -1\t&& nativeIdentity.toUpperCase().indexOf(\"OU=DISABLED\") == -1) {\n\t\t\t\t\t\t\t\tint loaIndex = oldDesc.toUpperCase().indexOf(\"LOA(\");\n\t\t\t\t\t\t\t\tint legalHoldIndex = oldDesc.toUpperCase().indexOf(\"LEGAL HOLD\");\n\t\t\t\t\t\t\t\tint termIndex = oldDesc.toUpperCase().indexOf(\"TERM(\");\n\t\t\t\t\t\t\t\tString newDescription = null;\n\t\t\t\t\t\t\t\tif(null != oldDesc && loaIndex != -1) {\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tString modifiedDesp = oldDesc.replace(\")\", \"]\");\n\t\t\t\t\t\t\t\t\tList list = new ArrayList();\n\t\t\t\t\t\t\t\t\tString[] substring = modifiedDesp.substring(modifiedDesp.lastIndexOf(\"LOA\") + 3).split(\"\\\\]\");\n\t\t\t\t\t\t\t\t\tlist.addAll(Arrays.asList(substring));\n\t\t\t\t\t\t\t\t\tString date = (String) list.get(0);\n\t\t\t\t\t\t\t\t\tString value = oldDesc.replace(date, \"\");\n\t\t\t\t\t\t\t\t\tnewDescription = value.replace(\"LOA)\", \"\");\n\t\t\t\t\t\t\t\t\tnewDescription = newDescription.trim();\n\t\t\t\t\t\t\t\t\tnewDescription = newDescription.replaceAll(\"  \", \" \");\n\t\t\t\t\t\t\t\t\tif (newDescription != null) {\n\t\t\t\t\t\t\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"description\", ProvisioningPlan.Operation.Set, newDescription.trim()));\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif(null != oldDesc && termIndex != -1 && null != adProvFlagBr && !adProvFlagBr.equalsIgnoreCase(\"H\")) {\n\t\t\t\t\t\t\t\t\tacctReq.setOperation(ProvisioningPlan.AccountRequest.Operation.Modify);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif(null != locationCode) {\n\t\t\t\t\t\t\t\t\tString newOU = getOUBasedOnLocation(locationCode);\n\t\t\t\t\t\t\t\t\tif(null != newOU && !nativeIdentity.contains(newOU)) {\n\t\t\t\t\t\t\t\t\t\tString sAMAccountName = (String) idn.getRawAccountAttribute(applicationName, nativeIdentity, \"sAMAccountName\");\n\t\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptSAMAccName\", sAMAccountName);\n\t\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptEnableDnMismatch\", \"true\");\n\t\t\t\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptNewOU\", newOU);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else if(null != lifeCycleState && \"active\".equalsIgnoreCase(lifeCycleState) && null != nativeIdentity && ( nativeIdentity.toUpperCase().indexOf(\"OU=LEGAL HOLD\") != -1 || nativeIdentity.toUpperCase().indexOf(\"OU=DISABLED\") != -1)) {\n\t\t\t\t\t\t\t\tacctReq.setOperation(ProvisioningPlan.AccountRequest.Operation.Modify);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tString suspended = getAccountAttributeValue(\"CZR-Application-Suspend\", \"Suspended\", personNumber);\n\t\t\t\t\t\tboolean isValidSOCSupendRequest = isValidSOCSupendRequest(\"CZR-Application-Suspend\", personNumber, suspended, false);\n\t\t\t\t\t\tstrSOCRequestLog = strSOCRequestLog+ \"WilliamHill In Enable \"+suspended+\" \"+isValidSOCSupendRequest;\n\t\t\t\t\t\tacctReq.addArgument(\"excScriptSuspenedReqLog\", strSOCRequestLog+\" strOldDesc:\"+strOldDesc);\n\t\t\t\t\t\tif(\"N\".equalsIgnoreCase(suspended) && strOldDesc.contains(\"DO NOT ENABLE PER IAM\") && isValidSOCSupendRequest) {\n\t\t\t\t\t\t\tstrOldDesc = strOldDesc.replace(\"DO NOT ENABLE PER IAM\", \"\");\n\t\t\t\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"description\", ProvisioningPlan.Operation.Set, strOldDesc));\n\t\t\t\t\t\t\tacctReq.add(new ProvisioningPlan.AttributeRequest(\"userAccountControl\", ProvisioningPlan.Operation.Set, 512));\n\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptSuspendedState\", \"activate\");\t\n\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptActivationReason\", getAccountAttributeValue(\"CZR-Application-Suspend\", \"ReasonForActivation\", personNumber));\n\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptSAMAccName\", (String)idn.getRawAccountAttribute(applicationName, nativeIdentity, \"sAMAccountName\"));\n\t\t\t\t\t\t\tacctReq.addArgument(\"excScriptUPN\", (String)idn.getRawAccountAttribute(applicationName, nativeIdentity, \"userPrincipalName\"));\n\t\t\t\t\t\t}\n\t\t\t\t\t}                \n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthrow new Exception(\"operation object value returned is null or empty\");\n\t\t\t}\n\t\t}\n    } else {\n        throw new Exception(\"accntRequest object value returned is null or empty\");\n    }\n} else {\n    throw new Exception(\"plan object value returned is null or empty\");\n}\n \n"
  },
  "attributes": {
    "sourceVersion": "2025-12-26 23:01:06"
  },
  "id": "c15357c5b68f47bbbb54e0d1ee0e009b",
  "name": "CZR_ActiveDirectory_BeforeProvisioning_WilliamHill",
  "created": "2025-11-06T18:06:57.518Z",
  "modified": "2025-12-26T23:01:06.502Z"
}