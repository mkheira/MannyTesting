{
  "description": "This rule is used by the  Web Services connector to update parsed resource object.\n    Create List of Objects  which will later converted to Resource object ",
  "type": "WebServiceAfterOperationRule",
  "signature": {
    "input": [
      {
        "name": "application",
        "description": "The application whose data file is being processed.",
        "type": null
      },
      {
        "name": "requestEndPoint",
        "description": "The current request information contain header, body ,response object",
        "type": null
      },
      {
        "name": "processedResponseObject",
        "description": "Response Object processed by the Web services connector",
        "type": null
      },
      {
        "name": "rawResponseObject",
        "description": "Response Object returned from the end system",
        "type": null
      },
      {
        "name": "restClient",
        "description": "REST Client Object",
        "type": null
      }
    ],
    "output": {
      "name": "Update Account/Group List",
      "description": "Update information Map contains parsed list of accounts",
      "type": null
    }
  },
  "sourceCode": {
    "version": "1.0",
    "script": "import connector.common.JsonUtil;\r\nimport java.util.HashMap;\r\nimport java.util.Map.Entry;\r\nimport java.util.Map;\r\nimport java.util.List;\r\nimport java.util.ArrayList;\r\nimport java.time.format.DateTimeFormatter;  \r\nimport java.time.LocalDateTime;\r\nimport java.time.temporal.ChronoUnit;\r\nimport java.time.LocalDate;\r\nimport sailpoint.tools.Util;\r\nimport sailpoint.connector.webservices.WebServicesClient;\r\nimport java.util.Base64;\r\n\r\npublic String getISCAccessToken() {\r\n\tString accessToken = null;\r\n\ttry {\r\n\t\tString baseUrl = application.getAttributeValue(\"iscBaseUrl\");\r\n\t\tString clientId = application.getAttributeValue(\"iscClientId_CA\");\r\n\t\tString clientSecret = application.getAttributeValue(\"iscClientSecret_CA\");\r\n\t\tif(null != baseUrl && null != clientId && null != clientSecret) {\r\n\r\n\t\t\tWebServicesClient client = new WebServicesClient();\r\n\t\t\tString url = baseUrl + \"/oauth/token?grant_type=client_credentials\";\r\n\t\t\tMap args = new HashMap();\r\n\t\t\targs.put(WebServicesClient.ARG_URL, url);\r\n\t\t\tclient.configure(args);\r\n\t\t\tMap header = new HashMap();\r\n\t\t\tString credentials = clientId + \":\" + clientSecret;\r\n\t\t\tString encodedCredentials = Base64.getEncoder().encodeToString(credentials.getBytes(\"UTF-8\"));\r\n\r\n            header.put(\"Accept\", \"application/json\");\r\n            header.put(\"Authorization\", \"Basic \" + encodedCredentials);\r\n\r\n            List<String> allowedStatuses = new ArrayList();\r\n            allowedStatuses.add(\"2**\");\r\n\r\n            String response = client.executePost(url, null, header, allowedStatuses);\r\n            if(sailpoint.tools.Util.isNotNullOrEmpty(response)) {\r\n                Map responseMap = JsonUtil.toMap(response);\r\n                if(null != responseMap && responseMap.containsKey(\"access_token\")){\r\n                    accessToken = (String) responseMap.get(\"access_token\");\r\n                }\r\n            }\r\n\t\t}            \r\n\t} catch (Exception e) {\r\n\t\tthrow new sailpoint.tools.GeneralException(\"getISCAccessToken:Exception: \" + e.getLocalizedMessage());\r\n\t\tlog.error(\"CZR-Rule-OICWebservice-BeforeOperation:getISCAccessToken:Exception: \" + e.getLocalizedMessage());\r\n\t}\r\n\treturn accessToken;\r\n}\r\n\r\npublic Map getLinkAttributes(String accessToken, String personNumber) {\r\n\tMap linkAttributes = null;\r\n\ttry {\r\n\t\tString baseUrl = application.getAttributeValue(\"iscBaseUrl\");\r\n\t\tif(null != baseUrl && null != accessToken && null != personNumber) {\r\n\t\t\tString oicAccountId = null;\r\n            WebServicesClient client = new WebServicesClient();\r\n            String url = baseUrl + \"/v3/search\";\r\n            Map args = new HashMap();\r\n            args.put(WebServicesClient.ARG_URL, url);\r\n            client.configure(args);\r\n            Map header = new HashMap();\r\n            header.put(\"Accept\", \"application/json\");\r\n            header.put(\"Authorization\", \"Bearer \" + accessToken);\r\n\r\n            List<String> allowedStatuses = new ArrayList();\r\n            allowedStatuses.add(\"2**\");\r\n            \r\n            String payload = \"{\\\"indices\\\":[\\\"identities\\\"],\\\"query\\\":{\\\"query\\\":\\\"attributes.uid:\" + personNumber + \"\\\"},\\\"sort\\\":[\\\"id\\\"]}\";\r\n\r\n            String response = client.executePost(url, payload, header, allowedStatuses);\r\n            if(sailpoint.tools.Util.isNotNullOrEmpty(response)) {\r\n                List responseList = JsonUtil.toList(response);\r\n                if(null != responseList && !responseList.isEmpty() && responseList.size() == 1){\r\n                    if(personNumber.equalsIgnoreCase((String)((Map)((Map) responseList.get(0)).get(\"attributes\")).get(\"uid\"))) {\r\n                        List accounts = (List) ((Map)responseList.get(0)).get(\"accounts\");\r\n                        if(null != accounts && !accounts.isEmpty()) {\r\n                            for(Map account : accounts) {\r\n                                if(\"CZR-Application-OICWebservice - Dev\".equalsIgnoreCase((String)((Map)account.get(\"source\")).get(\"name\"))) {\r\n                                   oicAccountId = (String) account.get(\"id\");\r\n                                   break;\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            if(sailpoint.tools.Util.isNotNullOrEmpty(oicAccountId)) {\r\n                url = baseUrl + \"/v3/accounts/\" + oicAccountId;\r\n                response = client.executeGet(url, header, allowedStatuses);\r\n                if(sailpoint.tools.Util.isNotNullOrEmpty(response)) {\r\n                    Map responseMap = JsonUtil.toMap(response);\r\n                    if(null != responseMap && responseMap.containsKey(\"attributes\")) {\r\n                        Map attributes = (Map) responseMap.get(\"attributes\");\r\n                        if(null != attributes && attributes.containsKey(\"assignments\")) {\r\n                            linkAttributes = attributes;\r\n                        }\r\n                    }\r\n                }\r\n            }            \r\n        }\r\n\t} catch(Exception e) {\r\n\t\tlog.error(\"CZR-Rule-OICWebservice-AfterOperation:getLinkAssignments:Exception: \" + e.getLocalizedMessage());\r\n\t}\r\n\treturn linkAttributes;\r\n}\r\n\r\npublic Map collectChildData(List linkAssignments, List allAssignments) {\r\n\tList primRecords = new ArrayList();\r\n\tfor(String eachAssignments : allAssignments){\r\n\t\tMap eachAssignmentsMap = JsonUtil.toMap(eachAssignments);\r\n\t\tString  childPosition=( eachAssignmentsMap.get(\"PositionName\")!=null && !eachAssignmentsMap.get(\"PositionName\").isEmpty() && eachAssignmentsMap.get(\"PositionName\")!=void) ? eachAssignmentsMap.get(\"PositionName\") : \"NULL\";\r\n\t\tString  childDivision=( eachAssignmentsMap.get(\"Division\")!=null && !eachAssignmentsMap.get(\"Division\").isEmpty() && eachAssignmentsMap.get(\"Division\")!=void) ? eachAssignmentsMap.get(\"Division\") : \"NULL\";\r\n\t\tString  childLoc=( eachAssignmentsMap.get(\"LocationCode\")!=null && !eachAssignmentsMap.get(\"LocationCode\").isEmpty() && eachAssignmentsMap.get(\"LocationCode\")!=void) ? eachAssignmentsMap.get(\"LocationCode\") : \"NULL\";\r\n\t\tString  childAssignNo=( eachAssignmentsMap.get(\"AssignmentNumber\")!=null && !eachAssignmentsMap.get(\"AssignmentNumber\").isEmpty() && eachAssignmentsMap.get(\"AssignmentNumber\")!=void) ? eachAssignmentsMap.get(\"AssignmentNumber\") : \"NULL\";\r\n\t\tString  childAssignStatus=( eachAssignmentsMap.get(\"AssignmentStatusType\")!=null && !eachAssignmentsMap.get(\"AssignmentStatusType\").isEmpty() && eachAssignmentsMap.get(\"AssignmentStatusType\")!=void) ? eachAssignmentsMap.get(\"AssignmentStatusType\") : \"NULL\";\r\n\t\tString  childPrimAssign=( eachAssignmentsMap.get(\"PrimaryAssignment\")!=null && !eachAssignmentsMap.get(\"PrimaryAssignment\").isEmpty() && \teachAssignmentsMap.get(\"PrimaryAssignment\")!=void) ? eachAssignmentsMap.get(\"PrimaryAssignment\") : \"NULL\";\r\n\t\tString  childPrimWrk=( eachAssignmentsMap.get(\"PrimaryWorkRelationship\")!=null && !eachAssignmentsMap.get(\"PrimaryWorkRelationship\").isEmpty() && eachAssignmentsMap.get(\"PrimaryWorkRelationship\")!=void) ? eachAssignmentsMap.get(\"PrimaryWorkRelationship\") : \"NULL\";\r\n\t\tString  childMngLevel=( eachAssignmentsMap.get(\"ManagementLevel\")!=null && !eachAssignmentsMap.get(\"ManagementLevel\").isEmpty() && eachAssignmentsMap.get(\"ManagementLevel\")!=void) ? eachAssignmentsMap.get(\"ManagementLevel\") : \"NULL\";\r\n\t\tString  childMngNumber=( eachAssignmentsMap.get(\"ManagerPersonNumber\")!=null && !eachAssignmentsMap.get(\"ManagerPersonNumber\").isEmpty() && eachAssignmentsMap.get(\"ManagerPersonNumber\")!=void) ? eachAssignmentsMap.get(\"ManagerPersonNumber\") : \"NULL\";\r\n\t\tString  childAssignStart=( eachAssignmentsMap.get(\"AssignmentStartDate\")!=null && !eachAssignmentsMap.get(\"AssignmentStartDate\").isEmpty() && eachAssignmentsMap.get(\"AssignmentStartDate\")!=void) ? eachAssignmentsMap.get(\"AssignmentStartDate\") : \"NULL\";\r\n\t\tString  childAssignEnd=( eachAssignmentsMap.get(\"AssignmentEndDate\")!=null && !eachAssignmentsMap.get(\"AssignmentEndDate\").isEmpty() && eachAssignmentsMap.get(\"AssignmentEndDate\")!=void) ? eachAssignmentsMap.get(\"AssignmentEndDate\") : \"NULL\";\r\n\r\n\t\tString childAll=childAssignNo+\"##\"+childPosition+\"##\"+childDivision+\"##\"+childLoc+\"##\"+childAssignStart+\"##\"+childAssignEnd+\"##\"+childAssignStatus+\"##\"+childMngLevel+\"##\"+childMngNumber+\"##\"+childPrimAssign+\"##\"+childPrimWrk;\r\n\t\t\t\t\r\n\t\tfor(int i=0; i < linkAssignments.size();i++){\r\n\t\t\tString linkEachAssignment = linkAssignments.get(i);\r\n\t\t\tif(linkEachAssignment!=null){\r\n\t\t\t\tString[] linkEachAssignmentArray = linkEachAssignment.split(\"##\");\r\n\t\t\t\tif(linkEachAssignmentArray!=null && linkEachAssignmentArray.length!=0){\r\n\t\t\t\t\tString linkEachAssignmentNumber = linkEachAssignmentArray[0];\r\n\t\t\t\t\tif(linkEachAssignmentNumber!=null && linkEachAssignmentNumber.equalsIgnoreCase(childAssignNo))\r\n\t\t\t\t\t\tlinkAssignments.remove(i);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\t\t\r\n\t\tString  workerType= eachAssignmentsMap.get(\"WorkerType\");\r\n\r\n\t\tif(eachAssignmentsMap.get(\"PrimaryWorkRelationship\")!=null && eachAssignmentsMap.get(\"PrimaryAssignment\")!=null && eachAssignmentsMap.get(\"PrimaryWorkRelationship\").equalsIgnoreCase(\"Y\") && eachAssignmentsMap.get(\"PrimaryAssignment\").equalsIgnoreCase(\"Y\") || (workerType!=null && workerType.equalsIgnoreCase(\"P\")))\r\n\t\t\tprimRecords.add(eachAssignmentsMap);\r\n\r\n\t\tlinkAssignments.add(childAll);\t\t\t\t\r\n\t}\r\n\t\r\n\tMap returnMap = new HashMap();\r\n\treturnMap.put(\"primRecords\", primRecords);\r\n\treturnMap.put(\"linkAssignments\", linkAssignments);\r\n\t\r\n\treturn returnMap;\r\n}\r\n\r\nMap updatedMapInfo = new HashMap();\r\nMap connectorStateMap = new HashMap();\r\nif(processedResponseObject != null) {\r\n\tMap transientValues = application.getAttributeValue(\"transientValues\");\r\n\tif(transientValues == null) {\r\n\t\ttransientValues = new HashMap();\r\n\t\tapplication.setAttribute(\"transientValues\", transientValues);\r\n\t}\r\n\t\r\n\ttry {\r\n\t\tint StartRow;\r\n\t\tint EndRow;\r\n\t\r\n\t\tURL url = new URL(requestEndPoint.getFullUrl());\r\n\t\tString[] params = url.getQuery().split(\"&\");\r\n\t\tfor (String param : params) {\r\n\t\t\tString name = param.split(\"=\")[0]; \r\n\t\t\tString value = param.split(\"=\")[1];\r\n\t\t\tswitch(name) {\r\n\t\t\t\tcase \"StartRow\":\r\n\t\t\t\t\tStartRow = Integer.parseInt(value);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"EndRow\":\r\n\t\t\t\t\tEndRow = Integer.parseInt(value);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t}\r\n\t\t}\r\n\t\r\n\t\tint count =0;\r\n\t\tString changeCount = transientValues.get(\"changeCount\");\r\n\t\tString fullCount = transientValues.get(\"fullCount\");\r\n\t\t\r\n\t\tif(changeCount!=null && !changeCount.equalsIgnoreCase(\"0\")){\r\n\t\t  count=Integer.parseInt(changeCount);\r\n\t\t}\r\n\t\telse if(fullCount!=null && !fullCount.equalsIgnoreCase(\"0\")){\r\n\t\t  count=Integer.parseInt(fullCount);\r\n\t\t}\r\n\r\n\t\tString changeDateForNextHit =null;\r\n\t\tif(rawResponseObject!=null && (StartRow==null || StartRow==1)){      \r\n\t\t\tMap rawResponseMap = (Map) JsonUtil.toMap(rawResponseObject);\r\n\t\t\tif(rawResponseMap!=null)\r\n\t\t\t\tchangeDateForNextHit = rawResponseMap.get(\"InterfaceReturnDate\");\r\n\t\t\tlog.warn(\"changeDateForNextHit in response::\"+changeDateForNextHit);\r\n\t\t\r\n\t\t\tif(changeDateForNextHit!=null){\r\n\t\t\t\ttransientValues.put(\"changeDateForNextHit\", changeDateForNextHit);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tboolean hasMore = false;\r\n\t\tif(EndRow < count){\r\n\t\t\thasMore = true;\t\t\r\n\t\t} else {\r\n\t\t\thasMore = false;\r\n\t\t\tString changeDateCurrentfromMap = transientValues.get(\"changeDate\");\r\n\t\t\tString changeDateforNextfromMap = transientValues.get(\"changeDateForNextHit\");\r\n\r\n\t\t\tif(application!=null && changeDateforNextfromMap!=null && changeDateCurrentfromMap!=null ){\r\n\t\t\t\tconnectorStateMap.put(\"changeEndpointNextHitTime\", changeDateforNextfromMap);\r\n\t\t\t\tconnectorStateMap.put(\"changeEndpointPreviousHitTime\", changeDateCurrentfromMap);\r\n\t\t\t\tupdatedMapInfo.put(\"connectorStateMap\",connectorStateMap);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\ttransientValues.put(\"hasMore\", hasMore);\r\n\r\n\t\tif(hasMore) {\r\n\t\t  transientValues.put(\"StartRow\", String.valueOf(StartRow + 2000));\r\n\t\t  transientValues.put(\"EndRow\", String.valueOf(EndRow + 2000));\r\n\t\t}\r\n\t\r\n\t} catch(Exception e) {\r\n\t\tlog.error(\"Catch bolck running in OIC AfterOperation rule:: \"+e);\r\n\t\tthrow new sailpoint.tools.GeneralException(\"Catch bolck running in OIC AfterOperation rule:: \" + e.getLocalizedMessage());\t\t\r\n\t}\r\n\t\r\n\t//parse assignments and get values from primay assignments\r\n\tif(null != processedResponseObject && !processedResponseObject.isEmpty()) {\r\n\t\tString accessToken = getISCAccessToken();\r\n\t\tfor (Map object : processedResponseObject) {\r\n\t\t\tList allAssignments = object.get(\"assignments\");\r\n\t\t\tString personNumber = object.get(\"PersonNumber\");\r\n\t\t\tMap appLink= null;\r\n\t\t\t\r\n\t\t\tList primRecords = new ArrayList();\r\n\t\t\tList linkAssignments = new ArrayList();\r\n\t\t\tappLink = getLinkAttributes(accessToken, personNumber);\r\n\t\t\tif(null != appLink && appLink.containsKey(\"assignments\"))\r\n\t\t\t\tlinkAssignments = (List) appLink.get(\"assignments\");\r\n\t\t\t\r\n\t\t\tif(linkAssignments!=null && allAssignments!=null && linkAssignments.size()!=0 && allAssignments.size()!=0){ //For existing identity update\r\n\t\t\t\tMap returnMap = collectChildData(linkAssignments,allAssignments);\r\n\t\t\t\tif(returnMap != null) {\r\n\t\t\t\t\tList finalValue = returnMap.get(\"linkAssignments\");\r\n\t\t\t\t\tprimRecords = returnMap.get(\"primRecords\");\r\n\t\t\t\t\tif(finalValue!=null && finalValue.size()!=0)\r\n\t\t\t\t\t\tobject.put(\"assignments\",finalValue);\r\n\t\t\t\t}\t\t\t\t\r\n\t\t\t}\r\n\t\t\telse { // For create new identity\r\n\t\t\t\tlinkAssignments.add(\"AssignmentNumber##PositionName##Division##LocationCode##AsgStartDate##AsgEndDate##AssignmentStatusType##ManagementLevel##ManagerPersonNumber##PrimaryAssignment##PrimaryWorkRelationship\");\r\n\t\t\t\tList finalValue = new ArrayList();\r\n\t\t\t\tif(allAssignments!=null && allAssignments.size()!=0) {\r\n\t\t\t\t\tMap returnMap = collectChildData(linkAssignments,allAssignments);\r\n\t\t\t\t\tif(returnMap != null) {\r\n\t\t\t\t\t\tfinalValue = returnMap.get(\"linkAssignments\");\r\n\t\t\t\t\t\tprimRecords = returnMap.get(\"primRecords\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\tif(finalValue!=null && finalValue.size()!=0)\r\n\t\t\t\t\tobject.put(\"assignments\",finalValue);\r\n\t\t\t\telse\r\n\t\t\t\t\tobject.put(\"assignments\",linkAssignment);\r\n\t\t\t}\r\n\r\n\t\t\tMap primRecord=null;\r\n\t\t\t\r\n\t\t\tif(primRecords!=null && primRecords.size()==1) {\r\n\t\t\t\tprimRecord = primRecords.get(0);\r\n\t\t\t}\r\n\t\t\telse if(primRecords!=null && primRecords.size()>1) {\r\n\t\t\t\tfor(Map eachPrimRecord : primRecords){\r\n\t\t\t\t\tString status = eachPrimRecord.get(\"AssignmentStatusType\");\r\n\t\t\t\t\tString workerType = eachPrimRecord.get(\"WorkerType\");\r\n\t\t\t\t\tString proStartDate = eachPrimRecord.get(\"ProjectedStartDate\");\r\n\r\n\t\t\t\t\tif(status!=null && workerType!=null && status.equalsIgnoreCase(\"ACTIVE\") && workerType.equalsIgnoreCase(\"E\")){\r\n\t\t\t\t\t\tprimRecord = eachPrimRecord;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if(workerType!=null && workerType.equalsIgnoreCase(\"P\") && proStartDate!=null){\r\n\t\t\t\t\t\tDateTimeFormatter dtf = DateTimeFormatter.ofPattern(\"yyyy-MM-dd\");  \r\n\t\t\t\t\t\tLocalDateTime now = LocalDateTime.now();  \r\n\t\t\t\t\t\tString todayDate=(dtf.format(now));\r\n\r\n\t\t\t\t\t\tLocalDate dateBefore = LocalDate.parse(todayDate);\r\n\t\t\t\t\t\tLocalDate dateAfter = LocalDate.parse(proStartDate); \r\n\t\t\t\t\t\tlong daysDiff = ChronoUnit.DAYS.between(dateBefore, dateAfter);\r\n\t\t\t\t\t\tif(daysDiff!=null && daysDiff>0){\r\n\t\t\t\t\t\t\tprimRecord = eachPrimRecord;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif(primRecord==null && appLink!=null){\r\n\t\t\t\t\tString identityAsgNumber = appLink.get(\"AssignmentNumber\");\r\n\t\t\t\t\tif(identityAsgNumber!=null){\r\n\t\t\t\t\t\tfor(Map eachPrimRecord : primRecords){\r\n\t\t\t\t\t\t\tString asgNumber = eachPrimRecord.get(\"AssignmentNumber\");\r\n\t\t\t\t\t\t\tif(asgNumber!=null && identityAsgNumber.equalsIgnoreCase(asgNumber)){\r\n\t\t\t\t\t\t\t\tprimRecord = eachPrimRecord;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n      \t\t\t\t\r\n\t\t\t\tif(primRecord==null){\r\n\t\t\t\t\tprimRecord = primRecords.get(0);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tString  DepartmentName= null;\r\n\t\t\tString  LocationCode= null;\r\n\t\t\tString  AssignmentNumber= null;\r\n\t\t\tString  AssignmentStatusType= null;\r\n\t\t\tString  PrimaryAssignment= null;\r\n\t\t\tString  PrimaryWorkRelationship= null;\r\n\t\t\tString  ManagementLevel= null;\r\n\t\t\tString  AssignmentStartDate= null;\r\n\t\t\tString  AssignmentEndDate= null;\r\n\t\t\tString  TerminationDate= null;\r\n\t\t\tString  AssignmentStatusTypeCode= null;\r\n\t\t\tString  AssignmentStatusTypeCodeMeaning= null;\r\n\t\t\tString  AssignmentCategoryCode= null;\r\n\t\t\tString  LOAStartDate= null;\r\n\t\t\tString  BusinessUnit= null;\r\n\t\t\tString  PropertyCode= null;\r\n\t\t\tString  Division= null;\r\n\t\t\tString  ManagerFullName= null;\r\n\t\t\tString  ManagerPersonNumber= null;\r\n\t\t\tString  PositionName= null;\r\n\t\t\tString  Region= null;\r\n\t\t\tString  WorkerType= null;\r\n\t\t\tString  LocationName= null;\r\n\t\t\tString  AssignmentCategoryCodeMeaning= null;\r\n\t\t\tString  ProjectedStartDate= null;\r\n\t\t\tString  PositionCode= null;\r\n\t\t\tString  LegalEmployerName= null;\r\n\r\n\t\t\tif(primRecord!=null && primRecord.size()!=0){\r\n\t\t\t\tDepartmentName= primRecord.get(\"DepartmentName\");\r\n\t\t\t\tLocationCode=primRecord.get(\"LocationCode\");\r\n\t\t\t\tAssignmentNumber=primRecord.get(\"AssignmentNumber\");\r\n\t\t\t\tAssignmentStatusType=primRecord.get(\"AssignmentStatusType\");\r\n\t\t\t\tPrimaryAssignment=primRecord.get(\"PrimaryAssignment\");\r\n\t\t\t\tPrimaryWorkRelationship=primRecord.get(\"PrimaryWorkRelationship\");\r\n\t\t\t\tManagementLevel=primRecord.get(\"ManagementLevel\");\r\n\t\t\t\tAssignmentStartDate=primRecord.get(\"AssignmentStartDate\");\r\n\t\t\t\tAssignmentEndDate=primRecord.get(\"AssignmentEndDate\");\r\n\t\t\t\tTerminationDate=primRecord.get(\"TerminationDate\");\r\n\t\t\t\tAssignmentStatusTypeCode=primRecord.get(\"AssignmentStatusTypeCode\");\r\n\t\t\t\tAssignmentStatusTypeCodeMeaning=primRecord.get(\"AssignmentStatusTypeCodeMeaning\");\r\n\t\t\t\tAssignmentCategoryCode=primRecord.get(\"AssignmentCategoryCode\");\r\n\t\t\t\tLOAStartDate=primRecord.get(\"LOAStartDate\");\r\n\t\t\t\tBusinessUnit=primRecord.get(\"BusinessUnit\");\r\n\t\t\t\tPropertyCode=primRecord.get(\"PropertyCode\");\r\n\t\t\t\tDivision=primRecord.get(\"Division\");\r\n\t\t\t\tManagerFullName=primRecord.get(\"ManagerFullName\");\r\n\t\t\t\tManagerPersonNumber=primRecord.get(\"ManagerPersonNumber\");\r\n\t\t\t\tPositionName=primRecord.get(\"PositionName\");\r\n\t\t\t\tRegion=primRecord.get(\"Region\");\r\n\t\t\t\tWorkerType=primRecord.get(\"WorkerType\");\r\n\t\t\t\tLocationName=primRecord.get(\"LocationName\");\r\n\t\t\t\tAssignmentCategoryCodeMeaning=primRecord.get(\"AssignmentCategoryCodeMeaning\");\r\n\t\t\t\tProjectedStartDate=primRecord.get(\"ProjectedStartDate\");\r\n\t\t\t\tPositionCode=primRecord.get(\"PositionCode\");\r\n\t\t\t\tLegalEmployerName=primRecord.get(\"LegalEmployerName\");\r\n\t\t\t} else if(appLink!=null && appLink.size()!=0 ){\r\n\t\t\t\tDepartmentName= appLink.get(\"DepartmentName\");\r\n\t\t\t\tLocationCode=appLink.get(\"LocationCode\");\r\n\t\t\t\tAssignmentNumber=appLink.get(\"AssignmentNumber\");\r\n\t\t\t\tAssignmentStatusType=appLink.get(\"AssignmentStatusType\");\r\n\t\t\t\tPrimaryAssignment=appLink.get(\"PrimaryAssignment\");\r\n\t\t\t\tPrimaryWorkRelationship=appLink.get(\"PrimaryWorkRelationship\");\r\n\t\t\t\tManagementLevel=appLink.get(\"ManagementLevel\");\r\n\t\t\t\tAssignmentStartDate=appLink.get(\"AsgStartDate\");\r\n\t\t\t\tAssignmentEndDate=appLink.get(\"AsgEndDate\");\r\n\t\t\t\tTerminationDate=appLink.get(\"TerminationDate\");\r\n\t\t\t\tAssignmentStatusTypeCode=appLink.get(\"AssignmentStatusTypeCode\");\r\n\t\t\t\tAssignmentStatusTypeCodeMeaning=appLink.get(\"AssignmentStatusTypeCodeMeaning\");\r\n\t\t\t\tAssignmentCategoryCode=appLink.get(\"AssignmentCategoryCode\");\r\n\t\t\t\tLOAStartDate=appLink.get(\"LOAStartDate\");\r\n\t\t\t\tBusinessUnit=appLink.get(\"BusinessUnit\");\r\n\t\t\t\tPropertyCode=appLink.get(\"PropertyCode\");\r\n\t\t\t\tDivision=appLink.get(\"Division\");\r\n\t\t\t\tManagerFullName=appLink.get(\"ManagerFullName\");\r\n\t\t\t\tManagerPersonNumber=appLink.get(\"ManagerPersonNumber\");\r\n\t\t\t\tPositionName=appLink.get(\"PositionName\");\r\n\t\t\t\tRegion=appLink.get(\"Region\");\r\n\t\t\t\tWorkerType=appLink.get(\"WorkerType\");\r\n\t\t\t\tLocationName=appLink.get(\"LocationName\");\r\n\t\t\t\tAssignmentCategoryCodeMeaning=appLink.get(\"AssignmentCategoryCodeMeaning\");\r\n\t\t\t\tProjectedStartDate=appLink.get(\"ProjectedStartDate\");\r\n\t\t\t\tPositionCode=appLink.get(\"PositionCode\");\r\n\t\t\t\tLegalEmployerName=appLink.get(\"LegalEmployerName\");\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(DepartmentName!=null)\r\n\t\t\t\tobject.put(\"DepartmentName\",DepartmentName);\r\n\t\t\tif(LocationCode!=null)\r\n\t\t\t\tobject.put(\"LocationCode\",LocationCode);\r\n\t\t\tif(AssignmentNumber!=null)\r\n\t\t\t\tobject.put(\"AssignmentNumber\",AssignmentNumber);\r\n\t\t\tif(AssignmentStatusType!=null)\r\n\t\t\t\tobject.put(\"AssignmentStatusType\",AssignmentStatusType); \r\n\t\t\tif(PrimaryAssignment!=null)\r\n\t\t\t\tobject.put(\"PrimaryAssignment\",PrimaryAssignment);\r\n\t\t\tif(PrimaryWorkRelationship!=null)\r\n\t\t\t\tobject.put(\"PrimaryWorkRelationship\",PrimaryWorkRelationship);\r\n\t\t\tif(ManagementLevel!=null)\r\n\t\t\t\tobject.put(\"ManagementLevel\",ManagementLevel);\r\n\t\t\tif(AssignmentStartDate!=null)\r\n\t\t\t\tobject.put(\"AsgStartDate\",AssignmentStartDate);\r\n\t\t\tif(AssignmentEndDate!=null)\r\n\t\t\t\tobject.put(\"AsgEndDate\",AssignmentEndDate);\r\n\t\t\tif(TerminationDate!=null)\r\n\t\t\t\tobject.put(\"TerminationDate\",TerminationDate);\r\n\t\t\tif(AssignmentStatusTypeCode!=null)\r\n\t\t\t\tobject.put(\"AssignmentStatusTypeCode\",AssignmentStatusTypeCode);\r\n\t\t\tif(AssignmentStatusTypeCodeMeaning!=null)\r\n\t\t\t\tobject.put(\"AsgStatusMeaning\",AssignmentStatusTypeCodeMeaning);\r\n\t\t\tif(AssignmentCategoryCode!=null)\r\n\t\t\t\tobject.put(\"AsgCategoryCode\",AssignmentCategoryCode);\r\n\t\t\tif(LOAStartDate!=null)\r\n\t\t\t\tobject.put(\"LOAStartDate\",LOAStartDate);\r\n\t\t\tif(BusinessUnit!=null)\r\n\t\t\t\tobject.put(\"BusinessUnitName\",BusinessUnit);\r\n\t\t\tif(PropertyCode!=null)\r\n\t\t\t\tobject.put(\"PropertyCode\",PropertyCode);\r\n\t\t\tif(Division!=null)\r\n\t\t\t\tobject.put(\"Division\",Division);\r\n\t\t\tif(ManagerFullName!=null)\r\n\t\t\t\tobject.put(\"ManagerFullName\",ManagerFullName);\r\n\t\t\tif(ManagerPersonNumber!=null)\r\n\t\t\t\tobject.put(\"ManagerPersonNumber\",ManagerPersonNumber);\r\n\t\t\tif(PositionName!=null)\r\n\t\t\t\tobject.put(\"PositionName\",PositionName);\r\n\t\t\tif(Region!=null)\r\n\t\t\t\tobject.put(\"Region\",Region);\r\n\t\t\tif(WorkerType!=null)\r\n\t\t\t\tobject.put(\"WorkerType\",WorkerType);\r\n\t\t\tif(DepartmentName!=null)\r\n\t\t\t\tobject.put(\"LocationName\",LocationName);\r\n\t\t\tif(AssignmentCategoryCodeMeaning!=null)\r\n\t\t\t\tobject.put(\"AsgCategoryMeaning\",AssignmentCategoryCodeMeaning);\r\n\t\t\tif(ProjectedStartDate!=null)\r\n\t\t\t\tobject.put(\"ProjectedStartDate\",ProjectedStartDate);\r\n\t\t\tif(DepartmentName!=null)\r\n\t\t\t\tobject.put(\"PositionCode\",PositionCode);\r\n\t\t\tif(LegalEmployerName!=null)\r\n\t\t\t\tobject.put(\"LegalEmployerName\",LegalEmployerName);\r\n\r\n\t\t\tif(AssignmentStatusType!=null && AssignmentStatusType.equalsIgnoreCase(\"INACTIVE\")){\r\n\t\t\t\tobject.put(\"IIQDisabled\",true);\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\tobject.put(\"IIQDisabled\",false);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\t\r\n\tupdatedMapInfo.put(\"data\", processedResponseObject);\r\n}\r\n\r\nreturn updatedMapInfo;"
  },
  "attributes": {
    "sourceVersion": "1.0"
  },
  "id": "c2d37ef1ef2d4bdcb48e10a72dd76568",
  "name": "CZR-Rule-OICWebservice-AfterOperation",
  "created": "2025-02-11T06:13:52.798Z",
  "modified": "2025-05-28T15:50:51.729Z"
}