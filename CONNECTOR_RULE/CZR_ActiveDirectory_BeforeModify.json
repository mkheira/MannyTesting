{
  "description": "This rule is used to execute the joiner provisioning PowerShell script to call ps Before AD Modify",
  "type": "ConnectorBeforeModify",
  "signature": {
    "input": [],
    "output": {
      "name": "",
      "description": null,
      "type": null
    }
  },
  "sourceCode": {
    "version": "1.0",
    "script": "function log($string) {\r\n\t$timestamp = \"$(Get-Date -format \"MM-dd-yyyy HH:mm.ss\"): \";\r\n\t$entry = $timestamp + $string;\r\n    $entry | Out-File -Filepath $logFile -append;\r\n}\r\n\r\nfunction Get-AttributeValueFromAccountRequest([sailpoint.Utils.objects.AccountRequest] $request, [String] $targetAttribute) {\r\n\t$value = $null;\r\n    if ($request) {\r\n      foreach ($attrib in $request.AttributeRequests) {\r\n        if ($attrib.Name -eq $targetAttribute) {\r\n          $value = $attrib.Value;\r\n          break;\r\n        }\r\n      }\r\n    }\r\n\treturn $value;\r\n}\r\nTry {\r\n\tAdd-type -path \"D:\\IQService\\Utils.dll\";\r\n\t# Read the environment variables\r\n\t$sReader = New-Object System.IO.StringReader([System.String]$env:Request);\r\n\r\n\t# Form the xml reader objects\r\n\t$xmlReader = [System.xml.XmlTextReader]([sailpoint.utils.xml.XmlUtil]::getReader($sReader));\r\n\r\n\t# Create SailPoint objects\r\n\t$requestObject = New-Object sailpoint.utils.objects.AccountRequest($xmlReader);\r\n\t  \r\n\t$op = $requestObject.operation;\r\n\t$dn = $requestObject.nativeIdentity;\r\n\t$dnarr = $dn -split \",OU\" , 0;\r\n\t$cntemp = $dnarr[0];\r\n\t$cntemp = $cntemp -replace 'CN=','';\r\n\t$cntemp = $cntemp -replace ',','';\r\n\t$cn = $cntemp.Replace(' ','_');\r\n\t\r\n\t$logDate = Get-Date -Format \"yyyy-MM-dd\";\r\n\t$logFile = \"D:\\Sailpoint\\ISCLogs\\ADBeforeModify\\ADBeforeModify-$logDate-$cn.log\";\r\n\t\r\n\tlog(\"CZR AD Before Modify Starts =======> $cn\");\r\n\t$description = Get-AttributeValueFromAccountRequest $requestObject \"description\";\r\n\t$adDesc = Get-ADUser -Identity $dn -properties Description  | %{ $_.Description };\r\n\t$title = Get-AttributeValueFromAccountRequest $requestObject \"msExchExtensionAttribute39\";\r\n\t$adTitle = Get-ADUser -Identity $dn -properties MsExchExtensionAttribute39  | %{ $_.MsExchExtensionAttribute39 };\r\n\t$mailNickname = Get-AttributeValueFromAccountRequest $requestObject \"mailNickname\";\r\n\t$mail = Get-AttributeValueFromAccountRequest $requestObject \"mail\";\r\n\t$adMail = Get-ADUser -Identity $dn -properties Mail  | %{ $_.Mail };\r\n\t$adUPN = Get-ADUser -Identity $dn -properties UserPrincipalName  | %{ $_.UserPrincipalName };\r\n\t$managementLevel = Get-AttributeValueFromAccountRequest $requestObject \"extensionAttribute9\";\r\n\t$extensionAttribute8 = Get-AttributeValueFromAccountRequest $requestObject \"extensionAttribute8\";\r\n\t$adExtensionAttribute8 = Get-ADUser -Identity $dn -properties ExtensionAttribute8  | %{ $_.ExtensionAttribute8 };\r\n\t$loa = \"false\";\r\n\t$returnloa = \"false\";\r\n\t$term = \"false\";\r\n\t$titlechange = \"false\";\r\n\t$addmail = \"false\";\r\n\t$replaceOldExtAtt8 = \"false\";\r\n\t$currentDate = Get-Date -Format \"MM/dd/yyyy\";\r\n\t$requestOutFile = $args[0];\r\n\t\t\r\n\tif((![string]::IsNullOrEmpty($extensionAttribute8)) -and $extensionAttribute8 -eq \"SDSBOSSUSER\") {\r\n\t\t$replaceOldExtAtt8 = \"true\";\r\n\t}\r\n\tif((![string]::IsNullOrEmpty($extensionAttribute8)) -and $extensionAttribute8 -eq \"REGULARUSER\") {\r\n\t\t$replaceOldExtAtt8 = \"true\";\r\n\t}\t\r\n\tif((![string]::IsNullOrEmpty($description)) -and $description -like \"*LOA(*\") {\r\n\t\tif((![string]::IsNullOrEmpty($adDesc)) -and $adDesc -notlike  \"*LOA(*\" -and $adDesc -notlike  \"*LOA (*\") {\r\n\t\t\t$loa = \"true\";\r\n\t\t}\r\n\t}\r\n\tif((![string]::IsNullOrEmpty($description)) -and $description -notlike \"*LOA(*\" -and $description -notlike \"*LOA (*\") {\r\n\t\tif((![string]::IsNullOrEmpty($adDesc)) -and ($adDesc -like  \"*LOA(*\" -or $adDesc -like  \"*LOA(*\")) {\r\n\t\t\t$returnloa = \"true\";\r\n\t\t}\r\n\t}\r\n\tif((![string]::IsNullOrEmpty($description)) -and $description -like \"*TERM(*\") {\r\n\t\tif((![string]::IsNullOrEmpty($adDesc)) -and $adDesc -notlike  \"*TERM(*\" -and $adDesc -notlike  \"*TERM (*\") {\r\n\t\t\t$term = \"true\";\r\n\t\t}\r\n\t}\r\n\tif((![string]::IsNullOrEmpty($title)) -and (![string]::IsNullOrEmpty($adTitle))) {\r\n\t\tif($title -ne $adTitle) {\r\n\t\t\t$titlechange = \"true\";\r\n\t\t}\r\n\t}\r\n\tif((![string]::IsNullOrEmpty($mailNickname))) {\r\n\t\tif(([string]::IsNullOrEmpty($adMail))) {\r\n\t\t\tif(([string]::IsNullOrEmpty($mail))) {\r\n\t\t\t\tif((![string]::IsNullOrEmpty($adUPN))) {\r\n\t\t\t\t\t$addmail = \"true\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\t\r\n\tif($replaceOldExtAtt8 -eq \"true\") {\r\n\t\tlog(\"REPLACE OLD EXT ATT 8 is TRUE\");\r\n\t\t$newADExtAtt8 = $adExtensionAttribute8;\r\n\t\tlog(\"newADExtAtt8: $newADExtAtt8\");\r\n\t\t# Get original value passed to Powershell script from BeforeCreate rule\r\n\t\t$originalExtAtt8AttributeRequest = \"\"\r\n\t\tforeach ($attribute in $requestObject.AttributeRequests){\r\n\t\t\t# Save the original description attribute object to be replaced later\r\n\t\t\tif ($attribute.Name -eq \"extensionAttribute8\") {\r\n\t\t\t\t$originalExtAtt8AttributeRequest = $attribute\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t# Generate new AttributeRequest\r\n\t\t$newADExtAtt8AttributeRequest = New-Object SailPoint.Utils.objects.AttributeRequest\r\n\t\t$newADExtAtt8AttributeRequest.Operation = \"Add\";\r\n\t\t$newADExtAtt8AttributeRequest.Name = \"extensionAttribute8\";\r\n\t\t$newADExtAtt8AttributeRequest.Value = $newADExtAtt8;\r\n\r\n\t\t# Remove the old AttributeRequest\r\n\t\t$requestObject.AttributeRequests.Remove($originalExtAtt8AttributeRequest);\r\n\t\t# Add in the new AttributeRequest\r\n\t\t$requestObject.AttributeRequests.Add($newADExtAtt8AttributeRequest)\r\n\t\t# Return New AttributeRequest in requestObject to IQService\r\n\t\t$requestObject.toxml() | out-file $requestOutFile;\r\n\t}\r\n\t\r\n\tif($loa -eq \"true\") {\r\n\t\tlog(\"LOA is TRUE\");\r\n\t\t$newADDesc = \"LOA($currentDate) $adDesc\";\r\n\t\tlog(\"newADDesc: $newADDesc\");\r\n\t\t# Get original value passed to Powershell script from BeforeCreate rule\r\n\t\t$originalDescAttributeRequest = \"\"\r\n\t\tforeach ($attribute in $requestObject.AttributeRequests){\r\n\t\t\t# Save the original description attribute object to be replaced later\r\n\t\t\tif ($attribute.Name -eq \"description\") {\r\n\t\t\t\t$originalDescAttributeRequest = $attribute\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t# Generate new AttributeRequest\r\n\t\t$newADDescAttributeRequest = New-Object SailPoint.Utils.objects.AttributeRequest\r\n\t\t$newADDescAttributeRequest.Operation = \"Add\";\r\n\t\t$newADDescAttributeRequest.Name = \"description\";\r\n\t\t$newADDescAttributeRequest.Value = $newADDesc;\r\n\r\n\t\t# Remove the old AttributeRequest\r\n\t\t$requestObject.AttributeRequests.Remove($originalDescAttributeRequest);\r\n\t\t# Add in the new AttributeRequest\r\n\t\t$requestObject.AttributeRequests.Add($newADDescAttributeRequest)\r\n\t\t# Return New AttributeRequest in requestObject to IQService\r\n\t\t$requestObject.toxml() | out-file $requestOutFile;\r\n\t}\r\n\t\r\n\tif($returnloa -eq \"true\") {\r\n\t\tlog(\"RETURN LOA is TRUE\");\r\n\t\t$newADDesc = $adDesc -replace \"LOA\\([^)]+\\)\", \"\";\r\n\t\t$newADDesc = $newADDesc -replace \"\\s{2,}\", \" \";\r\n\t\tlog(\"newADDesc: $newADDesc\");\r\n\t\t# Get original value passed to Powershell script from BeforeCreate rule\r\n\t\t$originalDescAttributeRequest = \"\"\r\n\t\tforeach ($attribute in $requestObject.AttributeRequests){\r\n\t\t\t# Save the original description attribute object to be replaced later\r\n\t\t\tif ($attribute.Name -eq \"description\") {\r\n\t\t\t\t$originalDescAttributeRequest = $attribute\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t# Generate new AttributeRequest\r\n\t\t$newADDescAttributeRequest = New-Object SailPoint.Utils.objects.AttributeRequest\r\n\t\t$newADDescAttributeRequest.Operation = \"Add\";\r\n\t\t$newADDescAttributeRequest.Name = \"description\";\r\n\t\t$newADDescAttributeRequest.Value = $newADDesc;\r\n\r\n\t\t# Remove the old AttributeRequest\r\n\t\t$requestObject.AttributeRequests.Remove($originalDescAttributeRequest);\r\n\t\t# Add in the new AttributeRequest\r\n\t\t$requestObject.AttributeRequests.Add($newADDescAttributeRequest)\r\n\t\t# Return New AttributeRequest in requestObject to IQService\r\n\t\t$requestObject.toxml() | out-file $requestOutFile;\r\n\t}\r\n\t\r\n\tif($term -eq \"true\") {\r\n\t\tlog(\"TERM is TRUE\");\r\n\t\t$newADDesc = \"TERM($currentDate) $adDesc\";\r\n\t\tlog(\"newADDesc: $newADDesc\");\r\n\t\t# Get original value passed to Powershell script from BeforeCreate rule\r\n\t\t$originalDescAttributeRequest = \"\"\r\n\t\tforeach ($attribute in $requestObject.AttributeRequests){\r\n\t\t\t# Save the original description attribute object to be replaced later\r\n\t\t\tif ($attribute.Name -eq \"description\") {\r\n\t\t\t\t$originalDescAttributeRequest = $attribute\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t# Generate new AttributeRequest\r\n\t\t$newADDescAttributeRequest = New-Object SailPoint.Utils.objects.AttributeRequest\r\n\t\t$newADDescAttributeRequest.Operation = \"Add\";\r\n\t\t$newADDescAttributeRequest.Name = \"description\";\r\n\t\t$newADDescAttributeRequest.Value = $newADDesc;\r\n\r\n\t\t# Remove the old AttributeRequest\r\n\t\t$requestObject.AttributeRequests.Remove($originalDescAttributeRequest);\r\n\t\t# Add in the new AttributeRequest\r\n\t\t$requestObject.AttributeRequests.Add($newADDescAttributeRequest)\r\n\t\t# Return New AttributeRequest in requestObject to IQService\r\n\t\t$requestObject.toxml() | out-file $requestOutFile;\r\n\t}\r\n\t\r\n\tif($titlechange -eq \"true\") {\r\n\t\tlog(\"Title Change is TRUE\");\r\n\t\t$newADDesc = $adDesc -replace \"$adTitle\", \"$title\";\r\n\t\tlog(\"newADDesc: $newADDesc\");\r\n\t\t# Get original value passed to Powershell script from BeforeCreate rule\r\n\t\t$originalDescAttributeRequest = \"\"\r\n\t\tforeach ($attribute in $requestObject.AttributeRequests){\r\n\t\t\t# Save the original description attribute object to be replaced later\r\n\t\t\tif ($attribute.Name -eq \"description\") {\r\n\t\t\t\t$originalDescAttributeRequest = $attribute\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t# Generate new AttributeRequest\r\n\t\t$newADDescAttributeRequest = New-Object SailPoint.Utils.objects.AttributeRequest\r\n\t\t$newADDescAttributeRequest.Operation = \"Add\";\r\n\t\t$newADDescAttributeRequest.Name = \"description\";\r\n\t\t$newADDescAttributeRequest.Value = $newADDesc;\r\n\r\n\t\t# Remove the old AttributeRequest\r\n\t\t$requestObject.AttributeRequests.Remove($originalDescAttributeRequest);\r\n\t\t# Add in the new AttributeRequest\r\n\t\t$requestObject.AttributeRequests.Add($newADDescAttributeRequest)\r\n\t\t# Return New AttributeRequest in requestObject to IQService\r\n\t\t$requestObject.toxml() | out-file $requestOutFile;\r\n\t}\r\n\tif($addmail -eq \"true\") {\r\n\t\tlog(\"ADD MAIL is TRUE\");\r\n\t\t$newADMail = $adUPN;\r\n\t\tlog(\"newADMail: $newADMail\");\r\n\t\t\r\n\t\t# Generate new AttributeRequest\r\n\t\t$newADMailAttributeRequest = New-Object SailPoint.Utils.objects.AttributeRequest\r\n\t\t$newADMailAttributeRequest.Operation = \"Add\";\r\n\t\t$newADMailAttributeRequest.Name = \"mail\";\r\n\t\t$newADMailAttributeRequest.Value = $newADMail;\r\n\t\t\r\n\t\t# Add in the new AttributeRequest\r\n\t\t$requestObject.AttributeRequests.Add($newADMailAttributeRequest)\r\n\t\t# Return New AttributeRequest in requestObject to IQService\r\n\t\t$requestObject.toxml() | out-file $requestOutFile;\r\n\t}\r\n\tlog(\"CZR AD Before Modify Ends =======> $cn\");\r\n} Catch {\r\n\t$ErrorMessage = $_.Exception.Message;\r\n\t$ErrorItem = $_.Exception.ItemName;\r\n\tlog(\"Error: Item = $ErrorItem -> Message = $ErrorMessage\");\r\n}"
  },
  "attributes": {
    "ObjectOrientedScript": "true",
    "extension": ".ps1",
    "sourceVersion": "1.0",
    "disabled": "false",
    "program": "powershell.exe",
    "timeout": "300"
  },
  "id": "bdf9fc67c9de4aaeacafd5019fd0ef5a",
  "name": "CZR_ActiveDirectory_BeforeModify",
  "created": "2025-04-04T03:16:09.773Z",
  "modified": "2025-05-01T22:39:04.895Z"
}