{
  "description": "This rule is used to execute the provisioning PowerShell script to call ps after AD Modify",
  "type": "ConnectorAfterModify",
  "signature": {
    "input": [],
    "output": {
      "name": "",
      "description": null,
      "type": null
    }
  },
  "sourceCode": {
    "version": "1.0",
    "script": "function log($string) {\r\n\t$timestamp = \"$(Get-Date -format \"MM-dd-yyyy HH:mm.ss\"): \";\r\n\t$entry = $timestamp + $string;\r\n    $entry | Out-File -Filepath $logFile -append;\r\n}\r\n\r\nfunction Get-AttributeValueFromAccountRequest([sailpoint.Utils.objects.AccountRequest] $request, [String] $targetAttribute) {\r\n\t$value = $null;\r\n    if ($request) {\r\n      foreach ($attrib in $request.AttributeRequests) {\r\n        if ($attrib.Name -eq $targetAttribute) {\r\n          $value = $attrib.Value;\r\n          break;\r\n        }\r\n      }\r\n    }\r\n\treturn $value;\r\n}\r\n  \r\nTry {\r\n\tAdd-type -path \"D:\\IQService\\Utils.dll\";\r\n\t# Read the environment variables\r\n\t$sReader = New-Object System.IO.StringReader([System.String]$env:Request);\r\n\t$sResult = New-Object System.IO.StringReader([System.String]$env:Result);\r\n\r\n\t# Form the xml reader objects\r\n\t$xmlReader = [System.xml.XmlTextReader]([sailpoint.utils.xml.XmlUtil]::getReader($sReader));\r\n\t$xmlReader_Result = [System.xml.XmlTextReader]([sailpoint.utils.xml.XmlUtil]::getReader($sResult));\r\n\r\n\t# Create SailPoint objects\r\n\t$requestObject = New-Object sailpoint.utils.objects.AccountRequest($xmlReader);\r\n\t$resultObject = New-Object sailpoint.utils.objects.ServiceResult($xmlReader_Result);\t  \t\r\n\t  \r\n\t$op = $requestObject.operation;\r\n\t$dn = $requestObject.nativeIdentity;\r\n\t$dnarr = $dn -split \",OU\" , 0;\r\n\t$cntemp = $dnarr[0];\r\n\t$cntemp = $cntemp -replace 'CN=','';\r\n\t$cntemp = $cntemp -replace ',','';\r\n\t$cn = $cntemp.Replace(' ','_');\r\n\t\t\r\n\t$logDate = Get-Date -Format \"yyyy-MM-dd\";\r\n\t$logFile = \"D:\\Sailpoint\\ISCLogs\\ADAfterModify\\ADAfterModify-$logDate-$cn.log\";\r\n\t\r\n\tlog(\"CZR AD After Modify Starts =======> $cn\");\r\n\t$description = Get-AttributeValueFromAccountRequest $requestObject \"description\";\r\n\t$loa = \"false\";\r\n\tif((![string]::IsNullOrEmpty($description)) -and $description -like \"*LOA*\") {\r\n\t\t$loa = \"true\";\r\n\t}\r\n\t\r\n\t$arguments = $requestObject.Attributes;\r\n\t\t\t\r\n\t$excScript = $arguments.excScript;\r\n\t$excScriptSendPwdEmail = $arguments.excScriptSendPwdEmail;\r\n\t$excScriptSOCSendPwdEmail = $arguments.excScriptSOCSendPwdEmail;\r\n\t$excScriptSAMAccName = $arguments.excScriptSAMAccName;\r\n\t$excScriptUPN = $arguments.excScriptUPN;\r\n\t$excScriptEmpType = $arguments.excScriptEmpType;\r\n\t$excScriptDomain = $arguments.excScriptDomain;\r\n\t$excScriptLicenseToAssign = $arguments.excScriptLicenseToAssign;\r\n\t$excScriptBR = $arguments.excScriptBR;\r\n\t$excScriptSetupLike = $arguments.excScriptSetupLike;\r\n\t$excScriptName = $arguments.excScriptName;\r\n\t$excScriptSetupLikeSource = $arguments.excScriptSetupLikeSource;\r\n\t$excScriptCnowTaskNumber = $arguments.excScriptCnowTaskNumber;\r\n\t$excScriptCnowTaskSysId = $arguments.excScriptCnowTaskSysId;\r\n\t$excScriptWorkerType = $arguments.excScriptWorkerType;\r\n\t$excScriptIdentityDisplayName = $arguments.excScriptIdentityDisplayName;\r\n\t$excScriptManagerDisplayName = $arguments.excScriptManagerDisplayName;\r\n\t$excScriptManagerEmail = $arguments.excScriptManagerEmail;\r\n\t$excScriptCnowNetworkAccessRequired = $arguments.excScriptCnowNetworkAccessRequired;\r\n\t$excScriptCnowExchangeMailboxRequired = $arguments.excScriptCnowExchangeMailboxRequired;\t\r\n\t$excScriptPersonNumber = $arguments.excScriptPersonNumber;\r\n\t$excScriptCnowRequestedBy = $arguments.excScriptCnowRequestedBy;\r\n\t$excScriptCnowRequestedByEmail = $arguments.excScriptCnowRequestedByEmail;\t\t\r\n\t$excScriptJobTitle = $arguments.excScriptJobTitle;\r\n\t$excScriptDepartment = $arguments.excScriptDepartment;\r\n\t$excScriptLocationDesc = $arguments.excScriptLocationDesc;\r\n\t$excScriptAssignmentStartDate = $arguments.excScriptAssignmentStartDate;\r\n\t\r\n\t$excScriptLifeCycleState = $arguments.excScriptLifeCycleState;\r\n\t\r\n\t$excScriptSendExclusionSDSBOSSEmail = $arguments.excScriptSendExclusionSDSBOSSEmail;\r\n\t$cNowScriptLegalHold = $arguments.cNowScriptLegalHold;\r\n\t$cNowScriptSetupSource = $arguments.cNowScriptSetupSource;\r\n\t$cNowScriptSAMAccName = $arguments.cNowScriptSAMAccName;\r\n\t$cNowScriptUPN = $arguments.cNowScriptUPN;\r\n\t$cNowScriptCnowTaskNumber = $arguments.cNowScriptCnowTaskNumber;\r\n\t$cNowScriptCnowTaskSysId = $arguments.cNowScriptCnowTaskSysId;\r\n\t$cNowScriptAdOnLegalHold = $arguments.cNowScriptAdOnLegalHold;\r\n\t$cNowScriptEmpJAId = $arguments.cNowScriptEmpJAId;\r\n\t$cNowScriptPersonNumber = $arguments.cNowScriptPersonNumber;\r\n\t$cNowScriptAdConversion = $arguments.cNowScriptAdConversion;\r\n\t$cNowScriptWorkerType = $arguments.cNowScriptWorkerType;\r\n\t$cNowScriptJobTitle = $arguments.cNowScriptJobTitle;\r\n\t$cNowScriptTargetOU = $arguments.cNowScriptTargetOU;\r\n\r\n\t$processName = \"Modify\";\r\n\t$appname = \"CZR-Application-ActiveDirectory-Harrahs\";\r\n\t\r\n\tif((![string]::IsNullOrEmpty($excScriptBR)) -and $excScriptBR -eq \"true\") {\r\n\t\t$processName = \"Rehire\";\r\n\t}\r\n\t\r\n\tif((![string]::IsNullOrEmpty($excScriptSetupLike)) -and $excScriptSetupLike -eq \"true\") {\r\n\t\tif((![string]::IsNullOrEmpty($excScriptSetupLikeSource)) -and $excScriptSetupLikeSource -eq \"CNOW\") {\r\n\t\t\t$processName = \"CNOWRequest\";\r\n\t\t}\r\n\t}\r\n\r\n\tif((![string]::IsNullOrEmpty($cNowScriptLegalHold)) -and ($cNowScriptLegalHold -eq \"true\")) {\r\n\t\tif((![string]::IsNullOrEmpty($cNowScriptSetupSource)) -and ($cNowScriptSetupSource -eq \"LHOLD\")) {\r\n\t\t\t$processName = \"LegalHoldRequest\";\r\n\t\t}\r\n\t}\r\n\r\n\tif((![string]::IsNullOrEmpty($cNowScriptAdConversion)) -and ($cNowScriptAdConversion -eq \"CEConvert\")) {\r\n\t\tif((![string]::IsNullOrEmpty($cNowScriptEmpJAId))) {\r\n\t\t\t$processName = \"EmpConversionRequest\";\r\n\t\t}\r\n\t}\t\t\t\r\n\t\r\n\tif((![string]::IsNullOrEmpty($excScriptWorkerType)) -and $excScriptWorkerType -eq \"Employee\") {\r\n\t\tif((![string]::IsNullOrEmpty($excScriptSetupLike)) -and $excScriptSetupLike -eq \"true\") {\r\n\t\t\tif((![string]::IsNullOrEmpty($excScriptSetupLikeSource)) -and $excScriptSetupLikeSource -eq \"ISC\") {\r\n\t\t\t\t$processName = \"EmployeeAccessRequest\";\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\tif((![string]::IsNullOrEmpty($excScriptWorkerType)) -and $excScriptWorkerType -eq \"Contractor\") {\r\n\t\tif((![string]::IsNullOrEmpty($excScriptSetupLike)) -and $excScriptSetupLike -eq \"true\") {\r\n\t\t\tif((![string]::IsNullOrEmpty($excScriptSetupLikeSource)) -and $excScriptSetupLikeSource -eq \"ISC\") {\r\n\t\t\t\t$processName = \"ContractorAccessRequest\";\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\tif((![string]::IsNullOrEmpty($excScriptLifeCycleState))) {\r\n\t\tif($excScriptLifeCycleState -eq \"inactive\" -or $excScriptLifeCycleState -eq \"lsalclbbdc\") {\r\n\t\t\t$processName = \"Leaver\";\r\n\t\t}\r\n\t\tif($excScriptLifeCycleState -eq \"inactive\") {\r\n\t\t\tif((![string]::IsNullOrEmpty($loa)) -and $loa -eq \"true\") {\r\n\t\t\t\t$processName = \"LOA\";\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tlog(\"Process Name: $processName\");\r\n\t\r\n\tif($resultObject.Errors.count -eq 0) {\r\n\t\tlog(\"AD Connector After Modify input excScript =======> $excScript\");\r\n\t\tlog(\"AD Connector After Modify input excScriptSendPwdEmail =======> $excScriptSendPwdEmail\");\r\n\t\tlog(\"AD Connector After Modify input excScriptSOCSendPwdEmail =======> $excScriptSOCSendPwdEmail\");\r\n\t\tlog(\"AD Connector After Modify input excScriptSAMAccName =======> $excScriptSAMAccName\");\r\n\t\tlog(\"AD Connector After Modify input excScriptUPN =======> $excScriptUPN\");\r\n\t\tlog(\"AD Connector After Modify input excScriptEmpType =======> $excScriptEmpType\");\r\n\t\tlog(\"AD Connector After Modify input excScriptDomain =======> $excScriptDomain\");\r\n\t\tlog(\"AD Connector After Modify input excScriptLicenseToAssign =======> $excScriptLicenseToAssign\");\r\n\t\tlog(\"AD Connector After Modify input excScriptBR =======> $excScriptBR\");\r\n\t\tlog(\"AD Connector After Modify input excScriptSetupLike =======> $excScriptSetupLike\");\r\n\t\tlog(\"AD Connector After Modify input excScriptName =======> $excScriptName\");\r\n\t\tlog(\"AD Connector After Modify input excScriptSetupLikeSource =======> $excScriptSetupLikeSource\");\r\n\t\tlog(\"AD Connector After Modify input excScriptCnowTaskNumber =======> $excScriptCnowTaskNumber\");\r\n\t\tlog(\"AD Connector After Modify input excScriptCnowTaskSysId =======> $excScriptCnowTaskSysId\");\r\n\t\tlog(\"AD Connector After Modify input excScriptWorkerType =======> $excScriptWorkerType\");\r\n\t\tlog(\"AD Connector After Modify input excScriptIdentityDisplayName =======> $excScriptIdentityDisplayName\");\r\n\t\tlog(\"AD Connector After Modify input excScriptManagerDisplayName =======> $excScriptManagerDisplayName\");\r\n\t\tlog(\"AD Connector After Modify input excScriptManagerEmail =======> $excScriptManagerEmail\");\r\n\t\tlog(\"AD Connector After Modify input excScriptCnowNetworkAccessRequired =======> $excScriptCnowNetworkAccessRequired\");\r\n\t\tlog(\"AD Connector After Modify input excScriptCnowExchangeMailboxRequired =======> $excScriptCnowExchangeMailboxRequired\");\r\n\t\tlog(\"AD Connector After Modify input excScriptPersonNumber =======> $excScriptPersonNumber\");\r\n\t\tlog(\"AD Connector After Modify input excScriptCnowRequestedBy =======> $excScriptCnowRequestedBy\");\r\n\t\tlog(\"AD Connector After Modify input excScriptCnowRequestedByEmail =======> $excScriptCnowRequestedByEmail\");\r\n\t\tlog(\"AD Connector After Modify input excScriptJobTitle =======> $excScriptJobTitle\");\r\n\t\tlog(\"AD Connector After Modify input excScriptDepartment =======> $excScriptDepartment\");\r\n\t\tlog(\"AD Connector After Modify input excScriptLocationDesc =======> $excScriptLocationDesc\");\r\n\t\tlog(\"AD Connector After Modify input excScriptAssignmentStartDate =======> $excScriptAssignmentStartDate\");\r\n\t\tlog(\"AD Connector After Modify input excScriptLifeCycleState =======> $excScriptLifeCycleState\");\r\n\t\tlog(\"AD Connector After Modify input excScriptSendExclusionSDSBOSSEmail =======> $excScriptSendExclusionSDSBOSSEmail\");\r\n\t\tlog(\"AD Connector After Modify input cNowScriptLegalHold =======> $cNowScriptLegalHold\");\r\n\t\tlog(\"AD Connector After Modify input cNowScriptSetupSource =======> $cNowScriptSetupSource\");\r\n\t\tlog(\"AD Connector After Modify input cNowScriptSAMAccName =======> $cNowScriptSAMAccName\");\r\n\t\tlog(\"AD Connector After Modify input cNowScriptUPN =======> $cNowScriptUPN\");\r\n\t\tlog(\"AD Connector After Modify input cNowScriptCnowTaskNumber =======> $cNowScriptCnowTaskNumber\");\r\n\t\tlog(\"AD Connector After Modify input cNowScriptCnowTaskSysId =======> $cNowScriptCnowTaskSysId\");\r\n\t\tlog(\"AD Connector After Modify input cNowScriptAdOnLegalHold =======> $cNowScriptAdOnLegalHold\");\r\n\t\tlog(\"AD Connector After Modify input cNowScriptEmpJAId =======> $cNowScriptEmpJAId\");\r\n\t\tlog(\"AD Connector After Modify input cNowScriptPersonNumber =======> $cNowScriptPersonNumber\");\r\n\t\tlog(\"AD Connector After Modify input cNowScriptAdConversion =======> $cNowScriptAdConversion\");\r\n\t\tlog(\"AD Connector After Modify input cNowScriptWorkerType =======> $cNowScriptWorkerType\");\r\n\t\tlog(\"AD Connector After Modify input cNowScriptJobTitle =======> $cNowScriptJobTitle\");\r\n\t\tlog(\"AD Connector After Modify input cNowScriptTargetOU =======> $cNowScriptTargetOU\");\t\r\n\r\n\t\tif ($op -eq \"Modify\") {\r\n\t\t\tlog(\"AD account modify success for user =======> $cn\");\r\n\r\n\t\t\t# Call Leaver Exclusion Notification for SDS BOSS Users\r\n\t\t\tif((![string]::IsNullOrEmpty($excScriptSendExclusionSDSBOSSEmail)) -and ($excScriptSendExclusionSDSBOSSEmail -eq \"true\")) {\r\n\t\t\t\t$argumentList = \"D:\\Sailpoint\\Scripts\\LeaverExclusionNotification.ps1 -processname 'Leaver' -personnumber '$excScriptPersonNumber'  -displayname '$excScriptIdentityDisplayName'\";\r\n\t\t\t\tlog(\"argumentList: $argumentList\");\r\n\t\t\t\tStart-Process -FilePath \"powershell.exe\" -ArgumentList \"$argumentList\";\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t# Call Enable Mailbox script - Rehire User\r\n\t\t\tif((![string]::IsNullOrEmpty($excScript)) -and ($excScript -eq \"true\")) {\r\n\t\t\t\tif((![string]::IsNullOrEmpty($excScriptName)) -and ($excScriptName -eq \"exchangeProvision\")) {\r\n\t\t\t\t\tlog(\"AD Enable Mailbox is requested for this user =======> $cn\");\t\t\t\t\t\t\t\t\r\n\t\t\t\t\tlog(\"Calling Enable Mailbox script for user: $cn\");\r\n\t\t\t\t\t$argumentList = \"D:\\Sailpoint\\Scripts\\EnableMailbox.ps1 -sa '$excScriptSAMAccName' -upn '$excScriptUPN' -dn '$dn' -personnumber '$excScriptPersonNumber' -displayname '$excScriptIdentityDisplayName' -workertype '$excScriptWorkerType' -emptype '$excScriptEmpType' -domain '$excScriptDomain' -license '$excScriptLicenseToAssign' -br '$excScriptBR' -setuplike '$excScriptSetupLike' -setuplikesource '$excScriptSetupLikeSource' -tasknum '$excScriptCnowTaskNumber' -taskid '$excScriptCnowTaskSysId'\";\r\n\t\t\t\t\tlog(\"argumentList: $argumentList\");\r\n\t\t\t\t\tStart-Process -FilePath \"powershell.exe\" -ArgumentList \"$argumentList\";\r\n\t\t\t\t\tlog(\"Finised Calling Enable Mailbox script for user: $cn\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t# Call send email script on new password only for CNOW requests\r\n\t\t\t#if((![string]::IsNullOrEmpty($excScriptSetupLike)) -and ($excScriptSetupLike -eq \"true\")) {\r\n\t\t\t#\tif((![string]::IsNullOrEmpty($excScriptSetupLikeSource)) -and ($excScriptSetupLikeSource -eq \"CNOW\")) {\r\n\t\t\t#\t\tif((![string]::IsNullOrEmpty($excScriptCnowNetworkAccessRequired)) -and ($excScriptCnowNetworkAccessRequired -eq \"true\")) {\r\n\t\t\t\t\t\tif((![string]::IsNullOrEmpty($excScriptSendPwdEmail)) -and ($excScriptSendPwdEmail -eq \"true\")) {\r\n\t\t\t\t\t\t\tlog(\"AD Send Password Email is requested for this user =======> $cn\");\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tlog(\"Calling Send Password Email script for user: $cn\");\r\n\t\t\t\t\t\t\t$epwd = Get-AttributeValueFromAccountRequest $requestObject \"password\";\r\n\t\t\t\t\t\t\t$pwd = [sailpoint.Utils.tools.Util]::decode($epwd,$true);\r\n\t\t\t\t\t\t\t$argumentList = \"D:\\Sailpoint\\Scripts\\SendADPasswordEmail.ps1 -sa '$excScriptSAMAccName' -upn '$excScriptUPN' -personnumber '$excScriptPersonNumber' -displayname '$excScriptIdentityDisplayName' -mgrdisplayname '$excScriptManagerDisplayName' -manageremail '$excScriptManagerEmail' -cnowRequestedBy '$excScriptCnowRequestedBy' -cnowRequestedByEmail '$excScriptCnowRequestedByEmail' -jobTitle '$excScriptJobTitle' -department '$excScriptDepartment' -locationdesc '$excScriptLocationDesc' -assignmentstartdate '$excScriptAssignmentStartDate' -pwd '$pwd'\";\r\n\t\t\t\t\t\t\tlog(\"argumentList: $argumentList\");\r\n\t\t\t\t\t\t\tStart-Process -FilePath \"powershell.exe\" -ArgumentList \"$argumentList\";\r\n\t\t\t\t\t\t\tlog(\"Finished Calling AD Send Password Email script for user: =======> $cn\");\r\n\t\t\t\t\t\t}\r\n\t\t\t#\t\t}\t\t\t\t\t\t\r\n\t\t\t#\t}\r\n\t\t\t#}\r\n\t\t\t\r\n\t\t\t# Call send SOCPasswordEmail and kill Okta and O365 session\r\n\t\t\tif((![string]::IsNullOrEmpty($excScriptSOCSendPwdEmail)) -and ($excScriptSOCSendPwdEmail -eq \"true\")) {\r\n\t\t\t\tlog(\"AD Send SOCPasswordReset Email is requested for this user =======> $cn\");\t\t\t\t\t\t\t\t\r\n\t\t\t\tlog(\"Calling Send SOCPasswordReset Email script for user: $cn\");\r\n\t\t\t\t$epwd = Get-AttributeValueFromAccountRequest $requestObject \"password\";\r\n\t\t\t\t$pwd = [sailpoint.Utils.tools.Util]::decode($epwd,$true);\r\n\t\t\t\t$argumentList = \"D:\\Sailpoint\\Scripts\\SendSOCPasswordResetEmail.ps1 -sa '$excScriptSAMAccName' -upn '$excScriptUPN' -personnumber '$excScriptPersonNumber' -displayname '$excScriptIdentityDisplayName' -mgrdisplayname '$excScriptManagerDisplayName' -manageremail '$excScriptManagerEmail' -cnowRequestedBy '$excScriptCnowRequestedBy' -cnowRequestedByEmail '$excScriptCnowRequestedByEmail' -jobTitle '$excScriptJobTitle' -department '$excScriptDepartment' -locationdesc '$excScriptLocationDesc' -assignmentstartdate '$excScriptAssignmentStartDate' -pwd '$pwd'\";\r\n\t\t\t\tlog(\"argumentList: $argumentList\");\r\n\t\t\t\tStart-Process -FilePath \"powershell.exe\" -ArgumentList \"$argumentList\";\r\n\t\t\t\tlog(\"Finished Calling AD Send Password Email script for user: =======> $cn\");\r\n\r\n\t\t\t\t# Call Okta PS script to kill sessions\r\n\t\t\t\t$argumentList = \"D:\\Sailpoint\\Scripts\\OKTAReset2FADisableUser.ps1 -upn '$excScriptUPN'\";\r\n                log(\"argumentList: $argumentList\");\r\n\t\t\t\tStart-Process -FilePath \"pwsh.exe\" -ArgumentList \"$argumentList\";\r\n\t\t\t\tlog(\"finish Call 0365 script here\");\r\n\t\t\t}\r\n\r\n\t\t\t# Call update CNOW Ticket\r\n\t\t\tif((![string]::IsNullOrEmpty($excScriptSetupLike)) -and ($excScriptSetupLike -eq \"true\")) {\r\n\t\t\t\tif((![string]::IsNullOrEmpty($excScriptSetupLikeSource)) -and ($excScriptSetupLikeSource -eq \"CNOW\")) {\r\n\t\t\t\t\tif((![string]::IsNullOrEmpty($excScriptCnowNetworkAccessRequired)) -and ($excScriptCnowNetworkAccessRequired -eq \"true\")) {\r\n\t\t\t\t\t\tif((![string]::IsNullOrEmpty($excScriptCnowExchangeMailboxRequired)) -and ($excScriptCnowExchangeMailboxRequired -eq \"false\")) {\r\n\t\t\t\t\t\t\t$action = \"UPDATE_CLOSE_COMPLETE\";\r\n\t\t\t\t\t\t\t$message = \"Successfully completed network access\";\r\n\t\t\t\t\t\t\t$argumentList = \"D:\\Sailpoint\\Scripts\\UpdateCNOWTask.ps1 -tasknum '$excScriptCnowTaskNumber' -taskid '$excScriptCnowTaskSysId' -action '$action' -error '$message'\";\r\n\t\t\t\t\t\t\tlog(\"argumentList: $argumentList\");\r\n\t\t\t\t\t\t\tStart-Process -FilePath \"powershell.exe\" -ArgumentList \"$argumentList\";\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t$action = \"UPDATE\";\r\n\t\t\t\t\t\t\t$message = \"Successfully completed network access, Exchange Mailbox in progress..\";\r\n\t\t\t\t\t\t\t$argumentList = \"D:\\Sailpoint\\Scripts\\UpdateCNOWTask.ps1 -tasknum '$excScriptCnowTaskNumber' -taskid '$excScriptCnowTaskSysId' -action '$action' -error '$message'\";\r\n\t\t\t\t\t\t\tlog(\"argumentList: $argumentList\");\r\n\t\t\t\t\t\t\tStart-Process -FilePath \"powershell.exe\" -ArgumentList \"$argumentList\";\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t# Call Legal Hold Script\r\n\t\t\tif((![string]::IsNullOrEmpty($cNowScriptLegalHold)) -and ($cNowScriptLegalHold -eq \"true\")) {\r\n\t\t\t\tif((![string]::IsNullOrEmpty($cNowScriptSetupSource)) -and ($cNowScriptSetupSource -eq \"LHOLD\")) {\r\n\t\t\t\t\tif((![string]::IsNullOrEmpty($cNowScriptAdOnLegalHold)) -and ($cNowScriptAdOnLegalHold -eq \"true\")) {\r\n\t\t\t\t\t\t$argumentList = \"D:\\Sailpoint\\Scripts\\Legal_Hold_CZR.ps1 -tasknum '$cNowScriptCnowTaskNumber' -taskid '$cNowScriptCnowTaskSysId' -sa '$cNowScriptSAMAccName' -employeeJId '$cNowScriptEmpJAId' -employeeNumber '$cNowScriptPersonNumber'\";\r\n\t\t\t\t\t\tlog(\"argumentList: $argumentList\");\r\n\t\t\t\t\t\tStart-Process -FilePath \"powershell.exe\" -ArgumentList \"$argumentList\";\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$argumentList = \"D:\\Sailpoint\\Scripts\\Legal_Hold_CZR.ps1 -tasknum '$cNowScriptCnowTaskNumber' -taskid '$cNowScriptCnowTaskSysId' -sa '$cNowScriptSAMAccName' -employeeJId '$cNowScriptEmpJAId' -employeeNumber '$cNowScriptPersonNumber'\";\r\n\t\t\t\t\t\tlog(\"argumentList: $argumentList\");\r\n\t\t\t\t\t\tStart-Process -FilePath \"powershell.exe\" -ArgumentList \"$argumentList\";\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t# Call Employee Conversion Script\r\n\t\t\tif((![string]::IsNullOrEmpty($cNowScriptAdConversion)) -and ($cNowScriptAdConversion -eq \"CEConvert\")) {\r\n\t\t\t\tif((![string]::IsNullOrEmpty($cNowScriptEmpJAId))) {\r\n\t\t\t\t\t$argumentList = \"D:\\Sailpoint\\Scripts\\CZR_Emp_Conversion.ps1 -contja '$cNowScriptEmpJAId' -empid '$cNowScriptPersonNumber' -emptype '$cNowScriptWorkerType' -emptitle '$cNowScriptJobTitle' -empou '$cNowScriptTargetOU'\";\r\n\t\t\t\t\tlog(\"argumentList: $argumentList\");\r\n\t\t\t\t\tStart-Process -FilePath \"powershell.exe\" -ArgumentList \"$argumentList\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t} elseif($op -eq \"Disable\") {\r\n\t\t\tlog(\"AD account disable success for user =======> $cn\");\r\n\t\t\tif((![string]::IsNullOrEmpty($excScriptLifeCycleState)) -and ($excScriptLifeCycleState -eq \"inactive\" -or $excScriptLifeCycleState -eq \"inactiveImmediateTerm\" -or $excScriptLifeCycleState -eq \"lsalclbbdc\")) {\r\n\t\t\t\t# Call Okta PS script to kill sessions\r\n\t\t\t\t$argumentList = \"D:\\Sailpoint\\Scripts\\OKTAReset2FADisableUser.ps1 -upn '$excScriptUPN'\";\r\n                log(\"argumentList: $argumentList\");\r\n\t\t\t\tStart-Process -FilePath \"pwsh.exe\" -ArgumentList \"$argumentList\";\r\n\t\t\t\tlog(\"finish Call 0365 script here\");\r\n\t\t\t\t# Call Lock Devices script\r\n\t\t\t\t if((![string]::IsNullOrEmpty($excScriptLifeCycleState))) {\r\n\t\t\t\t if($excScriptLifeCycleState -eq \"inactiveImmediateTerm\") {\r\n\t\t\t\t$formattedName = $excScriptIdentityDisplayName -replace '[,\\s]', '';\r\n\t\t\t\t$argumentList = \"D:\\Sailpoint\\Scripts\\LockDevices.ps1 -userName '$excScriptSAMAccName' -personNumber '$excScriptPersonNumber' -displayName '$formattedName'\";\r\n                log(\"LockDevices argumentList: $argumentList\");\r\n\t\t\t\tStart-Process -FilePath \"pwsh.exe\" -ArgumentList \"$argumentList\";\r\n\t\t\t\t }\r\n\t\t\t\t}\r\n\t\t\t\t#Call Disable Account\r\n\t\t\t\t$argumentList = \"D:\\Sailpoint\\Scripts\\DisableAD.ps1 -personNumber '$excScriptPersonNumber'\";\r\n                log(\"DisableAD argumentList: $argumentList\");\r\n\t\t\t\tStart-Process -FilePath \"pwsh.exe\" -ArgumentList \"$argumentList\";\r\n\r\n\t\t\t\t# Call send leaver email without exchange script\r\n\t\t\t\tif([string]::IsNullOrEmpty($excScript)) {\r\n\t\t\t\t\tlog(\"Leaver Send Email without Exchange is requested for this user =======> $cn\");\t\t\t\t\t\t\t\t\r\n\t\t\t\t\tlog(\"Calling Leaver Send Email without Exchange script for user: $cn\");\r\n\t\t\t\t\t$argumentList = \"D:\\Sailpoint\\Scripts\\LeaverWithoutExchangeNotification.ps1 -sa '$excScriptSAMAccName' -personnumber '$excScriptPersonNumber' -displayname '$excScriptIdentityDisplayName' -mgrdisplayname '$excScriptManagerDisplayName' -manageremail '$excScriptManagerEmail'\";\r\n\t\t\t\t\tlog(\"argumentList: $argumentList\");\r\n\t\t\t\t\tStart-Process -FilePath \"powershell.exe\" -ArgumentList \"$argumentList\";\r\n\t\t\t\t\tlog(\"Finished Calling Leaver Send Email without Exchange script for user: =======> $cn\");\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t# Call Disable Mailbox script\r\n\t\t\t\tif((![string]::IsNullOrEmpty($excScript)) -and ($excScript -eq \"true\")) {\r\n\t\t\t\t\tif((![string]::IsNullOrEmpty($excScriptName)) -and ($excScriptName -eq \"exchangeDeprovision\")) {\r\n\t\t\t\t\t\tlog(\"AD Disable Mailbox is requested for this user =======> $cn\");\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\tlog(\"Calling Disable Mailbox script for user: $cn\");\r\n\t\t\t\t\t\t$argumentList = \"D:\\Sailpoint\\Scripts\\DisableMailbox.ps1 -sa '$excScriptSAMAccName' -upn '$excScriptUPN' -dn '$dn' -personnumber '$excScriptPersonNumber' -displayname '$excScriptIdentityDisplayName' -workertype '$excScriptWorkerType' -emptype '$excScriptEmpType' -domain '$excScriptDomain' -br '$excScriptBR' -setuplike '$excScriptSetupLike' -setuplikesource '$excScriptSetupLikeSource' -tasknum '$excScriptCnowTaskNumber' -taskid '$excScriptCnowTaskSysId' -mgrdisplayname '$excScriptManagerDisplayName' -manageremail '$excScriptManagerEmail' -lifecyclestate '$excScriptLifeCycleState' -loa '$loa'\";\r\n\t\t\t\t\t\tlog(\"argumentList: $argumentList\");\r\n\t\t\t\t\t\tStart-Process -FilePath \"powershell.exe\" -ArgumentList \"$argumentList\";\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlog(\"Finised Calling Disable Mailbox script for user: $cn\");\t\t\t\t\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlog(\"AD Disable Mailbox is not requested for this user =======> $cn\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} elseif($op -eq \"Enable\") {\r\n\t\t\tlog(\"AD account enable success for user =======> $cn\");\r\n\t\t\t\r\n\t\t\t# Call Enable Mailbox script - Rehire User\r\n\t\t\tif((![string]::IsNullOrEmpty($excScript)) -and ($excScript -eq \"true\")) {\r\n\t\t\t\tif((![string]::IsNullOrEmpty($excScriptName)) -and ($excScriptName -eq \"exchangeProvision\")) {\r\n\t\t\t\t\tif((![string]::IsNullOrEmpty($excScriptBR)) -and ($excScriptBR -eq \"true\")) {\r\n\t\t\t\t\t\tlog(\"AD Enable Mailbox is requested for this user =======> $cn\");\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\tlog(\"Calling Enable Mailbox script for user: $cn\");\r\n\t\t\t\t\t\t$argumentList = \"D:\\Sailpoint\\Scripts\\EnableMailbox.ps1 -sa '$excScriptSAMAccName' -upn '$excScriptUPN' -dn '$dn' -personnumber '$excScriptPersonNumber' -displayname '$excScriptIdentityDisplayName' -workertype '$excScriptWorkerType' -emptype '$excScriptEmpType' -domain '$excScriptDomain' -license '$excScriptLicenseToAssign' -br '$excScriptBR' -setuplike '$excScriptSetupLike' -setuplikesource '$excScriptSetupLikeSource' -tasknum '$excScriptCnowTaskNumber' -taskid '$excScriptCnowTaskSysId'\";\r\n\t\t\t\t\t\tlog(\"argumentList: $argumentList\");\r\n\t\t\t\t\t\tStart-Process -FilePath \"powershell.exe\" -ArgumentList \"$argumentList\";\r\n\t\t\t\t\t\tlog(\"Finised Calling Enable Mailbox script for user: $cn\");\r\n\t\t\t\t\t}\t\t\t\t\t\t\r\n\t\t\t\t}\t\t\t\t\t\r\n\t\t\t}\r\n\t\t}\r\n\t} else {\t\t\r\n\t\tlog(\"AD account modify failed for user =======> $cn\");\r\n\t\t$errorMessage = $resultObject.Errors -join \", \";\r\n\t\t#Call JML Failure Notification script\r\n\t\tif((![string]::IsNullOrEmpty($errorMessage))) {\r\n\t\t\t$argumentList = \"D:\\Sailpoint\\Scripts\\JMLFailureNotification.ps1 -processname '$processName' -sa '$excScriptSAMAccName' -dn '$dn' -appname '$appname' -personnumber '$excScriptPersonNumber'  -displayname '$excScriptIdentityDisplayName' -tasknum '$excScriptCnowTaskNumber' -error '$errorMessage'\";\r\n\t\t\tlog(\"argumentList: $argumentList\");\r\n\t\t\tStart-Process -FilePath \"powershell.exe\" -ArgumentList \"$argumentList\";\r\n\t\t}\r\n\t\t#Call update CNOW Ticket\r\n\t\tif((![string]::IsNullOrEmpty($excScriptSetupLike)) -and ($excScriptSetupLike -eq \"true\")) {\r\n\t\t\tif((![string]::IsNullOrEmpty($excScriptSetupLikeSource)) -and ($excScriptSetupLikeSource -eq \"CNOW\")) {\r\n\t\t\t\t$action = \"UPDATE\";\r\n\t\t\t\t$argumentList = \"D:\\Sailpoint\\Scripts\\UpdateCNOWTask.ps1 -tasknum '$excScriptCnowTaskNumber' -taskid '$excScriptCnowTaskSysId' -action '$action' -error '$errorMessage'\";\r\n\t\t\t\tlog(\"argumentList: $argumentList\");\r\n\t\t\t\tStart-Process -FilePath \"powershell.exe\" -ArgumentList \"$argumentList\";\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tlog(\"CZR AD After Modify Ends =======> $cn\");\r\n} Catch {\r\n\t$ErrorMessage = $_.Exception.Message;\r\n\t$ErrorItem = $_.Exception.ItemName;\r\n\tlog(\"Error: Item = $ErrorItem -> Message = $ErrorMessage\");\r\n}"
  },
  "attributes": {
    "ObjectOrientedScript": "true",
    "extension": ".ps1",
    "sourceVersion": "1.0",
    "disabled": "false",
    "program": "powershell.exe",
    "timeout": "300"
  },
  "id": "89bd724807ea499d9b6167c07b328d3d",
  "name": "CZR_ActiveDirectory_AfterModify",
  "created": "2025-03-16T03:48:41.400Z",
  "modified": "2025-12-18T14:23:56.846Z"
}